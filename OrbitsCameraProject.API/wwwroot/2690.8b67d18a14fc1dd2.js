"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[2690],{2690:(z,_,s)=>{s.r(_),s.d(_,{TeacherListComponent:()=>w});var r=s(8728),p=s(2200),d=s(8132),m=s(980),l=s(645),h=s(357),f=s(6053),T=s(6848),E=s(8937),C=s(7046),g=s(7753),M=s(7509),D=s(2709),v=s(9331),u=s(8018),t=s(3664),R=s(8834),L=s(3746),I=s(4507),O=s(5747),b=s(6735);const x=["loadMoreTrigger"],P=()=>["/online-course/teacher/add"],$=e=>["/online-course/teacher/edit",e],j=e=>({user:e}),F=e=>({value:e});function y(e,o){1&e&&(t.j41(0,"div",29)(1,"button",30)(2,"div",31),t.nrm(3,"i",32),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()),2&e&&(t.R7$(),t.Y8G("routerLink",t.lJ4(4,P)),t.R7$(3),t.SpI(" ",t.bMT(5,2,"Add Teacher")," "))}function S(e,o){1&e&&(t.j41(0,"th",33),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"Name")))}function A(e,o){if(1&e&&(t.j41(0,"td",34),t.EFF(1),t.k0s()),2&e){const a=o.$implicit;t.R7$(),t.JRh(a.fullName)}}function W(e,o){1&e&&(t.j41(0,"th",35),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"Email")))}function B(e,o){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const a=o.$implicit;t.R7$(),t.JRh(a.email)}}function U(e,o){1&e&&(t.j41(0,"th",35),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"Mobile")))}function k(e,o){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const a=o.$implicit;t.R7$(),t.JRh(a.mobile)}}function N(e,o){1&e&&(t.j41(0,"th",35),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"Nationality")))}function K(e,o){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const a=o.$implicit;t.R7$(),t.JRh(a.nationality)}}function G(e,o){1&e&&(t.j41(0,"th",37),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"Actions")))}function V(e,o){if(1&e){const a=t.RV6();t.j41(0,"td",36)(1,"div",38)(2,"ul",39)(3,"li",40),t.nI1(4,"translate"),t.bIt("click",function(){const n=r.eBV(a).$implicit,c=t.XpG();return r.Njj(c.teacherDetails(n))}),t.j41(5,"a",41),t.nrm(6,"i",42),t.k0s()(),t.j41(7,"li",43),t.nI1(8,"translate"),t.j41(9,"a",44),t.nrm(10,"i",45),t.k0s()(),t.j41(11,"li",43),t.nI1(12,"translate"),t.j41(13,"a",46),t.bIt("click",function(){const n=r.eBV(a).$implicit,c=t.XpG();return r.Njj(c.confirmDisable(n))}),t.nrm(14,"i",47),t.k0s()()()()()}if(2&e){const a=o.$implicit,i=t.XpG();t.R7$(3),t.Y8G("matTooltip",t.bMT(4,6,"\u0639\u0631\u0636")),t.R7$(4),t.Y8G("matTooltip",t.bMT(8,8,"\u062a\u0639\u062f\u064a\u0644")),t.R7$(2),t.Y8G("routerLink",t.eq3(12,$,a.id))("state",t.eq3(14,j,a)),t.R7$(2),t.Y8G("matTooltip",t.bMT(12,10,"\u062d\u0630\u0641")),t.R7$(2),t.Y8G("disabled",i.isProcessing(a.id))}}function Y(e,o){1&e&&t.nrm(0,"tr",48)}function J(e,o){1&e&&t.nrm(0,"tr",49)}function X(e,o){if(1&e&&(t.j41(0,"tr",50)(1,"td",51),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&e){t.XpG();const a=t.sdS(12);t.R7$(2),t.SpI(" ",t.i5U(3,1,"No data matching the filter",t.eq3(4,F,a.value))," ")}}let w=(()=>{class e{constructor(){this.lookupService=(0,r.WQX)(T.s),this.userService=(0,r.WQX)(D.D),this.toast=(0,r.WQX)(M.f),this.translate=(0,r.WQX)(u.c$),this.dialog=(0,r.WQX)(h.h),this.displayedColumns=["fullName","email","mobile","nationality","action"],this.dataSource=new l.I6,this.totalCount=0,this.filter={skipCount:0,maxResultCount:10},this.pageIndex=0,this.pageSize=10,this.isLoading=!1,this.isLoadingMore=!1,this.pendingTeacherIds=new Set}set loadMoreTrigger(a){this.loadMoreElement=a,this.setupIntersectionObserver()}applyFilter(a){this.filter.searchTerm=a.target.value.trim().toLowerCase(),this.pageIndex=0,this.filter.skipCount=0,this.loadTeachers()}ngOnInit(){this.loadTeachers()}ngOnDestroy(){this.intersectionObserver?.disconnect()}loadTeachers(a=!1){this.isLoading=!a,this.isLoadingMore=a,this.lookupService.getUsersForSelects(this.filter,Number(E.m.Teacher),0,0,0).pipe((0,m.j)(()=>{this.isLoading=!1,this.isLoadingMore=!1})).subscribe({next:i=>{i.isSuccess&&i.data?.items?(this.dataSource.data=a?[...this.dataSource.data,...i.data.items]:i.data.items,this.totalCount=i.data.totalCount):(a||(this.dataSource.data=[]),this.totalCount=0)},error:()=>{a||(this.dataSource.data=[]),this.totalCount=0}})}teacherDetails(a){this.lookupService.getUserDetails(a.id).subscribe({next:i=>{i.isSuccess&&i.data?this.dialog.open(C.TeacherDetailsComponent,{width:"800px",maxWidth:"95vw",data:i.data}):this.toast.error("Failed to load teacher details")},error:()=>this.toast.error("Failed to load teacher details")})}confirmDisable(a){this.isProcessing(a.id)||this.dialog.open(v.x,{data:{fullName:a.fullName}}).afterClosed().subscribe(n=>{n&&this.disableTeacher(a)})}isProcessing(a){return this.pendingTeacherIds.has(a)}disableTeacher(a){this.pendingTeacherIds.has(a.id)||(this.pendingTeacherIds.add(a.id),this.userService.disableUser(a.id,!1).pipe((0,m.j)(()=>this.pendingTeacherIds.delete(a.id))).subscribe({next:i=>{if(i.isSuccess)return this.dataSource.data=this.dataSource.data.filter(n=>n.id!==a.id),this.totalCount=Math.max(this.totalCount-1,0),void this.toast.success(this.translate.instant("Teacher disabled successfully"));i.errors?.length?i.errors.forEach(n=>this.toast.error(n.message)):this.toast.error(this.translate.instant("Failed to disable teacher"))},error:()=>this.toast.error(this.translate.instant("Failed to disable teacher"))}))}setupIntersectionObserver(){this.loadMoreElement&&(this.intersectionObserver?.disconnect(),this.intersectionObserver=new IntersectionObserver(a=>{a.some(i=>i.isIntersecting)&&this.loadNextPage()},{root:null,rootMargin:"0px 0px 20% 0px"}),this.intersectionObserver.observe(this.loadMoreElement.nativeElement))}loadNextPage(){this.isLoading||this.isLoadingMore||this.hasMoreResults()&&(this.pageIndex+=1,this.filter.skipCount=this.pageIndex*this.pageSize,this.filter.maxResultCount=this.pageSize,this.loadTeachers(!0))}hasMoreResults(){return this.dataSource.data.length<this.totalCount}static#t=this.\u0275fac=function(i){return new(i||e)};static#e=this.\u0275cmp=t.VBU({type:e,selectors:[["app-teacher-list"]],viewQuery:function(i,n){if(1&i&&t.GBs(x,5),2&i){let c;t.mGM(c=t.lsd())&&(n.loadMoreTrigger=c.first)}},decls:39,vars:15,consts:[["headerOptionsTemplate",""],["input",""],["loadMoreTrigger",""],[3,"isLoading"],[1,"row","p-t-25"],[1,"col-12"],["padding","0","cardClass","sm-block",3,"cardTitle"],[1,"p-b-15"],[1,"table-containe","table-reponsive"],[1,"table-search","p-t-15","p-x-15"],["appearance","outline",1,"w-100"],["matInput","",3,"keyup","placeholder"],[1,"table-responsive"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","fullName"],["mat-header-cell","","class","p-l-25",4,"matHeaderCellDef"],["mat-cell","","class","p-l-25 text-nowrap",4,"matCellDef"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","mobile"],["matColumnDef","nationality"],["matColumnDef","action"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"app-paginator"],[1,"text-muted"],[1,"table-options"],["mat-flat-button","","color","primary",3,"routerLink"],[1,"flex","align-item-center"],[1,"ti","ti-plus","f-18","m-r-5"],["mat-header-cell","",1,"p-l-25"],["mat-cell","",1,"p-l-25","text-nowrap"],["mat-header-cell",""],["mat-cell","",1,"text-nowrap"],["mat-header-cell","",1,"text-center"],[1,"text-center","text-nowrap"],[1,"list-inline","p-l-0"],[1,"list-inline-item","m-r-10",3,"click","matTooltip"],["href","javascript:",1,"avatar","avatar-xs","text-muted"],[1,"ti","ti-eye","f-18"],[1,"list-inline-item","m-r-10",3,"matTooltip"],[1,"avatar","avatar-xs","text-muted",3,"routerLink","state"],[1,"ti","ti-edit","f-18"],["type","button",1,"avatar","avatar-xs","text-muted",3,"click","disabled"],[1,"ti","ti-trash","f-18"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(i,n){if(1&i){const c=t.RV6();t.j41(0,"app-loading-overlay",3)(1,"div",4)(2,"div",5)(3,"app-card",6),t.nI1(4,"translate"),t.DNE(5,y,6,5,"ng-template",null,0,t.C5r),t.j41(7,"div",7)(8,"div",8)(9,"div",9)(10,"mat-form-field",10)(11,"input",11,1),t.nI1(13,"translate"),t.bIt("keyup",function(Q){return r.eBV(c),r.Njj(n.applyFilter(Q))}),t.k0s()()(),t.j41(14,"div",12)(15,"table",13),t.qex(16,14),t.DNE(17,S,3,3,"th",15)(18,A,2,1,"td",16),t.bVm(),t.qex(19,17),t.DNE(20,W,3,3,"th",18)(21,B,2,1,"td",19),t.bVm(),t.qex(22,20),t.DNE(23,U,3,3,"th",18)(24,k,2,1,"td",19),t.bVm(),t.qex(25,21),t.DNE(26,N,3,3,"th",18)(27,K,2,1,"td",19),t.bVm(),t.qex(28,22),t.DNE(29,G,3,3,"th",23)(30,V,15,16,"td",19),t.bVm(),t.DNE(31,Y,1,0,"tr",24)(32,J,1,0,"tr",25)(33,X,4,6,"tr",26),t.k0s(),t.j41(34,"div",27,2)(36,"span",28),t.EFF(37),t.nI1(38,"translate"),t.k0s()()()()()()()()()}2&i&&(t.Y8G("isLoading",n.isLoading),t.R7$(3),t.Y8G("cardTitle",t.bMT(4,9,"Teacher List")),t.R7$(8),t.Y8G("placeholder",t.bMT(13,11,"Search...")),t.R7$(4),t.Y8G("dataSource",n.dataSource),t.R7$(16),t.Y8G("matHeaderRowDef",n.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",n.displayedColumns),t.R7$(2),t.AVh("d-none",!n.hasMoreResults()),t.R7$(3),t.SpI(" ",t.bMT(38,13,n.isLoadingMore?"Loading more...":"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")," "))},dependencies:[p.MD,f.G,R.$z,L.fg,I.j,O.e,l.Zl,l.tL,l.ji,l.cC,l.YV,l.iL,l.KS,l.$R,l.YZ,l.NB,l.ky,b.i,u.D9,d.iI,d.Wk,h.l,g.q],styles:[".table-options[_ngcontent-%COMP%]{display:flex;align-items:center}@media (max-width: 575px){.table-options[_ngcontent-%COMP%]{display:block}.table-options[_ngcontent-%COMP%]   .mdc-button[_ngcontent-%COMP%]{margin-top:10px}}"]})}return e})()}}]);