"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[278],{4626:(N,y,o)=>{o.d(y,{J:()=>C,Q:()=>D});var M=o(10467),r=o(73664),p=o(48728),u=o(17705),F=o(60177),_=o(25007);const k=["chart"];let D=(()=>{class v{constructor(){this.chart=(0,u.hFB)(),this.annotations=(0,u.hFB)(),this.colors=(0,u.hFB)(),this.dataLabels=(0,u.hFB)(),this.series=(0,u.hFB)(),this.stroke=(0,u.hFB)(),this.labels=(0,u.hFB)(),this.legend=(0,u.hFB)(),this.markers=(0,u.hFB)(),this.noData=(0,u.hFB)(),this.fill=(0,u.hFB)(),this.tooltip=(0,u.hFB)(),this.plotOptions=(0,u.hFB)(),this.responsive=(0,u.hFB)(),this.xaxis=(0,u.hFB)(),this.yaxis=(0,u.hFB)(),this.forecastDataPoints=(0,u.hFB)(),this.grid=(0,u.hFB)(),this.states=(0,u.hFB)(),this.title=(0,u.hFB)(),this.subtitle=(0,u.hFB)(),this.theme=(0,u.hFB)(),this.autoUpdateSeries=(0,u.hFB)(!0),this.chartReady=(0,u.CGW)(),this.chartInstance=(0,p.vPA)(null),this.chartElement=u.ebz.required("chart"),this.ngZone=(0,p.WQX)(r.SKi),this.isBrowser=(0,F.UE)((0,p.WQX)(r.Agw))}ngOnChanges(s){this.isBrowser&&this.ngZone.runOutsideAngular(()=>{_.$.schedule(()=>this.hydrate(s))})}ngOnDestroy(){this.destroy()}hydrate(s){this.autoUpdateSeries()&&0===Object.keys(s).filter(t=>"series"!==t).length?this.updateSeries(this.series(),!0):this.createElement()}createElement(){var s=this;return(0,M.A)(function*(){const{default:d}=yield o.e(4550).then(o.t.bind(o,84550,19));window.ApexCharts||=d;const t={};["annotations","chart","colors","dataLabels","series","stroke","labels","legend","fill","tooltip","plotOptions","responsive","markers","noData","xaxis","yaxis","forecastDataPoints","grid","states","title","subtitle","theme"].forEach(R=>{const f=s[R]();f&&(t[R]=f)}),s.destroy();const I=s.ngZone.runOutsideAngular(()=>new d(s.chartElement().nativeElement,t));s.chartInstance.set(I),s.render(),s.chartReady.emit({chartObj:I})})()}render(){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.render())}updateOptions(s,d,t,E){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateOptions(s,d,t,E))}updateSeries(s,d){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateSeries(s,d))}appendSeries(s,d){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendSeries(s,d))}appendData(s){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendData(s))}highlightSeries(s){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.highlightSeries(s))}toggleSeries(s){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleSeries(s))}showSeries(s){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.showSeries(s))}hideSeries(s){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.hideSeries(s))}resetSeries(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.resetSeries())}zoomX(s,d){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.zoomX(s,d))}toggleDataPointSelection(s,d){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleDataPointSelection(s,d))}destroy(){this.chartInstance()?.destroy(),this.chartInstance.set(null)}setLocale(s){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.setLocale(s))}paper(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.paper())}addXaxisAnnotation(s,d,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addXaxisAnnotation(s,d,t))}addYaxisAnnotation(s,d,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addYaxisAnnotation(s,d,t))}addPointAnnotation(s,d,t){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addPointAnnotation(s,d,t))}removeAnnotation(s,d){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.removeAnnotation(s,d))}clearAnnotations(s){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.clearAnnotations(s))}dataURI(s){return this.chartInstance()?.dataURI(s)}static#t=this.\u0275fac=function(d){return new(d||v)};static#e=this.\u0275cmp=r.VBU({type:v,selectors:[["apx-chart"]],viewQuery:function(d,t){1&d&&r.wEZ(t.chartElement,k,5),2&d&&r.NyB()},inputs:{chart:[1,"chart"],annotations:[1,"annotations"],colors:[1,"colors"],dataLabels:[1,"dataLabels"],series:[1,"series"],stroke:[1,"stroke"],labels:[1,"labels"],legend:[1,"legend"],markers:[1,"markers"],noData:[1,"noData"],fill:[1,"fill"],tooltip:[1,"tooltip"],plotOptions:[1,"plotOptions"],responsive:[1,"responsive"],xaxis:[1,"xaxis"],yaxis:[1,"yaxis"],forecastDataPoints:[1,"forecastDataPoints"],grid:[1,"grid"],states:[1,"states"],title:[1,"title"],subtitle:[1,"subtitle"],theme:[1,"theme"],autoUpdateSeries:[1,"autoUpdateSeries"]},outputs:{chartReady:"chartReady"},features:[r.OA$],decls:2,vars:0,consts:[["chart",""]],template:function(d,t){1&d&&r.nrm(0,"div",null,0)},encapsulation:2,changeDetection:0})}return v})(),C=(()=>{class v{static#t=this.\u0275fac=function(d){return new(d||v)};static#e=this.\u0275mod=r.$C({type:v});static#n=this.\u0275inj=p.G2t({})}return v})()},90278:(N,y,o)=>{o.r(y),o.d(y,{InvoiceListComponent:()=>Et,MONTH_FORMATS:()=>G});var M=o(72200),r=o(48728),p=o(89417),u=o(75263),F=o(7356),_=o(97586),k=o.n(_),D=o(35568),j=o(56147),C=o(17705),v=o(23597),V=o(39928),s=o(76045),d=o(4626),t=o(73664);let E=(()=>{class n{constructor(){this.themeService=(0,r.WQX)(V.z),this.seriesData=C.hFB.required(),this.colors=C.hFB.required(),(0,v.QZ)(()=>{this.isDarkTheme(this.themeService.isDarkMode())})}ngOnInit(){this.chartOptions={chart:{type:"area",height:55,sparkline:{enabled:!0}},series:[{data:this.seriesData()}],fill:{type:"gradient",gradient:{shadeIntensity:1,type:"vertical",inverseColors:!1,opacityFrom:.5,opacityTo:0}},stroke:{curve:"smooth",width:2},grid:{show:!1},tooltip:{fixed:{enabled:!1},x:{show:!1},marker:{show:!1}},colors:this.colors()}}isDarkTheme(e){const i={...this.chartOptions.tooltip};i.theme=e===s.nd?s.nd:s.T,this.chartOptions={...this.chartOptions,tooltip:i}}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-invoice-list-chart"]],inputs:{seriesData:[1,"seriesData"],colors:[1,"colors"]},decls:2,vars:6,consts:[[1,"chart"],[3,"series","chart","colors","fill","stroke","tooltip"]],template:function(i,a){1&i&&(t.j41(0,"div",0),t.nrm(1,"apx-chart",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("series",a.chartOptions.series)("chart",a.chartOptions.chart)("colors",a.chartOptions.colors)("fill",a.chartOptions.fill)("stroke",a.chartOptions.stroke)("tooltip",a.chartOptions.tooltip))},dependencies:[j.G,d.J,d.Q],encapsulation:2})}return n})();var I=o(96695),R=o(2042),f=o(90645),Y=o(27468),S=o(51194),g=o(30357),J=o(91703),w=o(88834),U=o(36751),$=o(33746),A=o(7673),Z=o(96354),X=o(99437),Q=o(25558),T=o(5404);let W=(()=>{class n{constructor(){this.fb=(0,r.WQX)(p.ok),this.service=(0,r.WQX)(S.N),this.dialogRef=(0,r.WQX)(g.k),this.data=(0,r.WQX)(g.e),this.currencyEnum=S.h,this.form=this.fb.group({subscribe:[{value:this.data.subscribe,disabled:!0}],amount:[this.data.amount,p.k0.required],currency:[{value:this.currencyEnum[this.data.currency??1],disabled:!0}]})}onFileChange(e){const i=e.target;i.files&&i.files.length&&(this.receiptFile=i.files[0])}confirm(){this.submitUpdate(!0,!1)}cancel(){this.submitUpdate(!1,!0)}submitUpdate(e,i){const a={id:this.data.invoiceId,amount:this.form.get("amount")?.value??void 0,payStatue:e,isCancelled:i};(this.receiptFile?(0,A.of)(this.receiptFile):this.service.downloadPaymentReceipt(this.data.invoiceId).pipe((0,Z.T)(l=>this.toReceiptFile(l)),(0,X.W)(l=>(console.error("Failed to load receipt PDF for payment update.",l),(0,A.of)(void 0))))).pipe((0,Q.n)(l=>this.service.updatePayment(a,l))).subscribe({next:()=>this.dialogRef.close(!0),error:l=>console.error("Failed to update payment status with receipt attachment.",l)})}toReceiptFile(e){if(!e||0===e.size)return;const i=e.type&&""!==e.type?e.type:"application/pdf",a=(new Date).toISOString().split("T")[0],m=`payment-receipt-${this.data.invoiceId}-${a}.pdf`;try{return new File([e],m,{type:i})}catch(l){return void console.error("Failed to construct receipt file from blob.",l)}}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-payment-edit"]],decls:23,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content","",3,"formGroup"],["appearance","outline",1,"w-100"],["matInput","","formControlName","subscribe"],["matInput","","type","number","formControlName","amount"],["matInput","","formControlName","currency"],["type","file",3,"change"],["mat-dialog-actions","","align","end"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(i,a){1&i&&(t.j41(0,"h2",0),t.EFF(1,"Edit Payment"),t.k0s(),t.j41(2,"div",1)(3,"mat-form-field",2)(4,"mat-label"),t.EFF(5,"Subscribe"),t.k0s(),t.nrm(6,"input",3),t.k0s(),t.j41(7,"mat-form-field",2)(8,"mat-label"),t.EFF(9,"Amount"),t.k0s(),t.nrm(10,"input",4),t.k0s(),t.j41(11,"mat-form-field",2)(12,"mat-label"),t.EFF(13,"Currency"),t.k0s(),t.nrm(14,"input",5),t.k0s(),t.j41(15,"input",6),t.bIt("change",function(l){return a.onFileChange(l)}),t.k0s()(),t.j41(16,"div",7)(17,"button",8),t.bIt("click",function(){return a.confirm()}),t.EFF(18,"Confirm Payment"),t.k0s(),t.j41(19,"button",9),t.bIt("click",function(){return a.cancel()}),t.EFF(20,"Cancel Payment"),t.k0s(),t.j41(21,"button",10),t.EFF(22,"Exit"),t.k0s()()),2&i&&(t.R7$(2),t.Y8G("formGroup",a.form))},dependencies:[M.MD,g.l,g.a,g.b,g.M,g.c,w.Hl,w.$z,U.M,T.j,T.M,$.fS,$.fg,p.X1,p.me,p.Q0,p.BC,p.cb,p.j4,p.JD],encapsulation:2})}return n})();var H=o(75747),B=o(68018);const z=()=>[5,10,25,100];function K(n,c){1&n&&(t.j41(0,"th",21),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Invoice ID")))}function q(n,c){if(1&n&&(t.j41(0,"td",22),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.JRh(e.id)}}function tt(n,c){1&n&&(t.j41(0,"th",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Student")))}function et(n,c){if(1&n&&(t.j41(0,"td",24),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.SpI(" ",e.name," ")}}function nt(n,c){1&n&&(t.j41(0,"th",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Create Date")))}function at(n,c){if(1&n&&(t.j41(0,"td",24),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.JRh(e.create_date)}}function it(n,c){1&n&&(t.j41(0,"th",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Due Date")))}function st(n,c){if(1&n&&(t.j41(0,"td",24),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.JRh(e.due_date)}}function ot(n,c){1&n&&(t.j41(0,"th",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Quantity")))}function rt(n,c){if(1&n&&(t.j41(0,"td",24),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.JRh(e.qty)}}function lt(n,c){1&n&&(t.j41(0,"th",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Status")))}function ct(n,c){1&n&&(t.j41(0,"span",25),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Paid")))}function dt(n,c){1&n&&(t.j41(0,"span",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Unpaid")))}function ht(n,c){1&n&&(t.j41(0,"span",27),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Overdue")))}function ut(n,c){1&n&&(t.j41(0,"span",27),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Cancelled")))}function mt(n,c){if(1&n&&(t.j41(0,"td",24),t.nVh(1,ct,3,3,"span",25)(2,dt,3,3,"span",26)(3,ht,3,3,"span",27)(4,ut,3,3,"span",27),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.vxM("paid"===e.status?1:"unpaid"===e.status?2:"overdue"===e.status?3:"cancelled"===e.status?4:-1)}}function pt(n,c){1&n&&(t.j41(0,"th",28),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"Actions")))}function ft(n,c){if(1&n){const e=t.RV6();t.j41(0,"li",30)(1,"a",33),t.nI1(2,"translate"),t.bIt("click",function(){r.eBV(e);const a=t.XpG().$implicit,m=t.XpG();return r.Njj(m.openPaymentEdit(a.id))}),t.nrm(3,"i",34),t.k0s()()}2&n&&(t.R7$(),t.Y8G("matTooltip",t.bMT(2,1,"Edit")))}function vt(n,c){if(1&n){const e=t.RV6();t.j41(0,"td",24)(1,"ul",29)(2,"li",30)(3,"a",31),t.nI1(4,"translate"),t.bIt("click",function(){const a=r.eBV(e).$implicit,m=t.XpG();return r.Njj(m.openPaymentDetails(a.id))}),t.nrm(5,"i",32),t.k0s()(),t.nVh(6,ft,4,3,"li",30),t.k0s()()}if(2&n){const e=c.$implicit;t.R7$(3),t.Y8G("matTooltip",t.bMT(4,2,"View")),t.R7$(3),t.vxM("unpaid"===e.status?6:-1)}}function gt(n,c){1&n&&t.nrm(0,"tr",35)}function bt(n,c){1&n&&t.nrm(0,"tr",36)}let Ct=(()=>{class n{constructor(){this.search="",this.countChange=new t.bkB,this.studentPaymentService=(0,r.WQX)(S.N),this.dialog=(0,r.WQX)(g.h),this.displayedColumns=["id","name","create_date","due_date","qty","status","action"],this.dataSource=new f.I6([]),this.searchTerm="",this.paginator=C.ebz.required(I.iy),this.sort=(0,C.ebz)(R.B4)}ngOnInit(){this.dataSource.filterPredicate=(e,i)=>{const a=i.trim().toLowerCase();return e.id.toString().includes(a)||e.name.toLowerCase().includes(a)||e.create_date.toLowerCase().includes(a)||e.due_date.toLowerCase().includes(a)||e.qty.toString().includes(a)||e.status.toLowerCase().includes(a)},this.searchTerm=this.search,this.loadData()}ngOnChanges(e){(e.tab||e.month||e.compareMonth)&&this.loadData(),e.search&&!e.search.firstChange&&(this.searchTerm=this.search,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.dataSource.filteredData.length))}applyFilter(e){this.searchTerm=e.target.value,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.dataSource.filteredData.length)}openPaymentDetails(e){this.studentPaymentService.getPayment(e).subscribe(i=>{i.isSuccess&&i.data&&this.dialog.open(J.i,{data:i.data})})}openPaymentEdit(e){this.studentPaymentService.getPayment(e).subscribe(i=>{i.isSuccess&&i.data&&this.dialog.open(W,{data:i.data})})}loadData(){const e={skipCount:0,maxResultCount:100};let i,a;this.month&&(i=new Date(this.month+"-01")),this.compareMonth&&(a=new Date(this.compareMonth+"-01"));const m=l=>l.data.items.map(h=>({id:h.invoiceId,name:h.userName??"",create_date:h.createDate??"",due_date:h.dueDate??"",qty:h.amount??0,status:(h.statusText??"").toLowerCase(),payStatue:h.payStatue??!1,isCancelled:h.isCancelled??!1}));if(this.tab&&"all"!==this.tab){const l=[];i&&l.push(this.studentPaymentService.getInvoices(e,this.tab,void 0,void 0,void 0,void 0,void 0,i)),a&&l.push(this.studentPaymentService.getInvoices(e,this.tab,void 0,void 0,void 0,void 0,void 0,a)),(0,Y.p)(l).subscribe(h=>{const b=h.reduce((P,L)=>[...P,...m(L)],[]);this.dataSource.data=b,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.dataSource.filteredData.length)})}else{const l=[];i&&(l.push(this.studentPaymentService.getInvoices(e,void 0,void 0,void 0,void 0,void 0,void 0,i)),l.push(this.studentPaymentService.getInvoices(e,"overdue",void 0,void 0,void 0,void 0,void 0,i))),a&&(l.push(this.studentPaymentService.getInvoices(e,void 0,void 0,void 0,void 0,void 0,void 0,a)),l.push(this.studentPaymentService.getInvoices(e,"overdue",void 0,void 0,void 0,void 0,void 0,a))),(0,Y.p)(l).subscribe(h=>{const b=h.reduce((P,L)=>[...P,...m(L)],[]);this.dataSource.data=b,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.dataSource.filteredData.length)})}}ngAfterViewInit(){this.dataSource.paginator=this.paginator(),this.dataSource.sort=this.sort()}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-invoice-list-table"]],viewQuery:function(i,a){1&i&&(t.wEZ(a.paginator,I.iy,5),t.wEZ(a.sort,R.B4,5)),2&i&&t.NyB(2)},inputs:{tab:"tab",month:"month",compareMonth:"compareMonth",search:"search"},outputs:{countChange:"countChange"},features:[t.OA$],decls:32,vars:12,consts:[["input",""],[1,"table-responsive"],[1,"table-search","p-t-20","p-x-20"],["appearance","outline",1,"w-100"],["matInput","",3,"keyup","placeholder","value"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap text-center",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","create_date"],["matColumnDef","due_date"],["matColumnDef","qty"],["matColumnDef","status"],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header","",1,"text-center"],["mat-cell","",1,"text-nowrap","text-center"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"text-nowrap"],[1,"user-status","bg-success-500","text-white"],[1,"user-status","bg-cyan-500","text-white"],[1,"user-status","bg-warn-500","text-white"],["mat-header-cell",""],[1,"list-inline","m-b-0"],[1,"list-inline-item"],["href","javascript:",1,"avatar","avatar-xs","bg-accent-100","hover","m-r-10",3,"click","matTooltip"],[1,"f-20","ti","ti-eye","text-accent-500"],["href","javascript:",1,"avatar","avatar-xs","bg-primary-50","hover","m-r-10",3,"click","matTooltip"],[1,"f-20","ti","ti-edit","text-primary-500"],["mat-header-row",""],["mat-row",""]],template:function(i,a){if(1&i){const m=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"mat-form-field",3)(3,"input",4,0),t.nI1(5,"translate"),t.bIt("keyup",function(h){return r.eBV(m),r.Njj(a.applyFilter(h))}),t.k0s()()(),t.j41(6,"table",5),t.qex(7,6),t.DNE(8,K,3,3,"th",7)(9,q,2,1,"td",8),t.bVm(),t.qex(10,9),t.DNE(11,tt,3,3,"th",10)(12,et,2,1,"td",11),t.bVm(),t.qex(13,12),t.DNE(14,nt,3,3,"th",10)(15,at,2,1,"td",11),t.bVm(),t.qex(16,13),t.DNE(17,it,3,3,"th",10)(18,st,2,1,"td",11),t.bVm(),t.qex(19,14),t.DNE(20,ot,3,3,"th",10)(21,rt,2,1,"td",11),t.bVm(),t.qex(22,15),t.DNE(23,lt,3,3,"th",10)(24,mt,5,1,"td",11),t.bVm(),t.qex(25,16),t.DNE(26,pt,3,3,"th",17)(27,vt,7,4,"td",11),t.bVm(),t.DNE(28,gt,1,0,"tr",18)(29,bt,1,0,"tr",19),t.k0s(),t.nrm(30,"mat-paginator",20),t.nI1(31,"translate"),t.k0s()}2&i&&(t.R7$(3),t.Y8G("placeholder",t.bMT(5,7,"Search..."))("value",a.searchTerm),t.R7$(3),t.Y8G("dataSource",a.dataSource),t.R7$(22),t.Y8G("matHeaderRowDef",a.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumns),t.R7$(),t.Y8G("pageSizeOptions",t.lJ4(11,z)),t.BMQ("aria-label",t.bMT(31,9,"Select page of users")))},dependencies:[j.G,$.fg,T.j,I.iy,H.e,f.Zl,f.tL,f.ji,f.cC,f.YV,f.iL,f.KS,f.$R,f.YZ,f.NB,B.D9],styles:[".bg-cyan-500[_ngcontent-%COMP%]{background:#3ec9d6}"]})}return n})();var It=o(67575),x=o(96850),O=o(25084),Tt=o(16735);function Ft(n,c){if(1&n&&(t.j41(0,"div",11)(1,"app-card",39)(2,"div",40)(3,"div",41),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p",42),t.nrm(7,"i"),t.EFF(8),t.k0s()(),t.j41(9,"div",43)(10,"div",44)(11,"div",45),t.EFF(12),t.k0s(),t.j41(13,"div",46)(14,"div",47),t.EFF(15),t.k0s(),t.j41(16,"p",48),t.EFF(17),t.nI1(18,"translate"),t.k0s()()(),t.j41(19,"div",44),t.nrm(20,"app-invoice-list-chart",49),t.k0s()()()()),2&n){const e=c.$implicit;t.R7$(),t.Y8G("showHeader",!1)("padding",20),t.R7$(3),t.JRh(t.bMT(5,13,e.title)),t.R7$(3),t.HbH(t.ai1("f-14 ti ti-",!0===e.isLoss?"caret-down-filled":"caret-up-filled"," ",e.color)),t.R7$(),t.SpI(" ",e.percentage,"% "),t.R7$(4),t.JRh(e.value),t.R7$(3),t.JRh(e.invoice),t.R7$(2),t.JRh(t.bMT(18,15,"Invoices")),t.R7$(3),t.Y8G("seriesData",e.data)("colors",e.colors)}}function Rt(n,c){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.j41(3,"div",50),t.EFF(4),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,2,"All")," "),t.R7$(3),t.SpI(" ",e.tabCounts.all," ")}}function yt(n,c){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.j41(3,"div",51),t.EFF(4),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,2,"Paid")," "),t.R7$(3),t.SpI(" ",e.tabCounts.paid," ")}}function Mt(n,c){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.j41(3,"div",52),t.EFF(4),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,2,"Unpaid")," "),t.R7$(3),t.SpI(" ",e.tabCounts.unpaid," ")}}function _t(n,c){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.j41(3,"div",53),t.EFF(4),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,2,"Overdue")," "),t.R7$(3),t.SpI(" ",e.tabCounts.overdue," ")}}function Dt(n,c){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.j41(3,"div",53),t.EFF(4),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,2,"Cancelled")," "),t.R7$(3),t.SpI(" ",e.tabCounts.cancelled," ")}}const jt=k()||_,G={parse:{dateInput:"MMMM YYYY"},display:{dateInput:"MMMM YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let Et=(()=>{class n{constructor(){this.studentPaymentService=(0,r.WQX)(S.N),this.route=(0,r.WQX)(D.nX),this.dataMonth=new p.MJ(jt().startOf("month").utc(!0)),this.compareMonth=new p.MJ(null),this.widgetCards=[],this.bigCard={currentReceivables:0,overdueReceivables:0,totalReceivables:0,collectionRate:0},this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0},this.searchTerm=""}ngOnInit(){this.searchTerm=this.route.snapshot.queryParamMap.get("search")??"",this.route.queryParamMap.subscribe(e=>{this.searchTerm=e.get("search")??""}),this.loadDashboard()}setDataMonthAndYear(e,i){this.dataMonth.setValue(e.clone().startOf("month").utc(!0)),i.close(),this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0},this.loadDashboard()}setCompareMonthAndYear(e,i){this.compareMonth.setValue(e.clone().startOf("month").utc(!0)),i.close(),this.loadDashboard()}onTableCount(e,i){this.tabCounts[e]=i,"all"!==e&&(this.tabCounts.all=this.tabCounts.paid+this.tabCounts.unpaid+this.tabCounts.overdue+this.tabCounts.cancelled)}loadDashboard(){const e=this.dataMonth.value?.toDate(),i=this.compareMonth.value?.toDate();this.studentPaymentService.getDashboard(void 0,void 0,e,i).subscribe(a=>{const m=this.getTrend(a.totalPaidMoMPercentage),l=this.getTrend(a.totalUnPaidMoMPercentage),h=this.getTrend(a.totalOverdueMoMPercentage);this.widgetCards=[{title:"Paid",value:`$${a.totalPaid}`,percentage:a.totalPaidMoMPercentage,invoice:a.totalPaidCount,data:a.paidChart??[],colors:["#2ca87f"],...m},{title:"Unpaid",value:`$${a.totalUnPaid}`,percentage:a.totalUnPaidMoMPercentage,invoice:a.totalUnPaidCount,data:a.unpaidChart??[],colors:["#e58a00"],...l},{title:"Overdue",value:`$${a.totalOverdue}`,percentage:a.totalOverdueMoMPercentage,invoice:a.totalOverdueCount,data:a.overdueChart??[],colors:["#dc2626"],...h}],this.bigCard={currentReceivables:a.currentReceivables,overdueReceivables:a.overdueReceivables,totalReceivables:a.totalReceivables,collectionRate:a.collectionRate}})}getTrend(e){const i=e<0;return{isLoss:i,color:i?"text-warn-500":"text-success-500"}}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-invoice-list"]],features:[t.Jv_([{provide:F.D,useClass:u.QH,deps:[F.M,u.ij]},{provide:F.a,useValue:G}])],decls:78,vars:40,consts:[["dataPicker",""],["comparePicker",""],[1,"row"],[1,"col-12","mb-3","text-end"],[1,"flex","gap-2","justify-content-end"],["appearance","outline"],["matInput","",3,"matDatepicker","formControl"],["matIconSuffix","",3,"for"],["startView","multi-year","panelClass","example-month-picker",3,"monthSelected"],[1,"col-xxl-8"],[1,"row","g-3","mb-3"],[1,"col-md-6","col-lg-4"],[1,"col-xxl-4"],["cardClass","bg-primary-500",3,"showHeader","padding"],[1,"flex","align-item-center","justify-content-between"],[1,"flex","align-item-center"],[1,"avatar","avatar-s","bg-primary-400"],[1,"ti","ti-file-text","f-20","text-white"],[1,"m-l-10"],[1,"m-b-0","text-white"],[1,"ti","ti-info-circle","text-white","m-l-10"],[1,"m-b-0","text-white","text-sm"],[1,"m-b-0","text-white","m-l-10"],[1,"flex"],[1,"m-t-15","text-white","f-16","f-w-600","m-b-5"],[1,"flex-grow-1","m-r-15"],["color","warn","mode","determinate",3,"value"],[1,"flex-shrink-0","text-end","wid-30"],[1,"text-white","m-b-0"],[1,"col-12"],[3,"showHeader","padding"],["mat-stretch-tabs","false","mat-align-tabs","start",1,"invoice-data"],["mat-tab-label",""],[1,"p-y-20"],[3,"countChange","month","search"],["tab","paid",3,"countChange","month","search"],["tab","unpaid",3,"countChange","month","search"],["tab","overdue",3,"countChange","month","search"],["tab","cancelled",3,"countChange","month","search"],["cardClass","m-b-0",3,"showHeader","padding"],[1,"m-b-10","flex","align-item-center","justify-content-between","gap-1"],[1,"f-w-600"],[1,"m-b-0","text-muted","flex","align-item-center","gap-1"],[1,"row","g-2","align-item-center"],[1,"col-6"],[1,"f-w-600","f-16","m-b-5","m-t-15"],[1,"flex","align-item-center","gap-1"],[1,"m-b-0","f-16","f-w-600"],[1,"m-b-0","text-muted","flex","align-item-center","gap-2"],[3,"seriesData","colors"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-primary-50","text-primary-500","m-l-10"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-success-50","text-success-500","m-l-10"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-warning-50","text-warning-500","m-l-10"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-warn-50","text-warn-500","m-l-10"]],template:function(i,a){if(1&i){const m=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"mat-form-field",5)(4,"mat-label"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.nrm(7,"input",6)(8,"mat-datepicker-toggle",7),t.j41(9,"mat-datepicker",8,0),t.bIt("monthSelected",function(h){r.eBV(m);const b=t.sdS(10);return r.Njj(a.setDataMonthAndYear(h,b))}),t.k0s()(),t.j41(11,"mat-form-field",5)(12,"mat-label"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.nrm(15,"input",6)(16,"mat-datepicker-toggle",7),t.j41(17,"mat-datepicker",8,1),t.bIt("monthSelected",function(h){r.eBV(m);const b=t.sdS(18);return r.Njj(a.setCompareMonthAndYear(h,b))}),t.k0s()()()(),t.j41(19,"div",9)(20,"div",10),t.Z7z(21,Ft,21,17,"div",11,t.fX1),t.k0s()(),t.j41(23,"div",12)(24,"app-card",13)(25,"div",14)(26,"div",15)(27,"div",16),t.nrm(28,"i",17),t.k0s(),t.j41(29,"div",18)(30,"div",15)(31,"p",19),t.EFF(32),t.nI1(33,"translate"),t.k0s(),t.nrm(34,"i",20),t.k0s(),t.j41(35,"div",15)(36,"p",21),t.EFF(37),t.nI1(38,"translate"),t.k0s(),t.j41(39,"p",22),t.EFF(40),t.k0s()()()(),t.j41(41,"div",23)(42,"p",21),t.EFF(43),t.nI1(44,"translate"),t.k0s(),t.j41(45,"p",22),t.EFF(46),t.k0s()()(),t.j41(47,"div",24),t.EFF(48),t.k0s(),t.j41(49,"div",15)(50,"div",25),t.nrm(51,"mat-progress-bar",26),t.k0s(),t.j41(52,"div",27)(53,"p",28),t.EFF(54),t.k0s()()()()(),t.j41(55,"div",29)(56,"app-card",30)(57,"mat-tab-group",31)(58,"mat-tab"),t.DNE(59,Rt,5,4,"ng-template",32),t.j41(60,"div",33)(61,"app-invoice-list-table",34),t.bIt("countChange",function(h){return r.eBV(m),r.Njj(a.onTableCount("all",h))}),t.k0s()()(),t.j41(62,"mat-tab"),t.DNE(63,yt,5,4,"ng-template",32),t.j41(64,"div",33)(65,"app-invoice-list-table",35),t.bIt("countChange",function(h){return r.eBV(m),r.Njj(a.onTableCount("paid",h))}),t.k0s()()(),t.j41(66,"mat-tab"),t.DNE(67,Mt,5,4,"ng-template",32),t.j41(68,"div",33)(69,"app-invoice-list-table",36),t.bIt("countChange",function(h){return r.eBV(m),r.Njj(a.onTableCount("unpaid",h))}),t.k0s()()(),t.j41(70,"mat-tab"),t.DNE(71,_t,5,4,"ng-template",32),t.j41(72,"div",33)(73,"app-invoice-list-table",37),t.bIt("countChange",function(h){return r.eBV(m),r.Njj(a.onTableCount("overdue",h))}),t.k0s()()(),t.j41(74,"mat-tab"),t.DNE(75,Dt,5,4,"ng-template",32),t.j41(76,"div",33)(77,"app-invoice-list-table",38),t.bIt("countChange",function(h){return r.eBV(m),r.Njj(a.onTableCount("cancelled",h))}),t.k0s()()()()()()()}if(2&i){const m=t.sdS(10),l=t.sdS(18);t.R7$(5),t.JRh(t.bMT(6,30,"Month")),t.R7$(2),t.Y8G("matDatepicker",m)("formControl",a.dataMonth),t.R7$(),t.Y8G("for",m),t.R7$(5),t.JRh(t.bMT(14,32,"Compare Month")),t.R7$(2),t.Y8G("matDatepicker",l)("formControl",a.compareMonth),t.R7$(),t.Y8G("for",l),t.R7$(5),t.Dyx(a.widgetCards),t.R7$(3),t.Y8G("showHeader",!1)("padding",14),t.R7$(8),t.JRh(t.bMT(33,34,"Total Receivables")),t.R7$(5),t.JRh(t.bMT(38,36,"Current")),t.R7$(3),t.JRh(a.bigCard.currentReceivables),t.R7$(3),t.JRh(t.bMT(44,38,"Overdue")),t.R7$(3),t.JRh(a.bigCard.overdueReceivables),t.R7$(2),t.SpI("$",a.bigCard.totalReceivables),t.R7$(3),t.Y8G("value",a.bigCard.collectionRate),t.R7$(3),t.SpI("",a.bigCard.collectionRate,"%"),t.R7$(2),t.Y8G("showHeader",!1)("padding",0),t.R7$(5),t.Y8G("month",null==a.dataMonth.value?null:a.dataMonth.value.format("YYYY-MM"))("search",a.searchTerm),t.R7$(4),t.Y8G("month",null==a.dataMonth.value?null:a.dataMonth.value.format("YYYY-MM"))("search",a.searchTerm),t.R7$(4),t.Y8G("month",null==a.dataMonth.value?null:a.dataMonth.value.format("YYYY-MM"))("search",a.searchTerm),t.R7$(4),t.Y8G("month",null==a.dataMonth.value?null:a.dataMonth.value.format("YYYY-MM"))("search",a.searchTerm),t.R7$(4),t.Y8G("month",null==a.dataMonth.value?null:a.dataMonth.value.format("YYYY-MM"))("search",a.searchTerm)}},dependencies:[j.G,$.fg,T.j,T.M,T.g,It.HM,x.ES,x.mq,x.T8,O.Vh,O.bZ,O.bU,p.me,p.BC,p.l_,Tt.i,B.D9,M.MD,E,Ct],styles:[".invoice-data .mat-mdc-tab-header{padding:20px 20px 0;border-bottom:1px solid var(--accent-300)}"]})}return n})()}}]);