"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[2806],{2806:(st,I,c)=>{c.r(I),c.d(I,{TeacherSalaryModule:()=>Me});var M=c(8132),y=c(8937),C=c(467),b=c(2200),T=c(9330),l=c(8728),g=c(9417),f=c(645),R=c(882),F=c(5084),k=c(7356),w=c(5263),U=c(1997),B=c(1074),Y=c(8834),J=c(5596),lt=c(6751),z=c(3746),H=c(3791),X=c(9183),Q=c(7575),W=c(5747),ct=c(7586),mt=c.n(ct),K=c(450),dt=c(8359),ut=c(7673),ht=c(152),Z=c(3294),v=c(980),q=c(6354),pt=c(5558),A=c(2525);let ft=(()=>{class r{constructor(){this.http=(0,l.WQX)(T.Qq),this.baseUrl=`${A.c.apiUrl}/admin/teacher-salary`}getInvoices(e,n){let a=new T.Nl;return e&&(a=a.set("month",e)),n&&(a=a.set("teacherId",n.toString())),this.http.get(`${this.baseUrl}/invoices`,{params:a})}getInvoiceDetails(e){return this.http.get(`${this.baseUrl}/invoices/${e}/details`)}updatePayment(e){return this.http.post(`${A.c.apiUrl}/api/TeacherSallary/UpdatePayment`,(()=>{const i=new FormData;return Object.entries(e).forEach(([o,d])=>{null!=d&&i.append(o,String(d))}),i})())}uploadInvoiceReceipt(e,n,a){const i=new FormData;return i.append("invoiceId",e.toString()),i.append("receipt",n.file,n.fileName),a&&Object.entries(a).forEach(([o,d])=>{null!=d&&i.append(o,String(d))}),this.http.post(`${this.baseUrl}/invoices/${e}/receipt`,i)}getMonthlySummary(e,n){let a=new T.Nl;return e&&(a=a.set("month",e)),n&&(a=a.set("teacherId",n.toString())),this.http.get(`${this.baseUrl}/monthly-summary`,{params:a})}generateMonthly(e){let n=new T.Nl;return e&&(n=n.set("month",e)),this.http.post(`${this.baseUrl}/generate`,{},{params:n})}static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275prov=l.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var gt=c(7509),yt=c(6848),bt=c(5366),tt=c(8018),vt=c(7753),t=c(3664),St=c(9010),j=c(4507),Ct=c(5079);const _t=["loadMoreTrigger"],Mt=["detailDrawer"],et=(r,s)=>s.label,Tt=(r,s)=>s.id;function xt(r,s){if(1&r&&(t.j41(0,"p",9),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.SpI(" ",(null==e.selectedInvoice?null:e.selectedInvoice.teacherName)??(null==e.detailSummary?null:e.detailSummary.teacherName)," ")}}function It(r,s){1&r&&(t.j41(0,"div",11),t.nrm(1,"mat-progress-spinner",54),t.k0s())}function Rt(r,s){if(1&r&&(t.EFF(0),t.nI1(1,"date")),2&r){const e=t.XpG(2);t.SpI(" ",t.i5U(1,1,null==e.selectedInvoice?null:e.selectedInvoice.payedAt,"medium")," ")}}function Ft(r,s){1&r&&t.EFF(0," \u2014 ")}function Pt(r,s){if(1&r&&(t.j41(0,"a",60),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r){const e=t.XpG(2);t.Y8G("href",e.getReceiptUrl(e.selectedInvoice),t.B4B),t.R7$(),t.SpI(" ",t.bMT(2,2,"View Receipt")," ")}}function $t(r,s){1&r&&t.EFF(0," \u2014 ")}function Et(r,s){if(1&r&&(t.j41(0,"div",63)(1,"span",64),t.EFF(2),t.k0s(),t.j41(3,"span",65),t.EFF(4),t.k0s()()),2&r){const e=s.$implicit,n=t.XpG(3);t.R7$(2),t.JRh(e.label),t.R7$(2),t.JRh(n.formatMetricValue(e))}}function Nt(r,s){if(1&r&&(t.j41(0,"div",62),t.Z7z(1,Et,5,2,"div",63,et),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.Dyx(e.detailSummaryMetrics)}}function kt(r,s){1&r&&(t.j41(0,"p",47),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"No Summary Data For Invoice")))}function wt(r,s){if(1&r&&(t.j41(0,"div",55)(1,"h4"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",56)(5,"div",57)(6,"span",58),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"span",59),t.EFF(10),t.k0s()(),t.j41(11,"div",57)(12,"span",58),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"span",59),t.EFF(16),t.k0s()(),t.j41(17,"div",57)(18,"span",58),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"span",59),t.EFF(22),t.k0s()(),t.j41(23,"div",57)(24,"span",58),t.EFF(25),t.nI1(26,"translate"),t.k0s(),t.j41(27,"span",59),t.nVh(28,Rt,2,4)(29,Ft,1,0),t.k0s()(),t.j41(30,"div",57)(31,"span",58),t.EFF(32),t.nI1(33,"translate"),t.k0s(),t.j41(34,"span",59),t.nVh(35,Pt,3,4,"a",60)(36,$t,1,0),t.k0s()()()(),t.nrm(37,"mat-divider"),t.j41(38,"div",55)(39,"div",61)(40,"h4"),t.EFF(41),t.nI1(42,"translate"),t.k0s()(),t.nVh(43,Nt,3,0,"div",62)(44,kt,3,3,"p",47),t.k0s()),2&r){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,13,"Invoice")),t.R7$(5),t.JRh(t.bMT(8,15,"Month")),t.R7$(3),t.JRh(e.formatMonth(e.selectedInvoice)),t.R7$(3),t.JRh(t.bMT(14,17,"Salary")),t.R7$(3),t.JRh(e.formatSalary(e.selectedInvoice)),t.R7$(3),t.JRh(t.bMT(20,19,"Status")),t.R7$(3),t.JRh(e.getStatusLabel(e.selectedInvoice)),t.R7$(3),t.JRh(t.bMT(26,21,"Paid At")),t.R7$(3),t.vxM(null!=e.selectedInvoice&&e.selectedInvoice.payedAt?28:29),t.R7$(4),t.JRh(t.bMT(33,23,"Receipt")),t.R7$(3),t.vxM(e.selectedInvoice&&e.getReceiptUrl(e.selectedInvoice)?35:36),t.R7$(6),t.JRh(t.bMT(42,25,"Monthly Summary")),t.R7$(2),t.vxM(e.detailSummaryMetrics.length>0?43:44)}}function At(r,s){1&r&&(t.j41(0,"div",12)(1,"p"),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&r&&(t.R7$(2),t.JRh(t.bMT(3,1,"Select Invoice Prompt")))}function jt(r,s){if(1&r){const e=t.RV6();t.j41(0,"button",66),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.onGenerateMonthly())}),t.j41(1,"mat-icon"),t.EFF(2,"cached"),t.k0s(),t.EFF(3),t.nI1(4,"translate"),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("disabled",e.manualGenerationLoading),t.R7$(3),t.SpI(" ",t.bMT(4,2,"Generate Monthly Invoices")," ")}}function Dt(r,s){if(1&r&&(t.j41(0,"mat-card",16)(1,"div",67)(2,"div",68),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",69)(6,"span")(7,"strong"),t.EFF(8),t.k0s(),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.j41(11,"span")(12,"strong"),t.EFF(13),t.k0s(),t.EFF(14),t.nI1(15,"translate"),t.k0s(),t.j41(16,"span")(17,"strong"),t.EFF(18),t.k0s(),t.EFF(19),t.nI1(20,"translate"),t.k0s()()()()),2&r){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,7,"Last Generation Summary")),t.R7$(5),t.JRh((null==e.generationResult?null:e.generationResult.createdCount)??0),t.R7$(),t.SpI(" ",t.bMT(10,9,"Created")),t.R7$(4),t.JRh((null==e.generationResult?null:e.generationResult.updatedCount)??0),t.R7$(),t.SpI(" ",t.bMT(15,11,"Updated")),t.R7$(4),t.JRh((null==e.generationResult?null:e.generationResult.skippedCount)??0),t.R7$(),t.SpI(" ",t.bMT(20,13,"Skipped"))}}function Ot(r,s){if(1&r&&(t.j41(0,"mat-option",72),t.EFF(1),t.k0s()),2&r){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.fullName)}}function Gt(r,s){1&r&&t.nrm(0,"mat-progress-spinner",73)}function Vt(r,s){if(1&r){const e=t.RV6();t.j41(0,"button",78),t.bIt("click",function(){l.eBV(e);const a=t.XpG(2);return l.Njj(a.clearTeacherSearch())}),t.j41(1,"mat-icon"),t.EFF(2,"close"),t.k0s()()}if(2&r){const e=t.XpG(2);t.Y8G("disabled",e.teacherLoading)}}function Lt(r,s){if(1&r){const e=t.RV6();t.j41(0,"mat-form-field",70)(1,"mat-label"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"mat-select",71)(5,"mat-option",72),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.Z7z(8,Ot,2,2,"mat-option",72,Tt),t.k0s(),t.nVh(10,Gt,1,0,"mat-progress-spinner",73),t.k0s(),t.j41(11,"mat-form-field",74)(12,"mat-label"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.nrm(15,"input",75),t.nI1(16,"translate"),t.nVh(17,Vt,3,1,"button",76),t.k0s(),t.j41(18,"button",77),t.bIt("click",function(){l.eBV(e);const a=t.XpG();return l.Njj(a.refreshTeachers())}),t.j41(19,"mat-icon"),t.EFF(20,"refresh"),t.k0s(),t.EFF(21),t.nI1(22,"translate"),t.k0s()}if(2&r){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,12,"Teacher")),t.R7$(2),t.Y8G("formControl",e.selectedTeacher)("disabled",e.teacherLoading),t.R7$(),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(7,14,"All Teachers")),t.R7$(2),t.Dyx(e.teachers),t.R7$(2),t.vxM(e.teacherLoading?10:-1),t.R7$(3),t.JRh(t.bMT(14,16,"Search Teacher")),t.R7$(2),t.Y8G("placeholder",t.bMT(16,18,"Search by name or email"))("formControl",e.teacherSearchControl),t.R7$(2),t.vxM(e.teacherSearchControl.value?17:-1),t.R7$(),t.Y8G("disabled",e.teacherLoading),t.R7$(3),t.SpI(" ",t.bMT(22,20,"Refresh")," ")}}function Ut(r,s){1&r&&(t.j41(0,"div",23)(1,"mat-icon"),t.EFF(2,"person"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()),2&r&&(t.R7$(4),t.JRh(t.bMT(5,1,"Teacher Context Message")))}function Bt(r,s){1&r&&t.nrm(0,"mat-progress-bar",25)}function Yt(r,s){1&r&&(t.j41(0,"th",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Teacher")))}function Jt(r,s){if(1&r&&(t.j41(0,"td",80)(1,"div",81),t.EFF(2),t.k0s()()),2&r){const e=s.$implicit;t.R7$(2),t.JRh(e.teacherName??"\u2014")}}function zt(r,s){1&r&&(t.j41(0,"th",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Month")))}function Ht(r,s){if(1&r&&(t.j41(0,"td",80),t.EFF(1),t.k0s()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.JRh(n.getMonthDisplay(e))}}function Xt(r,s){1&r&&(t.j41(0,"th",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Salary")))}function Qt(r,s){if(1&r&&(t.j41(0,"td",80),t.EFF(1),t.k0s()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.JRh(n.formatSalary(e))}}function Wt(r,s){1&r&&(t.j41(0,"th",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Status")))}function Kt(r,s){if(1&r&&(t.j41(0,"td",80)(1,"span",82)(2,"mat-icon"),t.EFF(3),t.k0s(),t.EFF(4),t.k0s()()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.AVh("status-paid",n.isInvoicePaid(e))("status-unpaid",!n.isInvoicePaid(e)),t.R7$(2),t.JRh(n.isInvoicePaid(e)?"check_circle":"hourglass_bottom"),t.R7$(),t.SpI(" ",n.getStatusLabel(e)," ")}}function Zt(r,s){1&r&&(t.j41(0,"th",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Paid At")))}function qt(r,s){if(1&r&&(t.EFF(0),t.nI1(1,"date")),2&r){const e=t.XpG().$implicit;t.SpI(" ",t.i5U(1,1,e.payedAt,"medium")," ")}}function te(r,s){1&r&&t.EFF(0," \u2014 ")}function ee(r,s){if(1&r&&(t.j41(0,"td",80),t.nVh(1,qt,2,4)(2,te,1,0),t.k0s()),2&r){const e=s.$implicit;t.R7$(),t.vxM(e.payedAt?1:2)}}function ae(r,s){1&r&&(t.j41(0,"th",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Receipt")))}function ne(r,s){if(1&r){const e=t.RV6();t.j41(0,"a",83),t.bIt("click",function(a){return l.eBV(e),l.Njj(a.stopPropagation())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&r){const e=t.XpG().$implicit,n=t.XpG();t.Y8G("href",n.getReceiptUrl(e),t.B4B),t.R7$(),t.SpI(" ",t.bMT(2,2,"View")," ")}}function re(r,s){1&r&&t.EFF(0," \u2014 ")}function ie(r,s){if(1&r&&(t.j41(0,"td",80),t.nVh(1,ne,3,4,"a",60)(2,re,1,0),t.k0s()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.vxM(n.getReceiptUrl(e)?1:2)}}function oe(r,s){1&r&&(t.j41(0,"th",84),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Invoice")," "))}function se(r,s){1&r&&(t.j41(0,"mat-icon",89),t.EFF(1,"autorenew"),t.k0s())}function le(r,s){1&r&&(t.j41(0,"mat-icon"),t.EFF(1,"print"),t.k0s())}function ce(r,s){if(1&r){const e=t.RV6();t.j41(0,"button",88),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(a){l.eBV(e);const i=t.XpG().$implicit,o=t.XpG();return l.Njj(o.onGenerateInvoiceReceipt(a,i))})("mousedown",function(a){return l.eBV(e),l.Njj(a.preventDefault())}),t.nVh(3,se,2,0,"mat-icon",89)(4,le,2,0,"mat-icon"),t.k0s()}if(2&r){const e=t.XpG().$implicit,n=t.XpG();t.Y8G("matTooltip",t.bMT(1,4,"Generate Invoice Tooltip"))("disabled",!n.isInvoicePaid(e)||n.isReceiptUploading(e.id)),t.BMQ("aria-label",t.bMT(2,6,"Generate Printable Invoice")),t.R7$(3),t.vxM(n.isReceiptUploading(e.id)?3:4)}}function me(r,s){if(1&r){const e=t.RV6();t.j41(0,"td",85),t.nVh(1,ce,5,8,"button",86),t.j41(2,"button",87),t.nI1(3,"translate"),t.nI1(4,"translate"),t.bIt("click",function(a){const i=l.eBV(e).$implicit,o=t.XpG();return l.Njj(o.onVodafoneCashTransfer(a,i))})("mousedown",function(a){return l.eBV(e),l.Njj(a.preventDefault())}),t.j41(5,"mat-icon"),t.EFF(6,"phone_iphone"),t.k0s()(),t.j41(7,"button",87),t.nI1(8,"translate"),t.nI1(9,"translate"),t.bIt("click",function(a){const i=l.eBV(e).$implicit,o=t.XpG();return l.Njj(o.onInstapayTransfer(a,i))})("mousedown",function(a){return l.eBV(e),l.Njj(a.preventDefault())}),t.j41(10,"mat-icon"),t.EFF(11,"account_balance_wallet"),t.k0s()()()}if(2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.vxM(n.canGenerateInvoices?1:-1),t.R7$(),t.Y8G("matTooltip",t.bMT(3,7,"Vodafone Cash Transfer"))("disabled",!n.canTransferVodafoneCash(e)),t.BMQ("aria-label",t.bMT(4,9,"Vodafone Cash Transfer")),t.R7$(5),t.Y8G("matTooltip",t.bMT(8,11,"Instapay Transfer"))("disabled",!n.canTransferInstapay(e)),t.BMQ("aria-label",t.bMT(9,13,"Instapay Transfer"))}}function de(r,s){1&r&&(t.j41(0,"th",90),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Paid Question")))}function ue(r,s){if(1&r){const e=t.RV6();t.j41(0,"td",91)(1,"mat-slide-toggle",92),t.bIt("click",function(a){return l.eBV(e),l.Njj(a.stopPropagation())})("change",function(a){const i=l.eBV(e).$implicit,o=t.XpG();return l.Njj(o.onTogglePaid(a,i))}),t.k0s()()}if(2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.Y8G("checked",n.isInvoicePaid(e))("disabled",n.isStatusUpdating(e.id))}}function he(r,s){1&r&&t.nrm(0,"tr",93)}function pe(r,s){if(1&r){const e=t.RV6();t.j41(0,"tr",94),t.bIt("click",function(){const a=l.eBV(e).$implicit,i=t.XpG();return l.Njj(i.openInvoice(a))}),t.k0s()}if(2&r){const e=s.$implicit,n=t.XpG();t.AVh("is-selected",(null==n.selectedInvoice?null:n.selectedInvoice.id)===e.id)}}function fe(r,s){1&r&&(t.j41(0,"div",47),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"No Invoices Found")))}function ge(r,s){1&r&&(t.j41(0,"div",52),t.nrm(1,"mat-progress-spinner",54),t.k0s())}function ye(r,s){if(1&r&&(t.j41(0,"div",95)(1,"span",64),t.EFF(2),t.k0s(),t.j41(3,"span",65),t.EFF(4),t.k0s()()),2&r){const e=s.$implicit,n=t.XpG(2);t.R7$(2),t.JRh(e.label),t.R7$(2),t.JRh(n.formatMetricValue(e))}}function be(r,s){if(1&r&&(t.j41(0,"div",53),t.Z7z(1,ye,5,2,"div",95,et),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.Dyx(e.summaryMetrics)}}function ve(r,s){1&r&&(t.j41(0,"div",47),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"No Summary Data For Month")))}const P="#134273",D="#f3f6fd",at="#dfe6f2",$="#5a5a5a",nt="#212121",Se={parse:{dateInput:"MMMM YYYY"},display:{dateInput:"MMMM YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};class O extends Error{constructor(s,e){super(s),this.apiErrors=e,this.name="InvoicePrintContextError"}}let rt=(()=>{class r{constructor(){this.teacherSalaryService=(0,l.WQX)(ft),this.toastService=(0,l.WQX)(gt.f),this.lookupService=(0,l.WQX)(yt.s),this.authenticationService=(0,l.WQX)(bt.k),this.apiBaseUrl=A.c.apiUrl.replace(/\/+$/,""),this.subscriptions=new dt.yU,this.numberFormatter=new Intl.NumberFormat("ar-EG",{maximumFractionDigits:0}),this.percentFormatter=new Intl.NumberFormat("ar-EG",{minimumFractionDigits:0,maximumFractionDigits:2}),this.currencyFormatter=new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2,maximumFractionDigits:2}),this.dateTimeFormatter=new Intl.DateTimeFormat("ar-EG",{dateStyle:"medium",timeStyle:"short"}),this.selectedMonth=new g.MJ(mt()().startOf("month").subtract(1,"month").utc(!0)),this.selectedTeacher=new g.MJ(null),this.teacherSearchControl=new g.MJ(""),this.dataSource=new f.I6([]),this.displayedColumns=[],this.totalCount=0,this.pageIndex=0,this.pageSize=10,this.isLoadingMore=!1,this.allInvoices=[],this.teachers=[],this.teacherLoading=!1,this.invoicesLoading=!1,this.summaryLoading=!1,this.detailsLoading=!1,this.manualGenerationLoading=!1,this.selectedInvoice=null,this.invoiceDetails=null,this.detailSummary=null,this.summary=null,this.summaryMetrics=[],this.detailSummaryMetrics=[],this.generationResult=null,this.updatingStatusIds=new Set,this.uploadingReceiptIds=new Set,this.role=this.authenticationService.getRole(),this.canManagePayments=this.role===y.m.Admin||this.role===y.m.Manager,this.canGenerateInvoices=this.role===y.m.Admin,this.isTeacher=this.role===y.m.Teacher}set loadMoreTrigger(e){this.loadMoreElement=e,this.setupIntersectionObserver()}get pageLoading(){return this.teacherLoading||this.invoicesLoading||this.summaryLoading||this.detailsLoading||this.manualGenerationLoading}ngOnInit(){this.updateDisplayedColumns(),this.canManagePayments&&(this.loadTeachers(),this.subscriptions.add(this.teacherSearchControl.valueChanges.pipe((0,ht.B)(300),(0,Z.F)()).subscribe(e=>{this.loadTeachers(e??"")}))),this.subscriptions.add(this.selectedTeacher.valueChanges.pipe((0,Z.F)()).subscribe(()=>{this.resetPaginator(),this.loadInvoices(),this.loadMonthlySummary()})),this.loadInvoices(),this.loadMonthlySummary()}ngOnDestroy(){this.intersectionObserver?.disconnect(),this.subscriptions.unsubscribe(),this.updatingStatusIds.clear(),this.uploadingReceiptIds.clear()}setMonth(e,n){const a=e.clone().startOf("month").utc(!0);this.selectedMonth.setValue(a),n.close(),this.resetPaginator(),this.loadInvoices(),this.loadMonthlySummary()}reloadAll(){this.loadInvoices(),this.loadMonthlySummary()}refreshTeachers(){this.canManagePayments&&this.loadTeachers(this.teacherSearchControl.value??"")}clearTeacherSearch(){this.canManagePayments&&(this.teacherSearchControl.setValue("",{emitEvent:!1}),this.loadTeachers(""))}openInvoice(e){e&&(this.selectedInvoice=e,this.loadInvoiceDetails(e.id))}closeDetails(){this.selectedInvoice=null,this.invoiceDetails=null,this.detailSummary=null,this.detailSummaryMetrics=[],this.detailDrawer?.close()}onDrawerClosed(){this.selectedInvoice=null,this.invoiceDetails=null,this.detailSummary=null,this.detailSummaryMetrics=[]}onTogglePaid(e,n){var a=this;e.source.checked=e.checked;const i=n.id;if(!i)return e.source.checked=!e.checked,void this.toastService.error("\u0645\u0639\u0631\u0641 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u063a\u064a\u0631 \u0635\u0627\u0644\u062d.");const o={...n},d=e.checked,h=this.buildUpdatePaymentPayload(n,d);var u;this.updatingStatusIds.add(i),this.teacherSalaryService.updatePayment(h).pipe((0,v.j)(()=>{this.updatingStatusIds.delete(i)})).subscribe({next:u=>{if(u.isSuccess){const p=this.mergeInvoiceData(o,this.extractInvoiceFromStatusResponse(u));this.toastService.success(`\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0625\u0644\u0649 ${d?"\u0645\u062f\u0641\u0648\u0639\u0629":"\u063a\u064a\u0631 \u0645\u062f\u0641\u0648\u0639\u0629"}.`),this.applyInvoiceUpdate(p),this.loadInvoices()}else e.source.checked=!d,this.handleErrors(u.errors,"\u0641\u0634\u0644 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u062f\u0641\u0639 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629.")},error:(u=(0,C.A)(function*(p){e.source.checked=!d,yield a.notifyHttpError(p,"\u0641\u0634\u0644 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u062f\u0641\u0639 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629.")}),function(_){return u.apply(this,arguments)})})}isStatusUpdating(e){return this.updatingStatusIds.has(e)}isReceiptUploading(e){return"number"==typeof e&&this.uploadingReceiptIds.has(e)}onGenerateInvoiceReceipt(e,n){var a=this;if(e.stopPropagation(),!this.canGenerateInvoices)return;const i=n.id;if(!i)return void this.toastService.error("\u0645\u0639\u0631\u0641 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u063a\u064a\u0631 \u0635\u0627\u0644\u062d.");if(this.isReceiptUploading(i))return;const o={...n},d={payStatue:!0,isCancelled:!1},h=this.getSalaryAmount(o);null!==h&&(d.amount=h),this.uploadingReceiptIds.add(i);const S=this.getInvoicePrintContext(i,o).pipe((0,q.T)(u=>this.createInvoicePrintArtifacts(u)),(0,pt.n)(u=>(this.presentInvoicePrint(u.html,u.fileName,u.blob),this.teacherSalaryService.uploadInvoiceReceipt(i,u.receipt,d))),(0,v.j)(()=>{this.uploadingReceiptIds.delete(i)})).subscribe({next:u=>{if(u.isSuccess){const p=this.mergeInvoiceData(o,this.extractInvoiceFromStatusResponse(u));this.applyInvoiceUpdate(p),this.toastService.success("\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629 \u0648\u0631\u0641\u0639\u0647\u0627 \u0628\u0646\u062c\u0627\u062d.")}else this.handleErrors(u.errors,"\u0641\u0634\u0644 \u0631\u0641\u0639 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629.")},error:(u=(0,C.A)(function*(p){p instanceof O?p.apiErrors?.length?a.handleErrors(p.apiErrors,"\u0641\u0634\u0644 \u0631\u0641\u0639 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629."):a.toastService.error(p.message||"\u0641\u0634\u0644 \u0631\u0641\u0639 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629."):p instanceof Error&&"PRINT_RENDER_FAILED"===p.message?a.toastService.error("\u062a\u0639\u0630\u0631 \u0625\u0646\u0634\u0627\u0621 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629."):yield a.notifyHttpError(p,"\u0641\u0634\u0644 \u0631\u0641\u0639 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629.")}),function(_){return u.apply(this,arguments)})});var u;this.subscriptions.add(S)}onVodafoneCashTransfer(e,n){if(e.stopPropagation(),e.preventDefault(),!this.canTransferVodafoneCash(n))return void this.toastService.error("\u062a\u0639\u0630\u0631 \u062a\u062c\u0647\u064a\u0632 \u062a\u062d\u0648\u064a\u0644 \u0641\u0648\u062f\u0627\u0641\u0648\u0646 \u0643\u0627\u0634 \u0628\u062f\u0648\u0646 \u0631\u0642\u0645 \u062c\u0648\u0627\u0644 \u0623\u0648 \u0645\u0628\u0644\u063a \u0635\u062d\u064a\u062d.");const a=this.formatTransferAmount(this.getSalaryAmount(n)),o=`*9*7*${this.normalizePhoneNumber(this.resolveTeacherMobile(n)??"")}*${a}#`,d=`tel:${this.encodeUssd(o)}`;window.location.href=d}onInstapayTransfer(e,n){if(e.stopPropagation(),e.preventDefault(),!this.canTransferInstapay(n))return void this.toastService.error("\u062a\u0639\u0630\u0631 \u062a\u062c\u0647\u064a\u0632 \u062a\u062d\u0648\u064a\u0644 \u0625\u0646\u0633\u062a\u0627\u0628\u0627\u064a \u0628\u062f\u0648\u0646 \u0645\u0628\u0644\u063a \u0635\u062d\u064a\u062d.");const a=this.formatTransferAmount(this.getSalaryAmount(n)),i=this.buildInstapayLink(a);window.location.href=i}onGenerateMonthly(){if(this.manualGenerationLoading)return;const e=this.toMonthParam(this.selectedMonth.value);this.manualGenerationLoading=!0,this.teacherSalaryService.generateMonthly(e).pipe((0,v.j)(()=>this.manualGenerationLoading=!1)).subscribe({next:n=>{n.isSuccess?(this.generationResult=n.data??null,this.toastService.success(`\u0627\u0643\u062a\u0645\u0644 \u0627\u0644\u062a\u0648\u0644\u064a\u062f. \u062a\u0645 \u0625\u0646\u0634\u0627\u0621 ${this.generationResult?.createdCount??0} \u0648\u062a\u062d\u062f\u064a\u062b ${this.generationResult?.updatedCount??0} \u0648\u062a\u062e\u0637\u064a ${this.generationResult?.skippedCount??0}.`),this.loadInvoices(),this.loadMonthlySummary()):this.handleErrors(n.errors,"\u0641\u0634\u0644 \u0625\u0646\u0634\u0627\u0621 \u0641\u0648\u0627\u062a\u064a\u0631 \u0627\u0644\u0634\u0647\u0631.")},error:()=>{this.toastService.error("\u0641\u0634\u0644 \u0625\u0646\u0634\u0627\u0621 \u0641\u0648\u0627\u062a\u064a\u0631 \u0627\u0644\u0634\u0647\u0631.")}})}formatMonth(e){return e?this.formatMonthString(this.extractMonthValue(e)):"\u2014"}formatSummaryMonth(){const e=this.summary?.month;if(e)return this.formatMonthString(e);const n=this.selectedMonth.value;return n?this.formatMonthString(n.toISOString()):"\u2014"}formatSalary(e){const n=this.getSalaryAmount(e);return this.formatCurrency(n)}formatCurrency(e){if(null==e||Number.isNaN(e))return"\u2014";try{return this.currencyFormatter.format(e)}catch{return e.toFixed(2)}}formatDateTime(e,n){if(null==e||""===e)return"\u2014";const a=this.parseDate(e);if(!a)return"string"==typeof e?e:"\u2014";if(n)try{return new Intl.DateTimeFormat(n,{dateStyle:"medium",timeStyle:"short"}).format(a)}catch{return a.toLocaleString(n)}try{return this.dateTimeFormatter.format(a)}catch{return a.toLocaleString()}}parseDate(e){if(e instanceof Date&&!Number.isNaN(e.getTime()))return e;if("string"==typeof e&&e.trim().length>0){const n=new Date(e);if(!Number.isNaN(n.getTime()))return n}if("number"==typeof e&&Number.isFinite(e)){const n=new Date(e);if(!Number.isNaN(n.getTime()))return n}return null}formatMetricValue(e){if(null==e.value||""===e.value)return"\u2014";if("currency"===e.type){const n=this.coerceNumber(e.value);return null!==n?this.formatCurrency(n):String(e.value)}if("number"===e.type){const n=this.coerceNumber(e.value);if(null!==n){const a=this.numberFormatter.format(n);return e.suffix?`${a} ${e.suffix}`:a}return String(e.value)}if("percentage"===e.type){const n=this.coerceNumber(e.value);if(null!==n){const a=Math.abs(n)<=1?100*n:n;return`${this.percentFormatter.format(a)}%`}return String(e.value)}return String(e.value)}getStatusLabel(e){if(!e)return"Unpaid";const n=[e.status,e.paymentStatus,this.isInvoicePaid(e)?"Paid":"Unpaid"];for(const a of n)if("string"==typeof a&&a.trim().length>0)return a;return this.isInvoicePaid(e)?"Paid":"Unpaid"}isInvoicePaid(e){if(!e)return!1;const n=[e.isPayed,e.isPaid,e.paid];for(const i of n){if("boolean"==typeof i)return i;if("string"==typeof i){const o=i.toLowerCase();if("paid"===o||"true"===o)return!0;if("unpaid"===o||"false"===o)return!1}}const a="string"==typeof e.status?e.status.toLowerCase():"string"==typeof e.paymentStatus?String(e.paymentStatus).toLowerCase():void 0;if(a){if(a.includes("paid")&&!a.includes("un"))return!0;if(a.includes("unpaid"))return!1}return!1}getReceiptUrl(e){const n=[e.receiptUrl,e.receiptLink,e.receipt,e.receiptUrl];for(const i of n)if("string"==typeof i&&i.trim().length>0){const o=i.trim();return/^(https?:)?\/\//i.test(o)||/^blob:/i.test(o)||/^data:/i.test(o)?o:this.toAbsoluteApiUrl(o)}const a=e.receiptPath;return"string"==typeof a&&a.trim().length>0?this.toAbsoluteApiUrl(a):e.id?`${this.apiBaseUrl}/api/TeacherSallary/GetPaymentReceipt?invoiceId=${e.id}`:null}getMonthDisplay(e){return this.formatMonth(e)}handleRowKey(e,n){return n.id??e}loadTeachers(e){if(!this.canManagePayments)return;const n={searchTerm:e?.trim()??void 0,lookupOnly:!0};this.teacherLoading=!0,this.lookupService.getUsersForSelects(n,Number(y.m.Teacher),0,0,0).pipe((0,v.j)(()=>this.teacherLoading=!1)).subscribe({next:a=>{a.isSuccess?this.teachers=a.data?.items??[]:(this.teachers=[],this.handleErrors(a.errors,"\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646."))},error:()=>{this.teachers=[],this.toastService.error("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646.")}})}loadInvoices(){const e=this.toMonthParam(this.selectedMonth.value),n=this.canManagePayments?this.selectedTeacher.value:null;this.invoicesLoading=!0,this.teacherSalaryService.getInvoices(e,n??null).pipe((0,v.j)(()=>this.invoicesLoading=!1)).subscribe({next:a=>{if(a.isSuccess){const i=Array.isArray(a.data)?a.data:[];this.applyInvoices(i)}else this.applyInvoices([]),this.handleErrors(a.errors,"\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0641\u0648\u0627\u062a\u064a\u0631 \u0631\u0648\u0627\u062a\u0628 \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646.")},error:()=>{this.applyInvoices([]),this.toastService.error("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0641\u0648\u0627\u062a\u064a\u0631 \u0631\u0648\u0627\u062a\u0628 \u0627\u0644\u0645\u0639\u0644\u0645\u064a\u0646.")}})}loadMonthlySummary(){const e=this.toMonthParam(this.selectedMonth.value),n=this.canManagePayments?this.selectedTeacher.value:null;this.summaryLoading=!0,this.teacherSalaryService.getMonthlySummary(e,n??null).pipe((0,v.j)(()=>this.summaryLoading=!1)).subscribe({next:a=>{a.isSuccess?(this.summary=a.data??null,this.summaryMetrics=this.buildSummaryMetrics(this.summary)):(this.summary=null,this.summaryMetrics=[],this.handleErrors(a.errors,"\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0634\u0647\u0631\u064a \u0644\u0644\u0645\u0639\u0644\u0645\u064a\u0646."))},error:()=>{this.summary=null,this.summaryMetrics=[],this.toastService.error("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0644\u062e\u0635 \u0627\u0644\u0634\u0647\u0631\u064a \u0644\u0644\u0645\u0639\u0644\u0645\u064a\u0646.")}})}loadInvoiceDetails(e,n=!0){this.detailsLoading=!0,this.teacherSalaryService.getInvoiceDetails(e).pipe((0,v.j)(()=>this.detailsLoading=!1)).subscribe({next:a=>{if(a.isSuccess){this.invoiceDetails=a.data,this.detailSummary=a.data?.monthlySummary??null;const i=this.detailSummary?.invoice??a.data?.invoice??this.selectedInvoice;this.selectedInvoice=this.findInvoiceById(e)??i??null,this.detailSummaryMetrics=this.buildSummaryMetrics(this.detailSummary),n&&setTimeout(()=>this.detailDrawer?.open(),0)}else this.handleErrors(a.errors,"\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629.")},error:()=>{this.toastService.error("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629.")}})}updateDisplayedColumns(){const e=["teacher","month","salary","status","paidAt","receipt"];(this.canGenerateInvoices||this.canManagePayments)&&e.push("actions"),this.displayedColumns=this.canManagePayments?[...e,"toggle"]:e}resetPaginator(){this.pageIndex=0}toMonthParam(e){return e?e.clone().startOf("month").utc(!0).format("YYYY-MM-DD"):null}applyInvoices(e){const n=[...e].sort((a,i)=>this.compareByMonthDesc(a,i));if(this.allInvoices=n,this.totalCount=n.length,this.updatePagedInvoices(),this.selectedInvoice){const a=n.find(i=>i.id===this.selectedInvoice?.id);a?this.selectedInvoice=a:this.closeDetails()}}setupIntersectionObserver(){this.loadMoreElement&&(this.intersectionObserver?.disconnect(),this.intersectionObserver=new IntersectionObserver(e=>{e.some(n=>n.isIntersecting)&&this.loadNextPage()},{root:null,rootMargin:"0px 0px 20% 0px"}),this.intersectionObserver.observe(this.loadMoreElement.nativeElement))}loadNextPage(){this.isLoadingMore||!this.hasMoreResults()||(this.isLoadingMore=!0,this.pageIndex+=1,this.updatePagedInvoices(!0),this.isLoadingMore=!1)}updatePagedInvoices(e=!1){const n=this.pageIndex*this.pageSize,i=this.allInvoices.slice(n,n+this.pageSize);this.dataSource.data=e?[...this.dataSource.data,...i]:i}hasMoreResults(){return this.dataSource.data.length<this.totalCount}compareByMonthDesc(e,n){const a=this.resolveInvoiceTime(e),i=this.resolveInvoiceTime(n);return i!==a?i-a:(n.id??0)-(e.id??0)}resolveInvoiceTime(e){const n=this.extractMonthValue(e);if(n){const i=new Date(n);if(!Number.isNaN(i.getTime()))return i.getTime()}const a=[e.payedAt,e.createdAt,e.invoiceDate,e.updatedAt,e.modifiedAt,e.modefiedAt];for(const i of a){if(i instanceof Date)return i.getTime();if("string"==typeof i){const o=new Date(i);if(!Number.isNaN(o.getTime()))return o.getTime()}}return e.id??0}extractMonthValue(e){const n=[e.month,e.monthDate,e.monthValue,e.monthStart,e.period,e.month,e.monthUtc];for(const a of n){if(a instanceof Date)return a.toISOString();if("string"==typeof a&&a.trim().length>0)return a}}formatMonthString(e){if(!e)return"\u2014";const n=new Date(e);return Number.isNaN(n.getTime())?e:new Intl.DateTimeFormat("ar-EG",{month:"long",year:"numeric"}).format(n)}getSalaryAmount(e){if(!e)return null;const n=["salary","salaryAmount","totalSalary","salaryTotal","netSalary","amount"];for(const a of n){const o=this.coerceNumber(e[a]);if(null!==o)return o}return null}normalizePhoneNumber(e){return e.replace(/[^\d]/g,"")}resolveTeacherMobile(e){if(!e)return null;const n=[e,this.invoiceDetails?.invoice,this.selectedInvoice],a=["mobile","mobileNumber","phone","phoneNumber","teacherMobile","teacherPhone","teacherMobileNumber","teacherPhoneNumber","mobileNo","phoneNo","teacherMobileNo","teacherPhoneNo"];for(const o of n)if(o)for(const d of a){const h=o[d];if("string"==typeof h&&h.trim().length>0)return h.trim()}const i=e.teacherId;if(i&&this.teachers.length>0){const o=this.teachers.find(d=>d.id===i);if(o?.mobile)return o.mobile}return null}formatTransferAmount(e){return null!==e&&Number.isFinite(e)?Number(e).toFixed(2).replace(/\.?0+$/,""):""}encodeUssd(e){return e.replace(/#/g,"%23")}buildInstapayLink(e){return`instapay://transfer?amount=${encodeURIComponent(e)}`}canTransferVodafoneCash(e){const n=this.getSalaryAmount(e),a=this.resolveTeacherMobile(e);return!!(null!==n&&Number.isFinite(n)&&a&&this.normalizePhoneNumber(a).length>0)}canTransferInstapay(e){const n=this.getSalaryAmount(e);return!(null===n||!Number.isFinite(n))}buildSummaryMetrics(e){if(!e)return[];const n=[],a=(i,o,d,h)=>{for(const S of o){const u=e[S];if(null!=u&&""!==u){if("currency"===d||"number"===d||"percentage"===d){const p=this.coerceNumber(u);if(null!==p)return void n.push({label:i,value:p,type:d,suffix:h})}if("string"==typeof u&&u.trim().length>0)return void n.push({label:i,value:u,type:"text",suffix:h})}}};return a("\u0627\u0644\u062a\u0642\u0627\u0631\u064a\u0631",["totalReports","reportCount"],"number"),a("\u0627\u0644\u062d\u0636\u0648\u0631",["presentCount","attendanceCount","totalAttendance","attendedSessions"],"number"),a("\u0627\u0644\u063a\u064a\u0627\u0628 \u0627\u0644\u0645\u0628\u0631\u0631",["absentWithExcuseCount"],"number"),a("\u0627\u0644\u063a\u064a\u0627\u0628 \u063a\u064a\u0631 \u0627\u0644\u0645\u0628\u0631\u0631",["absentWithoutExcuseCount"],"number"),a("\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u063a\u064a\u0627\u0628",["absenceCount","totalAbsence","missedSessions"],"number"),a("\u0639\u062f\u062f \u0627\u0644\u062d\u0635\u0635",["sessionCount","lessonsCount"],"number"),a("\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u062a\u062f\u0631\u064a\u0633",["teachingMinutes","totalMinutes"],"number","\u062f\u0642\u064a\u0642\u0629"),a("\u0627\u0644\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u0629",["overtimeMinutes"],"number","\u062f\u0642\u064a\u0642\u0629"),a("\u0627\u0644\u0631\u0627\u062a\u0628 \u0627\u0644\u0623\u0633\u0627\u0633\u064a",["baseSalary"],"currency"),a("\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0631\u0627\u062a\u0628",["salaryTotal","totalSalary"],"currency"),a("\u0627\u0644\u0645\u0643\u0627\u0641\u0622\u062a",["bonusTotal","bonuses","totalBonus"],"currency"),a("\u0627\u0644\u062e\u0635\u0648\u0645\u0627\u062a",["deductionTotal","deductions","totalDeduction"],"currency"),a("\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",["netSalary","takeHomePay"],"currency"),a("\u0627\u0644\u0623\u062c\u0631 \u0628\u0627\u0644\u0633\u0627\u0639\u0629",["hourlyRate"],"currency"),a("\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",["attendanceRate"],"percentage"),n}coerceNumber(e){if("number"==typeof e&&!Number.isNaN(e))return e;if("string"==typeof e){const n=e.trim();if(0===n.length)return null;const a=Number(n);if(!Number.isNaN(a))return a}return null}handleErrors(e,n){if(e&&e.length>0){const a=e.map(i=>i.message||i.code).filter(i=>!!i&&i.trim().length>0).join(" \u2022 ");if(a.length>0)return void this.toastService.error(a)}this.toastService.error(n)}findInvoiceById(e){return this.dataSource.data.find(n=>n.id===e)??null}buildUpdatePaymentPayload(e,n){const a={id:e.id},i=this.getSalaryAmount(e);return null!==i&&(a.amount=i),n?(a.payStatue=!0,a.isCancelled=!1):(a.payStatue=!1,a.isCancelled=!0),a}buildReceiptFileName(e){const n=this.toSlug(e.teacherName??"\u0627\u0644\u0645\u0639\u0644\u0645"),a=this.formatMonth(e),i=this.toSlug(a);return`\u0641\u0627\u062a\u0648\u0631\u0629-\u0631\u0627\u062a\u0628-${n.length>0?n:"\u0627\u0644\u0645\u0639\u0644\u0645"}-${i.length>0?i:"\u0627\u0644\u0634\u0647\u0631"}${e.id?`-${e.id}`:""}.html`}mergeInvoiceData(e,n){const a={...e};return n?{...a,...n}:a}applyInvoiceUpdate(e){if(!e?.id)return void this.loadInvoices();const n=this.dataSource.data.findIndex(i=>i.id===e.id);if(-1===n)return void this.loadInvoices();const a=[...this.dataSource.data];a[n]=this.mergeInvoiceData(a[n],e),this.applyInvoices(a),this.selectedInvoice?.id===e.id&&this.loadInvoiceDetails(e.id,!1)}extractInvoiceFromStatusResponse(e){return e?this.resolveInvoiceFromPayload(e.data):null}resolveInvoiceFromPayload(e){if(!e||"boolean"==typeof e)return null;if(this.isTeacherSalaryInvoice(e))return e;if(Array.isArray(e))return e.find(a=>this.isTeacherSalaryInvoice(a))??null;if("object"==typeof e){const n=e,a=n.invoice;if(this.isTeacherSalaryInvoice(a))return a;const i=n.data;if(i&&i!==e){const o=this.resolveInvoiceFromPayload(i);if(o)return o}}return null}isTeacherSalaryInvoice(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&Number.isFinite(e.id??NaN)}toAbsoluteApiUrl(e){if(/^https?:\/\//i.test(e))return e;const n=e.replace(/^\/+/,"");return`${this.apiBaseUrl}/${n}`}toSlug(e){return e.toLowerCase().normalize("NFKD").replace(/[^\p{L}\p{N}]+/gu,"-").replace(/^-+|-+$/g,"")}getInvoicePrintContext(e,n){const a=this.buildInvoicePrintContext(e,n);return a?(0,ut.of)(a):this.teacherSalaryService.getInvoiceDetails(e).pipe((0,q.T)(i=>{if(i.isSuccess){const d=this.buildInvoicePrintContext(e,n,i.data??null);if(d)return d;throw new O("\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u063a\u064a\u0631 \u0645\u0643\u062a\u0645\u0644\u0629 \u0644\u0625\u0646\u0634\u0627\u0621 \u0646\u0633\u062e\u0629 \u0627\u0644\u0637\u0628\u0627\u0639\u0629.")}throw new O("\u0641\u0634\u0644 \u062a\u062d\u0645\u064a\u0644 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u062e\u0627\u0635\u0629 \u0628\u0627\u0644\u0637\u0628\u0627\u0639\u0629.",i.errors)}))}buildInvoicePrintContext(e,n,a){const i=a??(this.invoiceDetails?.invoice?.id===e?this.invoiceDetails:null),o=i?.invoice??this.findInvoiceById(e)??(this.selectedInvoice?.id===e?this.selectedInvoice:null)??n??null;return o?{invoice:o,summary:i?.monthlySummary??(this.selectedInvoice?.id===e?this.detailSummary:null)??null??null,details:i??null}:null}createInvoicePrintArtifacts(e){try{const n=this.buildInvoicePrintHtml(e),a=this.buildReceiptFileName(e.invoice),i=new Blob([n],{type:"text/html"});return{html:n,blob:i,fileName:a,receipt:{file:i,fileName:a}}}catch(n){throw console.error("\u062a\u0639\u0630\u0631 \u0625\u0646\u0634\u0627\u0621 \u0646\u0633\u062e\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0644\u0644\u0637\u0628\u0627\u0639\u0629",n),new Error("PRINT_RENDER_FAILED")}}buildInvoicePrintHtml(e){const n=e.invoice,a=e.summary,o=this.formatArabicNumber(n.id??null),d=this.resolveInvoiceNumber(n,["teacherId"])??this.resolveSummaryNumber(a,["teacherId"]),h=this.resolveTeacherName(n,a),S=this.resolveSummaryString(a,["teacherNameAr","teacherArabicName","teacherName"])??h,u=this.resolveInvoiceMonthArabic(e),p=this.resolvePaymentDateDisplay(n,"ar-EG"),_=this.getStatusLabel(n),G=this.getSalaryAmount(n),E=this.formatArabicCurrency(G),it=this.formatDateTime(new Date,"ar-EG"),Te=this.resolveSummaryNumber(a,["baseSalary"]),ot=this.resolveSummaryNumber(a,["salaryTotal","totalSalary"])??G,xe=this.resolveSummaryNumber(a,["bonusTotal","bonuses","totalBonus"]),Ie=this.resolveSummaryNumber(a,["deductionTotal","deductions","totalDeduction"]),V=this.resolveSummaryNumber(a,["netSalary","takeHomePay"])??this.resolveInvoiceNumber(n,["netSalary","netPay"])??ot??G,Re=this.resolveSummaryNumber(a,["hourlyRate"]),Fe=this.resolveSummaryNumber(a,["attendanceCount","totalAttendance","attendedSessions"]),Pe=this.resolveSummaryNumber(a,["absenceCount","totalAbsence","missedSessions"]),$e=this.resolveSummaryNumber(a,["sessionCount","lessonsCount"]),Ee=this.resolveSummaryNumber(a,["teachingMinutes","totalMinutes"]),Ne=this.resolveSummaryNumber(a,["overtimeMinutes"]),x=this.resolveSummaryNumber(a,["attendanceRate"]),L=null==x?null:Math.abs(x)<=1?100*x:x,N=null===L?"\u2014":`${this.formatArabicPercent(L)}\u066a`,ke=[{titleEn:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",titleAr:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",value:E,valueAr:E},{titleEn:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",titleAr:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",value:this.formatArabicCurrency(V),valueAr:this.formatArabicCurrency(V)},{titleEn:"\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",titleAr:"\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",value:N,valueAr:N},{titleEn:"\u0627\u0644\u062d\u0627\u0644\u0629",titleAr:"\u0627\u0644\u062d\u0627\u0644\u0629",value:_,valueAr:_}],we=[{labelEn:"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueEn:o,labelAr:"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueAr:o},{labelEn:"\u0631\u0642\u0645 \u0627\u0644\u0645\u0639\u0644\u0645",valueEn:this.formatArabicNumber(d),labelAr:"\u0631\u0642\u0645 \u0627\u0644\u0645\u0639\u0644\u0645",valueAr:this.formatArabicNumber(d)},{labelEn:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0639\u0644\u0645",valueEn:S,labelAr:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0639\u0644\u0645",valueAr:S},{labelEn:"\u0634\u0647\u0631 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueEn:u,labelAr:"\u0634\u0647\u0631 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueAr:u},{labelEn:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u0641\u0639",valueEn:p,labelAr:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u0641\u0639",valueAr:p},{labelEn:"\u0627\u0644\u062d\u0627\u0644\u0629",valueEn:_,labelAr:"\u0627\u0644\u062d\u0627\u0644\u0629",valueAr:_},{labelEn:"\u0642\u064a\u0645\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueEn:E,labelAr:"\u0642\u064a\u0645\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueAr:E,highlight:!0},{labelEn:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0646\u0634\u0627\u0621",valueEn:it,labelAr:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0646\u0634\u0627\u0621",valueAr:it}],Ae=[{labelEn:"\u0627\u0644\u0631\u0627\u062a\u0628 \u0627\u0644\u0623\u0633\u0627\u0633\u064a",value:Te,labelAr:"\u0627\u0644\u0631\u0627\u062a\u0628 \u0627\u0644\u0623\u0633\u0627\u0633\u064a"},{labelEn:"\u0627\u0644\u0645\u0643\u0627\u0641\u0622\u062a",value:xe,labelAr:"\u0627\u0644\u0645\u0643\u0627\u0641\u0622\u062a"},{labelEn:"\u0627\u0644\u062e\u0635\u0648\u0645\u0627\u062a",value:Ie,labelAr:"\u0627\u0644\u062e\u0635\u0648\u0645\u0627\u062a"},{labelEn:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",value:V,labelAr:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",highlight:!0},{labelEn:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0631\u0627\u062a\u0628",value:ot,labelAr:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0631\u0627\u062a\u0628",highlight:!0},{labelEn:"\u0627\u0644\u0623\u062c\u0631 \u0628\u0627\u0644\u0633\u0627\u0639\u0629",value:Re,labelAr:"\u0627\u0644\u0623\u062c\u0631 \u0628\u0627\u0644\u0633\u0627\u0639\u0629"}],je=[{labelEn:"\u0627\u0644\u062d\u0636\u0648\u0631",value:Fe,labelAr:"\u0627\u0644\u062d\u0636\u0648\u0631",formatEn:m=>this.formatArabicNumber(m),formatAr:m=>`${this.formatArabicNumber(m)} \u062d\u0636\u0648\u0631`},{labelEn:"\u0627\u0644\u063a\u064a\u0627\u0628",value:Pe,labelAr:"\u0627\u0644\u063a\u064a\u0627\u0628",formatEn:m=>this.formatArabicNumber(m),formatAr:m=>`${this.formatArabicNumber(m)} \u063a\u064a\u0627\u0628`},{labelEn:"\u0639\u062f\u062f \u0627\u0644\u062d\u0635\u0635",value:$e,labelAr:"\u0639\u062f\u062f \u0627\u0644\u062d\u0635\u0635",formatEn:m=>this.formatArabicNumber(m),formatAr:m=>`${this.formatArabicNumber(m)} \u062d\u0635\u0629`},{labelEn:"\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u062a\u062f\u0631\u064a\u0633",value:Ee,labelAr:"\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u062a\u062f\u0631\u064a\u0633",formatEn:m=>`${this.formatArabicNumber(m)} \u062f\u0642\u064a\u0642\u0629`,formatAr:m=>`${this.formatArabicNumber(m)} \u062f\u0642\u064a\u0642\u0629`},{labelEn:"\u0627\u0644\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u0629",value:Ne,labelAr:"\u0627\u0644\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u0629",formatEn:m=>`${this.formatArabicNumber(m)} \u062f\u0642\u064a\u0642\u0629 \u0625\u0636\u0627\u0641\u064a\u0629`,formatAr:m=>`${this.formatArabicNumber(m)} \u062f\u0642\u064a\u0642\u0629 \u0625\u0636\u0627\u0641\u064a\u0629`}].filter(m=>null!=m.value).map(m=>this.buildPrintRow(m.labelEn,m.formatEn(m.value),m.labelAr,m.formatAr(m.value))).join(""),De=Ae.filter(m=>null!=m.value).map(m=>this.buildPrintRow(m.labelEn,this.formatCurrency(m.value),m.labelAr,this.formatArabicCurrency(m.value),{highlight:!!m.highlight})).join(""),Oe=we.map(m=>this.buildPrintRow(m.labelEn,m.valueEn,m.labelAr,m.valueAr,{highlight:!!m.highlight})).join(""),Ge=ke.map(m=>this.buildSummaryCardHtml(m)).join(""),Le=this.buildPrintStyles(),Ue=null!==L?this.buildPrintRow("\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",N,"\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",N):"";return`<!DOCTYPE html>\n<html lang="ar">\n<head>\n  <meta charset="utf-8" />\n  <title>${this.escapeHtml("\u0641\u0627\u062a\u0648\u0631\u0629 \u0631\u0627\u062a\u0628 \u0627\u0644\u0645\u0639\u0644\u0645"+("\u2014"!==o?` \u0631\u0642\u0645 ${o}`:""))}</title>\n  <style>\n${Le}\n  </style>\n</head>\n<body>\n  <div class="print-page">\n    <header class="print-header">\n      <div class="header-text">\n        <h1 dir="rtl">\u0641\u0627\u062a\u0648\u0631\u0629 \u0631\u0627\u062a\u0628 \u0627\u0644\u0645\u0639\u0644\u0645</h1>\n        <h2 dir="rtl">\u0633\u0646\u062f \u062f\u0641\u0639 \u0627\u0644\u0631\u0627\u062a\u0628</h2>\n      </div>\n      <div class="header-meta">\n        <span class="label">\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629</span>\n        <span class="value" dir="rtl">${this.escapeHtml(o)}</span>\n      </div>\n    </header>\n    <section class="summary-cards">\n      ${Ge}\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3 dir="rtl">\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629</h3>\n        <h4 dir="rtl">\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0637\u0644\u0628</h4>\n      </div>\n      <div class="print-grid">\n        ${Oe}\n      </div>\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3 dir="rtl">\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0631\u0627\u062a\u0628</h3>\n        <h4 dir="rtl">\u0645\u0644\u062e\u0635 \u0627\u0644\u0645\u0633\u062a\u062d\u0642\u0627\u062a</h4>\n      </div>\n      <div class="print-grid">\n        ${De}\n      </div>\n    </section>\n      <section class="print-section">\n        <div class="section-title">\n        <h3 dir="rtl">\u0645\u0644\u062e\u0635 \u0627\u0644\u062d\u0636\u0648\u0631</h3>\n        <h4 dir="rtl">\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0627\u0644\u062a\u0632\u0627\u0645</h4>\n        </div>\n        <div class="print-grid">\n          ${je}\n        ${Ue}\n      </div>\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3 dir="rtl">\u0645\u0644\u0627\u062d\u0638\u0627\u062a</h3>\n        <h4 dir="rtl">\u0645\u0639\u0644\u0648\u0645\u0627\u062a \u0625\u0636\u0627\u0641\u064a\u0629</h4>\n      </div>\n      <div class="notes-card">\n        <p dir="rtl">${this.escapeHtml("\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u0647\u0630\u0647 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u062a\u0644\u0642\u0627\u0626\u064a\u0627\u064b \u0627\u0633\u062a\u0646\u0627\u062f\u0627\u064b \u0625\u0644\u0649 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0631\u0627\u062a\u0628 \u0648\u0627\u0644\u062d\u0636\u0648\u0631 \u0644\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062d\u062f\u062f\u0629.")}</p>\n      </div>\n    </section>\n  </div>\n  <script>\n    window.addEventListener('load', () => {\n      setTimeout(() => {\n        try {\n          window.print();\n        } catch (err) {\n          console.error(err);\n        }\n      }, 300);\n    });\n  <\/script>\n</body>\n</html>`}buildPrintStyles(){return`\n      :root {\n        color-scheme: only light;\n      }\n      * {\n        box-sizing: border-box;\n      }\n      body {\n        margin: 0;\n        padding: 24px;\n        background: ${D};\n        color: ${nt};\n        font-family: 'Cairo Variable', 'Cairo', 'Tajawal', 'Helvetica Neue', Arial, sans-serif;\n        line-height: 1.6;\n      }\n      .print-page {\n        max-width: 860px;\n        margin: 0 auto;\n        background: #fff;\n        padding: 32px;\n        border-radius: 20px;\n        box-shadow: 0 24px 48px rgba(19, 66, 115, 0.12);\n      }\n      .print-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-end;\n        background: ${P};\n        color: #fff;\n        padding: 24px;\n        border-radius: 16px;\n      }\n      .header-text h1 {\n        margin: 0;\n        font-size: 28px;\n      }\n      .header-text h2 {\n        margin: 4px 0 0;\n        font-size: 22px;\n        font-weight: 500;\n      }\n      .header-meta {\n        display: flex;\n        flex-direction: column;\n        align-items: flex-end;\n        font-weight: 600;\n      }\n      .header-meta .label {\n        text-transform: uppercase;\n        font-size: 12px;\n        letter-spacing: 1px;\n        opacity: 0.8;\n      }\n      .header-meta .value {\n        font-size: 20px;\n      }\n      .summary-cards {\n        display: grid;\n        gap: 16px;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        margin: 28px 0;\n      }\n      .summary-card {\n        background: ${D};\n        border: 1px solid ${at};\n        border-radius: 14px;\n        padding: 18px;\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n      .summary-card .summary-title {\n        font-weight: 600;\n        color: ${$};\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n      }\n      .summary-card .summary-value {\n        font-size: 20px;\n        font-weight: 700;\n        color: ${P};\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n      }\n      .print-section + .print-section {\n        margin-top: 32px;\n      }\n      .section-title h3,\n      .section-title h4 {\n        margin: 0;\n      }\n      .section-title h4 {\n        color: ${$};\n        font-weight: 500;\n      }\n      .print-grid {\n        margin-top: 16px;\n        display: grid;\n        gap: 12px;\n      }\n      .print-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n        gap: 12px;\n        align-items: stretch;\n        border: 1px solid ${at};\n        border-radius: 12px;\n        padding: 14px 18px;\n        background: #fff;\n      }\n      .print-row.highlight {\n        border-color: ${P};\n        background: rgba(19, 66, 115, 0.08);\n      }\n      .row-text {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n      }\n      .row-text .label {\n        font-size: 13px;\n        font-weight: 600;\n        text-transform: uppercase;\n        color: ${$};\n        letter-spacing: 0.5px;\n      }\n      .row-text .value {\n        font-size: 16px;\n        font-weight: 600;\n        color: ${nt};\n        word-break: break-word;\n      }\n      .row-text.ar {\n        text-align: right;\n        direction: rtl;\n      }\n      .row-text.ar .value {\n        font-family: 'Cairo Variable', 'Cairo', 'Tajawal', 'Helvetica Neue', Arial, sans-serif;\n      }\n      .notes-card {\n        border: 1px dashed ${P};\n        border-radius: 12px;\n        padding: 18px;\n        background: ${D};\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n      .notes-card p {\n        margin: 0;\n        color: ${$};\n        font-size: 15px;\n      }\n      @media print {\n        body {\n          background: #fff;\n          padding: 0;\n        }\n        .print-page {\n          box-shadow: none;\n          border-radius: 0;\n        }\n      }\n    `}buildPrintRow(e,n,a,i,o={}){const d=["print-row"];return o.highlight&&d.push("highlight"),`\n      <div class="${d.join(" ")}">\n        <div class="row-text en">\n          <span class="label">${this.escapeHtml(e)}</span>\n          <span class="value">${this.escapeHtml(n)}</span>\n        </div>\n        <div class="row-text ar" dir="rtl">\n          <span class="label">${this.escapeHtml(a)}</span>\n          <span class="value">${this.escapeHtml(i)}</span>\n        </div>\n      </div>\n    `}buildSummaryCardHtml(e){return`\n      <div class="summary-card">\n        <div class="summary-title">\n          <span>${this.escapeHtml(e.titleEn)}</span>\n          <span dir="rtl">${this.escapeHtml(e.titleAr)}</span>\n        </div>\n        <div class="summary-value">\n          <span>${this.escapeHtml(e.value)}</span>\n          <span dir="rtl">${this.escapeHtml(e.valueAr??e.value)}</span>\n        </div>\n      </div>\n    `}escapeHtml(e){return null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}formatArabicNumber(e){if(null==e||Number.isNaN(e))return"\u2014";try{return new Intl.NumberFormat("ar-EG",{maximumFractionDigits:0}).format(e)}catch{return this.numberFormatter.format(e)}}formatArabicCurrency(e){if(null==e||Number.isNaN(e))return"\u2014";try{return new Intl.NumberFormat("ar-EG",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch{return this.formatCurrency(e)}}formatArabicPercent(e){if(null==e||Number.isNaN(e))return"\u2014";try{return new Intl.NumberFormat("ar-EG",{minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}catch{return this.percentFormatter.format(e)}}formatArabicMonthString(e){if(!e)return"\u2014";const n=new Date(e);if(!Number.isNaN(n.getTime()))try{return new Intl.DateTimeFormat("ar-EG",{month:"long",year:"numeric"}).format(n)}catch{return this.formatMonthString(e)}return e}resolveInvoiceMonthArabic(e){const n=this.extractMonthValue(e.invoice);if(n){const o=this.formatArabicMonthString(n);if("\u2014"!==o)return o}const a=this.resolveSummaryString(e.summary,["month"]);if(a)return this.formatArabicMonthString(a);const i=this.selectedMonth.value;return i?this.formatArabicMonthString(i.toISOString()):"\u2014"}presentInvoicePrint(e,n,a){const i=a??new Blob([e],{type:"text/html"});if(typeof window<"u"){const o=window.open("","_blank");if(o)return o.document.open(),o.document.write(e),o.document.close(),o.focus(),void setTimeout(()=>{try{o.print()}catch{}},400);if(typeof URL<"u"){const d=URL.createObjectURL(i),h=document.createElement("a");h.href=d,h.download=n,h.click(),setTimeout(()=>{try{URL.revokeObjectURL(d)}catch{}},12e4)}}}resolveTeacherName(e,n){return("string"==typeof e.teacherName&&e.teacherName.trim().length>0?e.teacherName.trim():null)||(this.resolveSummaryString(n,["teacherName"])??"\u2014")}resolveInvoiceMonth(e){const n=this.formatMonth(e.invoice);if(n&&"\u2014"!==n)return n;const a=this.resolveSummaryString(e.summary,["month"]);return a?this.formatMonthString(a):"\u2014"}resolvePaymentDateDisplay(e,n){const a=[e.payedAt,e.paidAt,e.paymentDate,e.lastPaymentDate];for(const i of a){const o=this.formatDateTime(i,n);if("\u2014"!==o)return o}return this.formatDateTime(new Date,n)}resolveInvoiceNumber(e,n){if(!e)return null;for(const a of n){const o=this.coerceNumber(e[a]);if(null!==o)return o}return null}resolveSummaryNumber(e,n){if(!e)return null;for(const a of n){const o=this.coerceNumber(e[a]);if(null!==o)return o}return null}resolveSummaryString(e,n){if(!e)return null;for(const a of n){const i=e[a];if("string"==typeof i&&i.trim().length>0)return i.trim()}return null}notifyHttpError(e,n){var a=this;return(0,C.A)(function*(){if(e instanceof T.yz){const i=yield a.extractHttpErrorMessage(e);if(i&&i.trim().length>0)return void a.toastService.error(i)}a.toastService.error(n)})()}extractHttpErrorMessage(e){return(0,C.A)(function*(){const n=e.error;if(!n)return null;if("string"==typeof n){const a=n.trim();return a.length>0?a:null}if(n instanceof Blob)try{const a=(yield n.text()).trim();if(!a)return null;try{const i=JSON.parse(a);if("string"==typeof i)return i;if(i&&"string"==typeof i.message)return i.message;if(i&&"string"==typeof i.error)return i.error}catch{return a}}catch{return null}if("object"==typeof n&&null!==n){const a=n.message??n.error;if("string"==typeof a){const i=a.trim();if(i.length>0)return i}}return null})()}static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275cmp=t.VBU({type:r,selectors:[["app-teacher-salary"]],viewQuery:function(n,a){if(1&n&&(t.GBs(_t,5),t.GBs(Mt,5)),2&n){let i;t.mGM(i=t.lsd())&&(a.loadMoreTrigger=i.first),t.mGM(i=t.lsd())&&(a.detailDrawer=i.first)}},features:[t.Jv_([{provide:k.D,useClass:w.QH,deps:[k.M,w.ij]},{provide:k.a,useValue:Se}])],decls:97,vars:41,consts:[["detailDrawer",""],["monthPicker",""],["loadMoreTrigger",""],[3,"isLoading"],[1,"teacher-salary-container"],["mode","over","position","end",1,"teacher-salary-drawer",3,"closedStart"],[1,"drawer-content"],[1,"drawer-header"],[1,"drawer-title"],[1,"drawer-subtitle"],["mat-icon-button","","type","button",3,"click"],[1,"drawer-loading"],[1,"drawer-empty"],[1,"page-header"],[1,"page-subtitle"],["mat-flat-button","","color","primary","type","button",3,"disabled"],[1,"generation-card"],[1,"filters-card"],[1,"filters-grid"],["appearance","outline"],["matInput","",3,"matDatepicker","formControl"],["matIconSuffix","",3,"for"],["startView","multi-year","panelClass","month-picker",3,"monthSelected"],[1,"teacher-context"],["mat-stroked-button","","color","primary","type","button",1,"reload-button",3,"click","disabled"],["mode","indeterminate"],[1,"table-card"],[1,"table-container"],["mat-table","",1,"teacher-salary-table",3,"dataSource"],["matColumnDef","teacher"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","month"],["matColumnDef","salary"],["matColumnDef","status"],["matColumnDef","paidAt"],["matColumnDef","receipt"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["matColumnDef","toggle"],["mat-header-cell","","class","toggle-header",4,"matHeaderCellDef"],["mat-cell","","class","toggle-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"is-selected","click",4,"matRowDef","matRowDefColumns"],[1,"app-paginator"],[1,"text-muted"],[1,"empty-state"],[1,"summary-card"],[1,"summary-header"],[1,"summary-subtitle"],["mat-icon-button","","type","button",3,"click","disabled"],[1,"summary-loading"],[1,"summary-grid"],["diameter","40","mode","indeterminate"],[1,"drawer-section"],[1,"detail-grid"],[1,"detail-item"],[1,"label"],[1,"value"],["target","_blank","rel","noopener",3,"href"],[1,"section-header"],[1,"summary-metrics"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[1,"generation-content"],[1,"generation-title"],[1,"generation-stats"],["appearance","outline",1,"teacher-select"],[3,"formControl","disabled"],[3,"value"],["matSuffix","","diameter","20","mode","indeterminate"],["appearance","outline",1,"teacher-search"],["matInput","",3,"placeholder","formControl"],["mat-icon-button","","matSuffix","","type","button",3,"disabled"],["mat-stroked-button","","type","button",1,"refresh-button",3,"click","disabled"],["mat-icon-button","","matSuffix","","type","button",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],[1,"cell-primary"],[1,"status-badge"],["target","_blank","rel","noopener",3,"click","href"],["mat-header-cell","",1,"actions-header"],["mat-cell","",1,"actions-cell"],["mat-icon-button","","type","button","color","primary",1,"action-button",3,"matTooltip","disabled"],["mat-icon-button","","type","button","color","accent",1,"action-button",3,"click","mousedown","matTooltip","disabled"],["mat-icon-button","","type","button","color","primary",1,"action-button",3,"click","mousedown","matTooltip","disabled"],[1,"spin"],["mat-header-cell","",1,"toggle-header"],["mat-cell","",1,"toggle-cell"],["color","primary",3,"click","change","checked","disabled"],["mat-header-row",""],["mat-row","",3,"click"],[1,"summary-card-item"]],template:function(n,a){if(1&n){const i=t.RV6();t.j41(0,"app-loading-overlay",3)(1,"mat-drawer-container",4)(2,"mat-drawer",5,0),t.bIt("closedStart",function(){return l.eBV(i),l.Njj(a.onDrawerClosed())}),t.j41(4,"div",6)(5,"div",7)(6,"div")(7,"h3",8),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.nVh(10,xt,2,1,"p",9),t.k0s(),t.j41(11,"button",10),t.bIt("click",function(){return l.eBV(i),l.Njj(a.closeDetails())}),t.j41(12,"mat-icon"),t.EFF(13,"close"),t.k0s()()(),t.nrm(14,"mat-divider"),t.nVh(15,It,2,0,"div",11)(16,wt,45,27)(17,At,4,3,"div",12),t.k0s()(),t.j41(18,"mat-drawer-content")(19,"div",13)(20,"div")(21,"p",14),t.EFF(22),t.nI1(23,"translate"),t.k0s()(),t.nVh(24,jt,5,4,"button",15),t.k0s(),t.nVh(25,Dt,21,15,"mat-card",16),t.j41(26,"mat-card",17)(27,"div",18)(28,"mat-form-field",19)(29,"mat-label"),t.EFF(30),t.nI1(31,"translate"),t.k0s(),t.nrm(32,"input",20)(33,"mat-datepicker-toggle",21),t.j41(34,"mat-datepicker",22,1),t.bIt("monthSelected",function(d){l.eBV(i);const h=t.sdS(35);return l.Njj(a.setMonth(d,h))}),t.k0s()(),t.nVh(36,Lt,23,22)(37,Ut,6,3,"div",23),t.j41(38,"button",24),t.bIt("click",function(){return l.eBV(i),l.Njj(a.reloadAll())}),t.j41(39,"mat-icon"),t.EFF(40,"refresh"),t.k0s(),t.EFF(41),t.nI1(42,"translate"),t.k0s()()(),t.nVh(43,Bt,1,0,"mat-progress-bar",25),t.j41(44,"mat-card",26)(45,"div",27)(46,"table",28),t.qex(47,29),t.DNE(48,Yt,3,3,"th",30)(49,Jt,3,1,"td",31),t.bVm(),t.qex(50,32),t.DNE(51,zt,3,3,"th",30)(52,Ht,2,1,"td",31),t.bVm(),t.qex(53,33),t.DNE(54,Xt,3,3,"th",30)(55,Qt,2,1,"td",31),t.bVm(),t.qex(56,34),t.DNE(57,Wt,3,3,"th",30)(58,Kt,5,6,"td",31),t.bVm(),t.qex(59,35),t.DNE(60,Zt,3,3,"th",30)(61,ee,3,1,"td",31),t.bVm(),t.qex(62,36),t.DNE(63,ae,3,3,"th",30)(64,ie,3,1,"td",31),t.bVm(),t.qex(65,37),t.DNE(66,oe,3,3,"th",38)(67,me,12,15,"td",39),t.bVm(),t.qex(68,40),t.DNE(69,de,3,3,"th",41)(70,ue,2,2,"td",42),t.bVm(),t.DNE(71,he,1,0,"tr",43)(72,pe,1,2,"tr",44),t.k0s()(),t.j41(73,"div",45,2)(75,"span",46),t.EFF(76),t.nI1(77,"translate"),t.k0s()(),t.nVh(78,fe,3,3,"div",47),t.k0s(),t.j41(79,"mat-card",48)(80,"div",49)(81,"div")(82,"h3"),t.EFF(83),t.nI1(84,"translate"),t.k0s(),t.j41(85,"p",50),t.EFF(86),t.nI1(87,"translate"),t.j41(88,"strong"),t.EFF(89),t.k0s(),t.EFF(90,". "),t.k0s()(),t.j41(91,"button",51),t.bIt("click",function(){return l.eBV(i),l.Njj(a.loadMonthlySummary())}),t.j41(92,"mat-icon"),t.EFF(93,"refresh"),t.k0s()()(),t.nVh(94,ge,2,0,"div",52)(95,be,3,0,"div",53)(96,ve,3,3,"div",47),t.k0s()()()()}if(2&n){const i=t.sdS(35);t.Y8G("isLoading",a.pageLoading),t.R7$(8),t.JRh(t.bMT(9,27,"Invoice Details")),t.R7$(2),t.vxM(null!=a.selectedInvoice&&a.selectedInvoice.teacherName||null!=a.detailSummary&&a.detailSummary.teacherName?10:-1),t.R7$(5),t.vxM(a.detailsLoading?15:a.invoiceDetails||a.selectedInvoice?16:17),t.R7$(7),t.SpI(" ",t.bMT(23,29,"Teacher Salary Subtitle")," "),t.R7$(2),t.vxM(a.canGenerateInvoices?24:-1),t.R7$(),t.vxM(a.generationResult?25:-1),t.R7$(5),t.JRh(t.bMT(31,31,"Month")),t.R7$(2),t.Y8G("matDatepicker",i)("formControl",a.selectedMonth),t.R7$(),t.Y8G("for",i),t.R7$(3),t.vxM(a.canManagePayments?36:37),t.R7$(2),t.Y8G("disabled",a.invoicesLoading||a.summaryLoading),t.R7$(3),t.SpI(" ",t.bMT(42,33,"Reload")," "),t.R7$(2),t.vxM(a.invoicesLoading?43:-1),t.R7$(3),t.Y8G("dataSource",a.dataSource),t.R7$(25),t.Y8G("matHeaderRowDef",a.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumns),t.R7$(),t.AVh("d-none",!a.hasMoreResults()),t.R7$(3),t.SpI(" ",t.bMT(77,35,a.isLoadingMore?"Loading more...":"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")," "),t.R7$(2),t.vxM(a.invoicesLoading||0!==a.dataSource.data.length?-1:78),t.R7$(5),t.JRh(t.bMT(84,37,"Monthly Summary")),t.R7$(3),t.SpI(" ",t.bMT(87,39,"Monthly Summary Subtitle")," "),t.R7$(3),t.JRh(a.formatSummaryMonth()),t.R7$(2),t.Y8G("disabled",a.summaryLoading),t.R7$(3),t.vxM(a.summaryLoading?94:a.summaryMetrics.length>0?95:96)}},dependencies:[b.MD,b.vh,g.X1,g.me,g.BC,g.l_,R.vg,R.qe,R.$C,R.$l,B.m_,B.An,U.w,U.q,Y.Hl,Y.$z,St.M,X.D6,X.LG,J.Hu,J.RN,lt.M,j.j,j.M,j.g,z.fS,z.fg,F.X6,F.Vh,F.bZ,F.bU,w.ZG,H.M,H.g,Ct.M,Q.PO,Q.HM,W.h,W.e,f.tP,f.Zl,f.tL,f.ji,f.cC,f.YV,f.iL,f.KS,f.$R,f.YZ,f.NB,K.mV,K.sG,tt.h,tt.D9,vt.q],styles:["[_nghost-%COMP%]{display:block;--teacher-salary-text-primary: rgba(0, 0, 0, .87);--teacher-salary-text-secondary: rgba(0, 0, 0, .6);--teacher-salary-text-tertiary: rgba(0, 0, 0, .54);--teacher-salary-text-muted: rgba(0, 0, 0, .7);--teacher-salary-background-soft: rgba(63, 81, 181, .08);--teacher-salary-background-strong: rgba(63, 81, 181, .12);--teacher-salary-status-bg: rgba(158, 158, 158, .15);--teacher-salary-status-text: rgba(0, 0, 0, .7);--teacher-salary-status-paid-bg: rgba(46, 125, 50, .15);--teacher-salary-status-paid-text: #2e7d32;--teacher-salary-status-unpaid-bg: rgba(229, 57, 53, .12);--teacher-salary-status-unpaid-text: #c62828}.dark[_nghost-%COMP%], .dark   [_nghost-%COMP%]{--teacher-salary-text-primary: rgba(255, 255, 255, .92);--teacher-salary-text-secondary: rgba(255, 255, 255, .75);--teacher-salary-text-tertiary: rgba(255, 255, 255, .6);--teacher-salary-text-muted: rgba(255, 255, 255, .72);--teacher-salary-background-soft: rgba(63, 81, 181, .22);--teacher-salary-background-strong: rgba(63, 81, 181, .28);--teacher-salary-status-bg: rgba(255, 255, 255, .12);--teacher-salary-status-text: rgba(255, 255, 255, .82);--teacher-salary-status-paid-bg: rgba(102, 187, 106, .24);--teacher-salary-status-paid-text: #c8e6c9;--teacher-salary-status-unpaid-bg: rgba(244, 143, 177, .24);--teacher-salary-status-unpaid-text: #ffcdd2}.teacher-salary-container[_ngcontent-%COMP%]{height:100%;min-height:600px}.teacher-salary-drawer[_ngcontent-%COMP%]{width:min(420px,100vw);max-width:420px;padding:0}.drawer-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.drawer-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:1.25rem 1.5rem}.drawer-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600}.drawer-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--teacher-salary-text-tertiary);font-size:.875rem}.drawer-loading[_ngcontent-%COMP%], .drawer-empty[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:2rem}.drawer-section[_ngcontent-%COMP%]{padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.06em;color:var(--teacher-salary-text-tertiary)}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:600;color:var(--teacher-salary-text-primary);word-break:break-word}.summary-metrics[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}.metric-card[_ngcontent-%COMP%]{padding:.75rem;border-radius:.75rem;background:var(--teacher-salary-background-soft);display:flex;flex-direction:column;gap:.25rem}.metric-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:var(--teacher-salary-text-tertiary)}.metric-value[_ngcontent-%COMP%]{font-weight:600;font-size:1rem;color:var(--teacher-salary-text-primary)}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:600}.page-subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:var(--teacher-salary-text-secondary)}.filters-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.filters-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:1rem}.teacher-select[_ngcontent-%COMP%], .teacher-search[_ngcontent-%COMP%]{min-width:220px}.teacher-context[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--teacher-salary-text-secondary);padding:.75rem 1rem;border-radius:.75rem;background-color:var(--teacher-salary-background-soft)}.refresh-button[_ngcontent-%COMP%], .reload-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem}.table-card[_ngcontent-%COMP%]{margin-bottom:1.5rem;overflow:hidden}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.teacher-salary-table[_ngcontent-%COMP%]{width:100%;min-width:720px}.teacher-salary-table[_ngcontent-%COMP%]   .cell-primary[_ngcontent-%COMP%]{font-weight:600;color:var(--teacher-salary-text-primary)}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .75rem;border-radius:999px;font-weight:600;font-size:.85rem;background-color:var(--teacher-salary-status-bg);color:var(--teacher-salary-status-text)}.status-badge[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1rem;line-height:1}.status-badge.status-paid[_ngcontent-%COMP%]{background-color:var(--teacher-salary-status-paid-bg);color:var(--teacher-salary-status-paid-text)}.status-badge.status-unpaid[_ngcontent-%COMP%]{background-color:var(--teacher-salary-status-unpaid-bg);color:var(--teacher-salary-status-unpaid-text)}.toggle-header[_ngcontent-%COMP%], .toggle-cell[_ngcontent-%COMP%], .actions-header[_ngcontent-%COMP%], .actions-cell[_ngcontent-%COMP%]{text-align:center}.toggle-cell[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{pointer-events:auto}.actions-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap}.action-button[_ngcontent-%COMP%]{--button-size: 36px;width:var(--button-size);height:var(--button-size)}.action-button[_ngcontent-%COMP%]   .spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_invoice-spin .9s linear infinite}@keyframes _ngcontent-%COMP%_invoice-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.teacher-salary-table[_ngcontent-%COMP%]   tr.mat-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s ease}.teacher-salary-table[_ngcontent-%COMP%]   tr.mat-row[_ngcontent-%COMP%]:hover{background-color:var(--teacher-salary-background-soft)}.teacher-salary-table[_ngcontent-%COMP%]   tr.mat-row.is-selected[_ngcontent-%COMP%]{background-color:var(--teacher-salary-background-strong)}.empty-state[_ngcontent-%COMP%]{padding:1.5rem;text-align:center;color:var(--teacher-salary-text-secondary)}.summary-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.summary-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.summary-subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:var(--teacher-salary-text-secondary)}.summary-loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.summary-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}.summary-card-item[_ngcontent-%COMP%]{padding:1rem;border-radius:.75rem;background:var(--teacher-salary-background-soft);display:flex;flex-direction:column;gap:.35rem}.generation-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.generation-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.generation-title[_ngcontent-%COMP%]{font-weight:600}.generation-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;color:var(--teacher-salary-text-muted)}@media (max-width: 768px){.teacher-salary-table[_ngcontent-%COMP%]{min-width:100%}.filters-grid[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.refresh-button[_ngcontent-%COMP%], .reload-button[_ngcontent-%COMP%]{width:100%;justify-content:center}}@media (max-width: 600px){.teacher-salary-drawer[_ngcontent-%COMP%]{width:100vw;max-width:100vw}.drawer-header[_ngcontent-%COMP%]{padding:1rem;align-items:flex-start}.drawer-title[_ngcontent-%COMP%]{font-size:1.1rem}.drawer-section[_ngcontent-%COMP%]{padding:1rem}.detail-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.75rem}.detail-item[_ngcontent-%COMP%]{padding:.65rem .75rem;border-radius:.75rem;background:var(--teacher-salary-background-soft)}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.7rem;letter-spacing:.04em;text-transform:none}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:.95rem}.summary-metrics[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.metric-card[_ngcontent-%COMP%]{padding:.65rem}}"]})}return r})();const Ce=[{path:"",component:rt,data:{roles:[y.m.Admin,y.m.Manager,y.m.Teacher]}}];let _e=(()=>{class r{static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275mod=t.$C({type:r});static#a=this.\u0275inj=l.G2t({imports:[M.iI.forChild(Ce),M.iI]})}return r})(),Me=(()=>{class r{static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275mod=t.$C({type:r});static#a=this.\u0275inj=l.G2t({imports:[rt,_e]})}return r})()},7509:(st,I,c)=>{c.d(I,{f:()=>C});var M=c(8728),y=c(5416);let C=(()=>{class b{constructor(){this.snackBar=(0,M.WQX)(y.UG)}success(l,g="Close",f=3e3){this.snackBar.open(l,g,{duration:f,panelClass:["toast-success"]})}error(l,g="Close",f=3e3){this.snackBar.open(l,g,{duration:f,panelClass:["toast-error"]})}static#t=this.\u0275fac=function(g){return new(g||b)};static#e=this.\u0275prov=M.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()}}]);