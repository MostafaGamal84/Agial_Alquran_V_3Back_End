"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[2806],{72806:(dt,I,l)=>{l.r(I),l.d(I,{TeacherSalaryModule:()=>xe});var M=l(38132),y=l(88937),C=l(10467),b=l(72200),T=l(29330),m=l(48728),g=l(89417),f=l(90645),N=l(96695),R=l(90882),F=l(25084),k=l(7356),A=l(75263),L=l(71997),U=l(81074),B=l(88834),J=l(25596),ut=l(36751),H=l(33746),Y=l(72923),z=l(9183),X=l(67575),Q=l(75747),ht=l(97586),pt=l.n(ht),W=l(30450),ft=l(18359),gt=l(7673),yt=l(70152),Z=l(23294),v=l(70980),K=l(96354),bt=l(25558),D=l(22525);let vt=(()=>{class r{constructor(){this.http=(0,m.WQX)(T.Qq),this.baseUrl=`${D.c.apiUrl}/admin/teacher-salary`}getInvoices(e,n){let a=new T.Nl;return e&&(a=a.set("month",e)),n&&(a=a.set("teacherId",n.toString())),this.http.get(`${this.baseUrl}/invoices`,{params:a})}getInvoiceDetails(e){return this.http.get(`${this.baseUrl}/invoices/${e}/details`)}updatePayment(e){return this.http.post(`${D.c.apiUrl}/api/TeacherSallary/UpdatePayment`,(()=>{const i=new FormData;return Object.entries(e).forEach(([o,d])=>{null!=d&&i.append(o,String(d))}),i})())}uploadInvoiceReceipt(e,n,a){const i=new FormData;return i.append("invoiceId",e.toString()),i.append("receipt",n.file,n.fileName),a&&Object.entries(a).forEach(([o,d])=>{null!=d&&i.append(o,String(d))}),this.http.post(`${this.baseUrl}/invoices/${e}/receipt`,i)}getMonthlySummary(e,n){let a=new T.Nl;return e&&(a=a.set("month",e)),n&&(a=a.set("teacherId",n.toString())),this.http.get(`${this.baseUrl}/monthly-summary`,{params:a})}generateMonthly(e){let n=new T.Nl;return e&&(n=n.set("month",e)),this.http.post(`${this.baseUrl}/generate`,{},{params:n})}static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275prov=m.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var St=l(87509),Ct=l(76848),Mt=l(75366),q=l(68018),t=l(73664),Tt=l(9010),w=l(5404),_t=l(25079);const xt=["detailDrawer"],It=()=>[5,10,25,50],tt=(r,s)=>s.label,Rt=(r,s)=>s.id;function Ft(r,s){if(1&r&&(t.j41(0,"p",7),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.SpI(" ",(null==e.selectedInvoice?null:e.selectedInvoice.teacherName)??(null==e.detailSummary?null:e.detailSummary.teacherName)," ")}}function $t(r,s){1&r&&(t.j41(0,"div",9),t.nrm(1,"mat-progress-spinner",51),t.k0s())}function Et(r,s){if(1&r&&(t.EFF(0),t.nI1(1,"date")),2&r){const e=t.XpG(2);t.SpI(" ",t.i5U(1,1,null==e.selectedInvoice?null:e.selectedInvoice.payedAt,"medium")," ")}}function Pt(r,s){1&r&&t.EFF(0," \u2014 ")}function Nt(r,s){if(1&r&&(t.j41(0,"a",57),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r){const e=t.XpG(2);t.Y8G("href",e.getReceiptUrl(e.selectedInvoice),t.B4B),t.R7$(),t.SpI(" ",t.bMT(2,2,"View Receipt")," ")}}function kt(r,s){1&r&&t.EFF(0," \u2014 ")}function At(r,s){if(1&r&&(t.j41(0,"div",60)(1,"span",61),t.EFF(2),t.k0s(),t.j41(3,"span",62),t.EFF(4),t.k0s()()),2&r){const e=s.$implicit,n=t.XpG(3);t.R7$(2),t.JRh(e.label),t.R7$(2),t.JRh(n.formatMetricValue(e))}}function Dt(r,s){if(1&r&&(t.j41(0,"div",59),t.Z7z(1,At,5,2,"div",60,tt),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.Dyx(e.detailSummaryMetrics)}}function wt(r,s){1&r&&(t.j41(0,"p",44),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"No Summary Data For Invoice")))}function jt(r,s){if(1&r&&(t.j41(0,"div",52)(1,"h4"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",53)(5,"div",54)(6,"span",55),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"span",56),t.EFF(10),t.k0s()(),t.j41(11,"div",54)(12,"span",55),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"span",56),t.EFF(16),t.k0s()(),t.j41(17,"div",54)(18,"span",55),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"span",56),t.EFF(22),t.k0s()(),t.j41(23,"div",54)(24,"span",55),t.EFF(25),t.nI1(26,"translate"),t.k0s(),t.j41(27,"span",56),t.nVh(28,Et,2,4)(29,Pt,1,0),t.k0s()(),t.j41(30,"div",54)(31,"span",55),t.EFF(32),t.nI1(33,"translate"),t.k0s(),t.j41(34,"span",56),t.nVh(35,Nt,3,4,"a",57)(36,kt,1,0),t.k0s()()()(),t.nrm(37,"mat-divider"),t.j41(38,"div",52)(39,"div",58)(40,"h4"),t.EFF(41),t.nI1(42,"translate"),t.k0s()(),t.nVh(43,Dt,3,0,"div",59)(44,wt,3,3,"p",44),t.k0s()),2&r){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,13,"Invoice")),t.R7$(5),t.JRh(t.bMT(8,15,"Month")),t.R7$(3),t.JRh(e.formatMonth(e.selectedInvoice)),t.R7$(3),t.JRh(t.bMT(14,17,"Salary")),t.R7$(3),t.JRh(e.formatSalary(e.selectedInvoice)),t.R7$(3),t.JRh(t.bMT(20,19,"Status")),t.R7$(3),t.JRh(e.getStatusLabel(e.selectedInvoice)),t.R7$(3),t.JRh(t.bMT(26,21,"Paid At")),t.R7$(3),t.vxM(null!=e.selectedInvoice&&e.selectedInvoice.payedAt?28:29),t.R7$(4),t.JRh(t.bMT(33,23,"Receipt")),t.R7$(3),t.vxM(e.selectedInvoice&&e.getReceiptUrl(e.selectedInvoice)?35:36),t.R7$(6),t.JRh(t.bMT(42,25,"Monthly Summary")),t.R7$(2),t.vxM(e.detailSummaryMetrics.length>0?43:44)}}function Ot(r,s){1&r&&(t.j41(0,"div",10)(1,"p"),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&r&&(t.R7$(2),t.JRh(t.bMT(3,1,"Select Invoice Prompt")))}function Gt(r,s){if(1&r){const e=t.RV6();t.j41(0,"button",63),t.bIt("click",function(){m.eBV(e);const a=t.XpG();return m.Njj(a.onGenerateMonthly())}),t.j41(1,"mat-icon"),t.EFF(2,"cached"),t.k0s(),t.EFF(3),t.nI1(4,"translate"),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("disabled",e.manualGenerationLoading),t.R7$(3),t.SpI(" ",t.bMT(4,2,"Generate Monthly Invoices")," ")}}function Vt(r,s){if(1&r&&(t.j41(0,"mat-card",14)(1,"div",64)(2,"div",65),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",66)(6,"span")(7,"strong"),t.EFF(8),t.k0s(),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.j41(11,"span")(12,"strong"),t.EFF(13),t.k0s(),t.EFF(14),t.nI1(15,"translate"),t.k0s(),t.j41(16,"span")(17,"strong"),t.EFF(18),t.k0s(),t.EFF(19),t.nI1(20,"translate"),t.k0s()()()()),2&r){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,7,"Last Generation Summary")),t.R7$(5),t.JRh((null==e.generationResult?null:e.generationResult.createdCount)??0),t.R7$(),t.SpI(" ",t.bMT(10,9,"Created")),t.R7$(4),t.JRh((null==e.generationResult?null:e.generationResult.updatedCount)??0),t.R7$(),t.SpI(" ",t.bMT(15,11,"Updated")),t.R7$(4),t.JRh((null==e.generationResult?null:e.generationResult.skippedCount)??0),t.R7$(),t.SpI(" ",t.bMT(20,13,"Skipped"))}}function Lt(r,s){if(1&r&&(t.j41(0,"mat-option",69),t.EFF(1),t.k0s()),2&r){const e=s.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.fullName)}}function Ut(r,s){1&r&&t.nrm(0,"mat-progress-spinner",70)}function Bt(r,s){if(1&r){const e=t.RV6();t.j41(0,"button",75),t.bIt("click",function(){m.eBV(e);const a=t.XpG(2);return m.Njj(a.clearTeacherSearch())}),t.j41(1,"mat-icon"),t.EFF(2,"close"),t.k0s()()}if(2&r){const e=t.XpG(2);t.Y8G("disabled",e.teacherLoading)}}function Jt(r,s){if(1&r){const e=t.RV6();t.j41(0,"mat-form-field",67)(1,"mat-label"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"mat-select",68)(5,"mat-option",69),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.Z7z(8,Lt,2,2,"mat-option",69,Rt),t.k0s(),t.nVh(10,Ut,1,0,"mat-progress-spinner",70),t.k0s(),t.j41(11,"mat-form-field",71)(12,"mat-label"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.nrm(15,"input",72),t.nI1(16,"translate"),t.nVh(17,Bt,3,1,"button",73),t.k0s(),t.j41(18,"button",74),t.bIt("click",function(){m.eBV(e);const a=t.XpG();return m.Njj(a.refreshTeachers())}),t.j41(19,"mat-icon"),t.EFF(20,"refresh"),t.k0s(),t.EFF(21),t.nI1(22,"translate"),t.k0s()}if(2&r){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,12,"Teacher")),t.R7$(2),t.Y8G("formControl",e.selectedTeacher)("disabled",e.teacherLoading),t.R7$(),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(7,14,"All Teachers")),t.R7$(2),t.Dyx(e.teachers),t.R7$(2),t.vxM(e.teacherLoading?10:-1),t.R7$(3),t.JRh(t.bMT(14,16,"Search Teacher")),t.R7$(2),t.Y8G("placeholder",t.bMT(16,18,"Search by name or email"))("formControl",e.teacherSearchControl),t.R7$(2),t.vxM(e.teacherSearchControl.value?17:-1),t.R7$(),t.Y8G("disabled",e.teacherLoading),t.R7$(3),t.SpI(" ",t.bMT(22,20,"Refresh")," ")}}function Ht(r,s){1&r&&(t.j41(0,"div",21)(1,"mat-icon"),t.EFF(2,"person"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()),2&r&&(t.R7$(4),t.JRh(t.bMT(5,1,"Teacher Context Message")))}function Yt(r,s){1&r&&t.nrm(0,"mat-progress-bar",23)}function zt(r,s){1&r&&(t.j41(0,"th",76),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Teacher")))}function Xt(r,s){if(1&r&&(t.j41(0,"td",77)(1,"div",78),t.EFF(2),t.k0s()()),2&r){const e=s.$implicit;t.R7$(2),t.JRh(e.teacherName??"\u2014")}}function Qt(r,s){1&r&&(t.j41(0,"th",76),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Month")))}function Wt(r,s){if(1&r&&(t.j41(0,"td",77),t.EFF(1),t.k0s()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.JRh(n.getMonthDisplay(e))}}function Zt(r,s){1&r&&(t.j41(0,"th",76),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Salary")))}function Kt(r,s){if(1&r&&(t.j41(0,"td",77),t.EFF(1),t.k0s()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.JRh(n.formatSalary(e))}}function qt(r,s){1&r&&(t.j41(0,"th",76),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Status")))}function te(r,s){if(1&r&&(t.j41(0,"td",77)(1,"span",79)(2,"mat-icon"),t.EFF(3),t.k0s(),t.EFF(4),t.k0s()()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.AVh("status-paid",n.isInvoicePaid(e))("status-unpaid",!n.isInvoicePaid(e)),t.R7$(2),t.JRh(n.isInvoicePaid(e)?"check_circle":"hourglass_bottom"),t.R7$(),t.SpI(" ",n.getStatusLabel(e)," ")}}function ee(r,s){1&r&&(t.j41(0,"th",76),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Paid At")))}function ae(r,s){if(1&r&&(t.EFF(0),t.nI1(1,"date")),2&r){const e=t.XpG().$implicit;t.SpI(" ",t.i5U(1,1,e.payedAt,"medium")," ")}}function ne(r,s){1&r&&t.EFF(0," \u2014 ")}function re(r,s){if(1&r&&(t.j41(0,"td",77),t.nVh(1,ae,2,4)(2,ne,1,0),t.k0s()),2&r){const e=s.$implicit;t.R7$(),t.vxM(e.payedAt?1:2)}}function ie(r,s){1&r&&(t.j41(0,"th",76),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Receipt")))}function oe(r,s){if(1&r){const e=t.RV6();t.j41(0,"a",80),t.bIt("click",function(a){return m.eBV(e),m.Njj(a.stopPropagation())}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&r){const e=t.XpG().$implicit,n=t.XpG();t.Y8G("href",n.getReceiptUrl(e),t.B4B),t.R7$(),t.SpI(" ",t.bMT(2,2,"View")," ")}}function se(r,s){1&r&&t.EFF(0," \u2014 ")}function le(r,s){if(1&r&&(t.j41(0,"td",77),t.nVh(1,oe,3,4,"a",57)(2,se,1,0),t.k0s()),2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.vxM(n.getReceiptUrl(e)?1:2)}}function ce(r,s){1&r&&(t.j41(0,"th",81),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Invoice")," "))}function me(r,s){1&r&&(t.j41(0,"mat-icon",84),t.EFF(1,"autorenew"),t.k0s())}function de(r,s){1&r&&(t.j41(0,"mat-icon"),t.EFF(1,"print"),t.k0s())}function ue(r,s){if(1&r){const e=t.RV6();t.j41(0,"td",82)(1,"button",83),t.nI1(2,"translate"),t.nI1(3,"translate"),t.bIt("click",function(a){const i=m.eBV(e).$implicit,o=t.XpG();return m.Njj(o.onGenerateInvoiceReceipt(a,i))})("mousedown",function(a){return m.eBV(e),m.Njj(a.preventDefault())}),t.nVh(4,me,2,0,"mat-icon",84)(5,de,2,0,"mat-icon"),t.k0s()()}if(2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.Y8G("matTooltip",t.bMT(2,4,"Generate Invoice Tooltip"))("disabled",!n.canGenerateInvoices||!n.isInvoicePaid(e)||n.isReceiptUploading(e.id)),t.BMQ("aria-label",t.bMT(3,6,"Generate Printable Invoice")),t.R7$(3),t.vxM(n.isReceiptUploading(e.id)?4:5)}}function he(r,s){1&r&&(t.j41(0,"th",85),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"Paid Question")))}function pe(r,s){if(1&r){const e=t.RV6();t.j41(0,"td",86)(1,"mat-slide-toggle",87),t.bIt("click",function(a){return m.eBV(e),m.Njj(a.stopPropagation())})("change",function(a){const i=m.eBV(e).$implicit,o=t.XpG();return m.Njj(o.onTogglePaid(a,i))}),t.k0s()()}if(2&r){const e=s.$implicit,n=t.XpG();t.R7$(),t.Y8G("checked",n.isInvoicePaid(e))("disabled",n.isStatusUpdating(e.id))}}function fe(r,s){1&r&&t.nrm(0,"tr",88)}function ge(r,s){if(1&r){const e=t.RV6();t.j41(0,"tr",89),t.bIt("click",function(){const a=m.eBV(e).$implicit,i=t.XpG();return m.Njj(i.openInvoice(a))}),t.k0s()}if(2&r){const e=s.$implicit,n=t.XpG();t.AVh("is-selected",(null==n.selectedInvoice?null:n.selectedInvoice.id)===e.id)}}function ye(r,s){1&r&&(t.j41(0,"div",44),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"No Invoices Found")))}function be(r,s){1&r&&(t.j41(0,"div",49),t.nrm(1,"mat-progress-spinner",51),t.k0s())}function ve(r,s){if(1&r&&(t.j41(0,"div",90)(1,"span",61),t.EFF(2),t.k0s(),t.j41(3,"span",62),t.EFF(4),t.k0s()()),2&r){const e=s.$implicit,n=t.XpG(2);t.R7$(2),t.JRh(e.label),t.R7$(2),t.JRh(n.formatMetricValue(e))}}function Se(r,s){if(1&r&&(t.j41(0,"div",50),t.Z7z(1,ve,5,2,"div",90,tt),t.k0s()),2&r){const e=t.XpG();t.R7$(),t.Dyx(e.summaryMetrics)}}function Ce(r,s){1&r&&(t.j41(0,"div",44),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"No Summary Data For Month")))}const $="#134273",j="#f3f6fd",et="#dfe6f2",E="#5a5a5a",at="#212121",Me={parse:{dateInput:"MMMM YYYY"},display:{dateInput:"MMMM YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};class O extends Error{constructor(s,e){super(s),this.apiErrors=e,this.name="InvoicePrintContextError"}}let nt=(()=>{class r{constructor(){this.teacherSalaryService=(0,m.WQX)(vt),this.toastService=(0,m.WQX)(St.f),this.lookupService=(0,m.WQX)(Ct.s),this.authenticationService=(0,m.WQX)(Mt.k),this.apiBaseUrl=D.c.apiUrl.replace(/\/+$/,""),this.subscriptions=new ft.yU,this.numberFormatter=new Intl.NumberFormat(void 0,{maximumFractionDigits:0}),this.percentFormatter=new Intl.NumberFormat(void 0,{minimumFractionDigits:0,maximumFractionDigits:2}),this.currencyFormatter=new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}),this.dateTimeFormatter=new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}),this.selectedMonth=new g.MJ(pt()().startOf("month").subtract(1,"month").utc(!0)),this.selectedTeacher=new g.MJ(null),this.teacherSearchControl=new g.MJ(""),this.dataSource=new f.I6([]),this.displayedColumns=[],this.teachers=[],this.teacherLoading=!1,this.invoicesLoading=!1,this.summaryLoading=!1,this.detailsLoading=!1,this.manualGenerationLoading=!1,this.selectedInvoice=null,this.invoiceDetails=null,this.detailSummary=null,this.summary=null,this.summaryMetrics=[],this.detailSummaryMetrics=[],this.generationResult=null,this.updatingStatusIds=new Set,this.uploadingReceiptIds=new Set,this.role=this.authenticationService.getRole(),this.canManagePayments=this.role===y.m.Admin||this.role===y.m.Manager,this.canGenerateInvoices=this.role===y.m.Admin,this.isTeacher=this.role===y.m.Teacher}ngOnInit(){this.updateDisplayedColumns(),this.canManagePayments&&(this.loadTeachers(),this.subscriptions.add(this.teacherSearchControl.valueChanges.pipe((0,yt.B)(300),(0,Z.F)()).subscribe(e=>{this.loadTeachers(e??"")}))),this.subscriptions.add(this.selectedTeacher.valueChanges.pipe((0,Z.F)()).subscribe(()=>{this.resetPaginator(),this.loadInvoices(),this.loadMonthlySummary()})),this.loadInvoices(),this.loadMonthlySummary()}ngAfterViewInit(){this.paginator&&(this.dataSource.paginator=this.paginator)}ngOnDestroy(){this.subscriptions.unsubscribe(),this.updatingStatusIds.clear(),this.uploadingReceiptIds.clear()}setMonth(e,n){const a=e.clone().startOf("month").utc(!0);this.selectedMonth.setValue(a),n.close(),this.resetPaginator(),this.loadInvoices(),this.loadMonthlySummary()}reloadAll(){this.loadInvoices(),this.loadMonthlySummary()}refreshTeachers(){this.canManagePayments&&this.loadTeachers(this.teacherSearchControl.value??"")}clearTeacherSearch(){this.canManagePayments&&(this.teacherSearchControl.setValue("",{emitEvent:!1}),this.loadTeachers(""))}openInvoice(e){e&&(this.selectedInvoice=e,this.loadInvoiceDetails(e.id))}closeDetails(){this.selectedInvoice=null,this.invoiceDetails=null,this.detailSummary=null,this.detailSummaryMetrics=[],this.detailDrawer?.close()}onDrawerClosed(){this.selectedInvoice=null,this.invoiceDetails=null,this.detailSummary=null,this.detailSummaryMetrics=[]}onTogglePaid(e,n){var a=this;e.source.checked=e.checked;const i=n.id;if(!i)return e.source.checked=!e.checked,void this.toastService.error("Invoice identifier was invalid.");const o={...n},d=e.checked,p=this.buildUpdatePaymentPayload(n,d);var u;this.updatingStatusIds.add(i),this.teacherSalaryService.updatePayment(p).pipe((0,v.j)(()=>{this.updatingStatusIds.delete(i)})).subscribe({next:u=>{if(u.isSuccess){const h=this.mergeInvoiceData(o,this.extractInvoiceFromStatusResponse(u));this.toastService.success(`Invoice marked as ${d?"paid":"unpaid"}.`),this.applyInvoiceUpdate(h),this.loadInvoices()}else e.source.checked=!d,this.handleErrors(u.errors,"Failed to update invoice payment status.")},error:(u=(0,C.A)(function*(h){e.source.checked=!d,yield a.notifyHttpError(h,"Failed to update invoice payment status.")}),function(G){return u.apply(this,arguments)})})}isStatusUpdating(e){return this.updatingStatusIds.has(e)}isReceiptUploading(e){return"number"==typeof e&&this.uploadingReceiptIds.has(e)}onGenerateInvoiceReceipt(e,n){var a=this;if(e.stopPropagation(),!this.canGenerateInvoices)return;const i=n.id;if(!i)return void this.toastService.error("Invoice identifier was invalid.");if(this.isReceiptUploading(i))return;const o={...n},d={payStatue:!0,isCancelled:!1},p=this.getSalaryAmount(o);null!==p&&(d.amount=p),this.uploadingReceiptIds.add(i);const S=this.getInvoicePrintContext(i,o).pipe((0,K.T)(u=>this.createInvoicePrintArtifacts(u)),(0,bt.n)(u=>(this.presentInvoicePrint(u.html,u.fileName,u.blob),this.teacherSalaryService.uploadInvoiceReceipt(i,u.receipt,d))),(0,v.j)(()=>{this.uploadingReceiptIds.delete(i)})).subscribe({next:u=>{if(u.isSuccess){const h=this.mergeInvoiceData(o,this.extractInvoiceFromStatusResponse(u));this.applyInvoiceUpdate(h),this.toastService.success("Printable invoice generated and uploaded successfully.")}else this.handleErrors(u.errors,"Failed to upload the printable invoice.")},error:(u=(0,C.A)(function*(h){h instanceof O?h.apiErrors?.length?a.handleErrors(h.apiErrors,"Failed to upload the printable invoice."):a.toastService.error(h.message||"Failed to upload the printable invoice."):h instanceof Error&&"PRINT_RENDER_FAILED"===h.message?a.toastService.error("Failed to render the printable invoice."):yield a.notifyHttpError(h,"Failed to upload the printable invoice.")}),function(G){return u.apply(this,arguments)})});var u;this.subscriptions.add(S)}onGenerateMonthly(){if(this.manualGenerationLoading)return;const e=this.toMonthParam(this.selectedMonth.value);this.manualGenerationLoading=!0,this.teacherSalaryService.generateMonthly(e).pipe((0,v.j)(()=>this.manualGenerationLoading=!1)).subscribe({next:n=>{n.isSuccess?(this.generationResult=n.data??null,this.toastService.success(`Generation complete. Created ${this.generationResult?.createdCount??0}, updated ${this.generationResult?.updatedCount??0}, skipped ${this.generationResult?.skippedCount??0}.`),this.loadInvoices(),this.loadMonthlySummary()):this.handleErrors(n.errors,"Failed to generate monthly invoices.")},error:()=>{this.toastService.error("Failed to generate monthly invoices.")}})}formatMonth(e){return e?this.formatMonthString(this.extractMonthValue(e)):"\u2014"}formatSummaryMonth(){const e=this.summary?.month;if(e)return this.formatMonthString(e);const n=this.selectedMonth.value;return n?this.formatMonthString(n.toISOString()):"\u2014"}formatSalary(e){const n=this.getSalaryAmount(e);return this.formatCurrency(n)}formatCurrency(e){if(null==e||Number.isNaN(e))return"\u2014";try{return this.currencyFormatter.format(e)}catch{return e.toFixed(2)}}formatDateTime(e,n){if(null==e||""===e)return"\u2014";const a=this.parseDate(e);if(!a)return"string"==typeof e?e:"\u2014";if(n)try{return new Intl.DateTimeFormat(n,{dateStyle:"medium",timeStyle:"short"}).format(a)}catch{return a.toLocaleString(n)}try{return this.dateTimeFormatter.format(a)}catch{return a.toLocaleString()}}parseDate(e){if(e instanceof Date&&!Number.isNaN(e.getTime()))return e;if("string"==typeof e&&e.trim().length>0){const n=new Date(e);if(!Number.isNaN(n.getTime()))return n}if("number"==typeof e&&Number.isFinite(e)){const n=new Date(e);if(!Number.isNaN(n.getTime()))return n}return null}formatMetricValue(e){if(null==e.value||""===e.value)return"\u2014";if("currency"===e.type){const n=this.coerceNumber(e.value);return null!==n?this.formatCurrency(n):String(e.value)}if("number"===e.type){const n=this.coerceNumber(e.value);if(null!==n){const a=this.numberFormatter.format(n);return e.suffix?`${a} ${e.suffix}`:a}return String(e.value)}if("percentage"===e.type){const n=this.coerceNumber(e.value);if(null!==n){const a=Math.abs(n)<=1?100*n:n;return`${this.percentFormatter.format(a)}%`}return String(e.value)}return String(e.value)}getStatusLabel(e){if(!e)return"Unpaid";const n=[e.status,e.paymentStatus,this.isInvoicePaid(e)?"Paid":"Unpaid"];for(const a of n)if("string"==typeof a&&a.trim().length>0)return a;return this.isInvoicePaid(e)?"Paid":"Unpaid"}isInvoicePaid(e){if(!e)return!1;const n=[e.isPayed,e.isPaid,e.paid];for(const i of n){if("boolean"==typeof i)return i;if("string"==typeof i){const o=i.toLowerCase();if("paid"===o||"true"===o)return!0;if("unpaid"===o||"false"===o)return!1}}const a="string"==typeof e.status?e.status.toLowerCase():"string"==typeof e.paymentStatus?String(e.paymentStatus).toLowerCase():void 0;if(a){if(a.includes("paid")&&!a.includes("un"))return!0;if(a.includes("unpaid"))return!1}return!1}getReceiptUrl(e){const n=[e.receiptUrl,e.receiptLink,e.receipt,e.receiptUrl];for(const i of n)if("string"==typeof i&&i.trim().length>0){const o=i.trim();return/^(https?:)?\/\//i.test(o)||/^blob:/i.test(o)||/^data:/i.test(o)?o:this.toAbsoluteApiUrl(o)}const a=e.receiptPath;return"string"==typeof a&&a.trim().length>0?this.toAbsoluteApiUrl(a):e.id?`${this.apiBaseUrl}/api/TeacherSallary/GetPaymentReceipt?invoiceId=${e.id}`:null}getMonthDisplay(e){return this.formatMonth(e)}handleRowKey(e,n){return n.id??e}loadTeachers(e){if(!this.canManagePayments)return;const n={skipCount:0,maxResultCount:50,searchTerm:e?.trim()??void 0};this.teacherLoading=!0,this.lookupService.getUsersForSelects(n,Number(y.m.Teacher),0,0,0).pipe((0,v.j)(()=>this.teacherLoading=!1)).subscribe({next:a=>{a.isSuccess?this.teachers=a.data?.items??[]:(this.teachers=[],this.handleErrors(a.errors,"Failed to load teachers."))},error:()=>{this.teachers=[],this.toastService.error("Failed to load teachers.")}})}loadInvoices(){const e=this.toMonthParam(this.selectedMonth.value),n=this.canManagePayments?this.selectedTeacher.value:null;this.invoicesLoading=!0,this.teacherSalaryService.getInvoices(e,n??null).pipe((0,v.j)(()=>this.invoicesLoading=!1)).subscribe({next:a=>{if(a.isSuccess){const i=Array.isArray(a.data)?a.data:[];this.applyInvoices(i)}else this.applyInvoices([]),this.handleErrors(a.errors,"Failed to load teacher salary invoices.")},error:()=>{this.applyInvoices([]),this.toastService.error("Failed to load teacher salary invoices.")}})}loadMonthlySummary(){const e=this.toMonthParam(this.selectedMonth.value),n=this.canManagePayments?this.selectedTeacher.value:null;this.summaryLoading=!0,this.teacherSalaryService.getMonthlySummary(e,n??null).pipe((0,v.j)(()=>this.summaryLoading=!1)).subscribe({next:a=>{a.isSuccess?(this.summary=a.data??null,this.summaryMetrics=this.buildSummaryMetrics(this.summary)):(this.summary=null,this.summaryMetrics=[],this.handleErrors(a.errors,"Failed to load teacher monthly summary."))},error:()=>{this.summary=null,this.summaryMetrics=[],this.toastService.error("Failed to load teacher monthly summary.")}})}loadInvoiceDetails(e,n=!0){this.detailsLoading=!0,this.teacherSalaryService.getInvoiceDetails(e).pipe((0,v.j)(()=>this.detailsLoading=!1)).subscribe({next:a=>{if(a.isSuccess){this.invoiceDetails=a.data,this.detailSummary=a.data?.monthlySummary??null;const i=this.detailSummary?.invoice??a.data?.invoice??this.selectedInvoice;this.selectedInvoice=this.findInvoiceById(e)??i??null,this.detailSummaryMetrics=this.buildSummaryMetrics(this.detailSummary),n&&setTimeout(()=>this.detailDrawer?.open(),0)}else this.handleErrors(a.errors,"Failed to load invoice details.")},error:()=>{this.toastService.error("Failed to load invoice details.")}})}updateDisplayedColumns(){const e=["teacher","month","salary","status","paidAt","receipt"];this.canGenerateInvoices&&e.push("actions"),this.displayedColumns=this.canManagePayments?[...e,"toggle"]:e}resetPaginator(){this.paginator&&this.paginator.firstPage()}toMonthParam(e){return e?e.clone().startOf("month").utc(!0).format("YYYY-MM-DD"):null}applyInvoices(e){const n=[...e].sort((a,i)=>this.compareByMonthDesc(a,i));if(this.dataSource.data=n,this.paginator&&(this.dataSource.paginator=this.paginator),this.selectedInvoice){const a=n.find(i=>i.id===this.selectedInvoice?.id);a?this.selectedInvoice=a:this.closeDetails()}}compareByMonthDesc(e,n){const a=this.resolveInvoiceTime(e),i=this.resolveInvoiceTime(n);return i!==a?i-a:(n.id??0)-(e.id??0)}resolveInvoiceTime(e){const n=this.extractMonthValue(e);if(n){const i=new Date(n);if(!Number.isNaN(i.getTime()))return i.getTime()}const a=[e.payedAt,e.createdAt,e.invoiceDate,e.updatedAt,e.modifiedAt,e.modefiedAt];for(const i of a){if(i instanceof Date)return i.getTime();if("string"==typeof i){const o=new Date(i);if(!Number.isNaN(o.getTime()))return o.getTime()}}return e.id??0}extractMonthValue(e){const n=[e.month,e.monthDate,e.monthValue,e.monthStart,e.period,e.month,e.monthUtc];for(const a of n){if(a instanceof Date)return a.toISOString();if("string"==typeof a&&a.trim().length>0)return a}}formatMonthString(e){if(!e)return"\u2014";const n=new Date(e);return Number.isNaN(n.getTime())?e:new Intl.DateTimeFormat(void 0,{month:"long",year:"numeric"}).format(n)}getSalaryAmount(e){if(!e)return null;const n=["salary","salaryAmount","totalSalary","salaryTotal","netSalary","amount"];for(const a of n){const o=this.coerceNumber(e[a]);if(null!==o)return o}return null}buildSummaryMetrics(e){if(!e)return[];const n=[],a=(i,o,d,p)=>{for(const S of o){const u=e[S];if(null!=u&&""!==u){if("currency"===d||"number"===d||"percentage"===d){const h=this.coerceNumber(u);if(null!==h)return void n.push({label:i,value:h,type:d,suffix:p})}if("string"==typeof u&&u.trim().length>0)return void n.push({label:i,value:u,type:"text",suffix:p})}}};return a("Reports",["totalReports","reportCount"],"number"),a("Attendance",["presentCount","attendanceCount","totalAttendance","attendedSessions"],"number"),a("Absence (Excused)",["absentWithExcuseCount"],"number"),a("Absence (Unexcused)",["absentWithoutExcuseCount"],"number"),a("Absence (Total)",["absenceCount","totalAbsence","missedSessions"],"number"),a("Sessions",["sessionCount","lessonsCount"],"number"),a("Teaching Minutes",["teachingMinutes","totalMinutes"],"number","min"),a("Overtime Minutes",["overtimeMinutes"],"number","min"),a("Base Salary",["baseSalary"],"currency"),a("Salary Total",["salaryTotal","totalSalary"],"currency"),a("Bonuses",["bonusTotal","bonuses","totalBonus"],"currency"),a("Deductions",["deductionTotal","deductions","totalDeduction"],"currency"),a("Net Salary",["netSalary","takeHomePay"],"currency"),a("Hourly Rate",["hourlyRate"],"currency"),a("Attendance Rate",["attendanceRate"],"percentage"),n}coerceNumber(e){if("number"==typeof e&&!Number.isNaN(e))return e;if("string"==typeof e){const n=e.trim();if(0===n.length)return null;const a=Number(n);if(!Number.isNaN(a))return a}return null}handleErrors(e,n){if(e&&e.length>0){const a=e.map(i=>i.message||i.code).filter(i=>!!i&&i.trim().length>0).join(" \u2022 ");if(a.length>0)return void this.toastService.error(a)}this.toastService.error(n)}findInvoiceById(e){return this.dataSource.data.find(n=>n.id===e)??null}buildUpdatePaymentPayload(e,n){const a={id:e.id},i=this.getSalaryAmount(e);return null!==i&&(a.amount=i),n?(a.payStatue=!0,a.isCancelled=!1):(a.payStatue=!1,a.isCancelled=!0),a}buildReceiptFileName(e){const n=this.toSlug(e.teacherName??"teacher"),a=this.formatMonth(e),i=this.toSlug(a);return`teacher-invoice-${n.length>0?n:"teacher"}-${i.length>0?i:"month"}${e.id?`-${e.id}`:""}.html`}mergeInvoiceData(e,n){const a={...e};return n?{...a,...n}:a}applyInvoiceUpdate(e){if(!e?.id)return void this.loadInvoices();const n=this.dataSource.data.findIndex(i=>i.id===e.id);if(-1===n)return void this.loadInvoices();const a=[...this.dataSource.data];a[n]=this.mergeInvoiceData(a[n],e),this.applyInvoices(a),this.selectedInvoice?.id===e.id&&this.loadInvoiceDetails(e.id,!1)}extractInvoiceFromStatusResponse(e){return e?this.resolveInvoiceFromPayload(e.data):null}resolveInvoiceFromPayload(e){if(!e||"boolean"==typeof e)return null;if(this.isTeacherSalaryInvoice(e))return e;if(Array.isArray(e))return e.find(a=>this.isTeacherSalaryInvoice(a))??null;if("object"==typeof e){const n=e,a=n.invoice;if(this.isTeacherSalaryInvoice(a))return a;const i=n.data;if(i&&i!==e){const o=this.resolveInvoiceFromPayload(i);if(o)return o}}return null}isTeacherSalaryInvoice(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&Number.isFinite(e.id??NaN)}toAbsoluteApiUrl(e){if(/^https?:\/\//i.test(e))return e;const n=e.replace(/^\/+/,"");return`${this.apiBaseUrl}/${n}`}toSlug(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}getInvoicePrintContext(e,n){const a=this.buildInvoicePrintContext(e,n);return a?(0,gt.of)(a):this.teacherSalaryService.getInvoiceDetails(e).pipe((0,K.T)(i=>{if(i.isSuccess){const d=this.buildInvoicePrintContext(e,n,i.data??null);if(d)return d;throw new O("Invoice data was incomplete for building the printable invoice.")}throw new O("Failed to load data for the printable invoice.",i.errors)}))}buildInvoicePrintContext(e,n,a){const i=a??(this.invoiceDetails?.invoice?.id===e?this.invoiceDetails:null),o=i?.invoice??this.findInvoiceById(e)??(this.selectedInvoice?.id===e?this.selectedInvoice:null)??n??null;return o?{invoice:o,summary:i?.monthlySummary??(this.selectedInvoice?.id===e?this.detailSummary:null)??null??null,details:i??null}:null}createInvoicePrintArtifacts(e){try{const n=this.buildInvoicePrintHtml(e),a=this.buildReceiptFileName(e.invoice),i=new Blob([n],{type:"text/html"});return{html:n,blob:i,fileName:a,receipt:{file:i,fileName:a}}}catch(n){throw console.error("Failed to render printable invoice",n),new Error("PRINT_RENDER_FAILED")}}buildInvoicePrintHtml(e){const n=e.invoice,a=e.summary,i=n.id??null,o=null!==i?this.numberFormatter.format(i):"\u2014",d=this.formatArabicNumber(i),p=this.resolveInvoiceNumber(n,["teacherId"])??this.resolveSummaryNumber(a,["teacherId"]),S=this.resolveTeacherName(n,a),u=this.resolveSummaryString(a,["teacherNameAr","teacherArabicName","teacherName"])??S,h=this.resolveInvoiceMonth(e),G=this.resolveInvoiceMonthArabic(e),Ie=this.resolvePaymentDateDisplay(n),Re=this.resolvePaymentDateDisplay(n,"ar-EG"),rt=this.getStatusLabel(n),it=this.getStatusLabel(n),P=this.getSalaryAmount(n),ot=this.formatCurrency(P),st=this.formatArabicCurrency(P),Fe=this.formatDateTime(new Date),$e=this.formatDateTime(new Date,"ar-EG"),Ee=this.resolveSummaryNumber(a,["baseSalary"]),lt=this.resolveSummaryNumber(a,["salaryTotal","totalSalary"])??P,Pe=this.resolveSummaryNumber(a,["bonusTotal","bonuses","totalBonus"]),Ne=this.resolveSummaryNumber(a,["deductionTotal","deductions","totalDeduction"]),V=this.resolveSummaryNumber(a,["netSalary","takeHomePay"])??this.resolveInvoiceNumber(n,["netSalary","netPay"])??lt??P,ke=this.resolveSummaryNumber(a,["hourlyRate"]),Ae=this.resolveSummaryNumber(a,["attendanceCount","totalAttendance","attendedSessions"]),De=this.resolveSummaryNumber(a,["absenceCount","totalAbsence","missedSessions"]),we=this.resolveSummaryNumber(a,["sessionCount","lessonsCount"]),je=this.resolveSummaryNumber(a,["teachingMinutes","totalMinutes"]),Oe=this.resolveSummaryNumber(a,["overtimeMinutes"]),_=this.resolveSummaryNumber(a,["attendanceRate"]),x=null==_?null:Math.abs(_)<=1?100*_:_,ct=null===x?"\u2014":`${this.percentFormatter.format(x)}%`,mt=null===x?"\u2014":`${this.formatArabicPercent(x)}\u066a`,Ge=[{titleEn:"Invoice Amount",titleAr:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",value:ot,valueAr:st},{titleEn:"Net Salary",titleAr:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",value:this.formatCurrency(V),valueAr:this.formatArabicCurrency(V)},{titleEn:"Attendance Rate",titleAr:"\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",value:ct,valueAr:mt},{titleEn:"Status",titleAr:"\u0627\u0644\u062d\u0627\u0644\u0629",value:rt,valueAr:it}],Ve=[{labelEn:"Invoice Number",valueEn:o,labelAr:"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueAr:d},{labelEn:"Teacher ID",valueEn:null!==p?this.numberFormatter.format(p):"\u2014",labelAr:"\u0631\u0642\u0645 \u0627\u0644\u0645\u0639\u0644\u0645",valueAr:this.formatArabicNumber(p)},{labelEn:"Teacher",valueEn:S,labelAr:"\u0627\u0633\u0645 \u0627\u0644\u0645\u0639\u0644\u0645",valueAr:u},{labelEn:"Billing Month",valueEn:h,labelAr:"\u0634\u0647\u0631 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueAr:G},{labelEn:"Payment Date",valueEn:Ie,labelAr:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062f\u0641\u0639",valueAr:Re},{labelEn:"Status",valueEn:rt,labelAr:"\u0627\u0644\u062d\u0627\u0644\u0629",valueAr:it},{labelEn:"Invoice Amount",valueEn:ot,labelAr:"\u0642\u064a\u0645\u0629 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629",valueAr:st,highlight:!0},{labelEn:"Generated On",valueEn:Fe,labelAr:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u0646\u0634\u0627\u0621",valueAr:$e}],Le=[{labelEn:"Base Salary",value:Ee,labelAr:"\u0627\u0644\u0631\u0627\u062a\u0628 \u0627\u0644\u0623\u0633\u0627\u0633\u064a"},{labelEn:"Bonuses",value:Pe,labelAr:"\u0627\u0644\u0645\u0643\u0627\u0641\u0622\u062a"},{labelEn:"Deductions",value:Ne,labelAr:"\u0627\u0644\u062e\u0635\u0648\u0645\u0627\u062a"},{labelEn:"Net Salary",value:V,labelAr:"\u0635\u0627\u0641\u064a \u0627\u0644\u0631\u0627\u062a\u0628",highlight:!0},{labelEn:"Total Salary",value:lt,labelAr:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0631\u0627\u062a\u0628",highlight:!0},{labelEn:"Hourly Rate",value:ke,labelAr:"\u0627\u0644\u0623\u062c\u0631 \u0628\u0627\u0644\u0633\u0627\u0639\u0629"}],Ue=[{labelEn:"Attendance",value:Ae,labelAr:"\u0627\u0644\u062d\u0636\u0648\u0631",formatEn:c=>this.numberFormatter.format(c),formatAr:c=>`${this.formatArabicNumber(c)} \u062d\u0636\u0648\u0631`},{labelEn:"Absence",value:De,labelAr:"\u0627\u0644\u063a\u064a\u0627\u0628",formatEn:c=>this.numberFormatter.format(c),formatAr:c=>`${this.formatArabicNumber(c)} \u063a\u064a\u0627\u0628`},{labelEn:"Sessions",value:we,labelAr:"\u0639\u062f\u062f \u0627\u0644\u062d\u0635\u0635",formatEn:c=>this.numberFormatter.format(c),formatAr:c=>`${this.formatArabicNumber(c)} \u062d\u0635\u0629`},{labelEn:"Teaching Minutes",value:je,labelAr:"\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u062a\u062f\u0631\u064a\u0633",formatEn:c=>`${this.numberFormatter.format(c)} min`,formatAr:c=>`${this.formatArabicNumber(c)} \u062f\u0642\u064a\u0642\u0629`},{labelEn:"Overtime Minutes",value:Oe,labelAr:"\u0627\u0644\u062f\u0642\u0627\u0626\u0642 \u0627\u0644\u0625\u0636\u0627\u0641\u064a\u0629",formatEn:c=>`${this.numberFormatter.format(c)} min`,formatAr:c=>`${this.formatArabicNumber(c)} \u062f\u0642\u064a\u0642\u0629 \u0625\u0636\u0627\u0641\u064a\u0629`}].filter(c=>null!=c.value).map(c=>this.buildPrintRow(c.labelEn,c.formatEn(c.value),c.labelAr,c.formatAr(c.value))).join(""),Be=Le.filter(c=>null!=c.value).map(c=>this.buildPrintRow(c.labelEn,this.formatCurrency(c.value),c.labelAr,this.formatArabicCurrency(c.value),{highlight:!!c.highlight})).join(""),Je=Ve.map(c=>this.buildPrintRow(c.labelEn,c.valueEn,c.labelAr,c.valueAr,{highlight:!!c.highlight})).join(""),He=Ge.map(c=>this.buildSummaryCardHtml(c)).join(""),Xe=this.buildPrintStyles(),Qe=null!==x?this.buildPrintRow("Attendance Rate",ct,"\u0646\u0633\u0628\u0629 \u0627\u0644\u062d\u0636\u0648\u0631",mt):"";return`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="utf-8" />\n  <title>${this.escapeHtml("Teacher Salary Invoice"+("\u2014"!==o?` #${o}`:""))}</title>\n  <style>\n${Xe}\n  </style>\n</head>\n<body>\n  <div class="print-page">\n    <header class="print-header">\n      <div class="header-text">\n        <h1>Teacher Salary Invoice</h1>\n        <h2 dir="rtl">\u0641\u0627\u062a\u0648\u0631\u0629 \u0631\u0627\u062a\u0628 \u0627\u0644\u0645\u0639\u0644\u0645</h2>\n      </div>\n      <div class="header-meta">\n        <span class="label">Invoice</span>\n        <span class="value">${this.escapeHtml(o)}</span>\n        <span class="value" dir="rtl">${this.escapeHtml(d)}</span>\n      </div>\n    </header>\n    <section class="summary-cards">\n      ${He}\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3>Invoice Details</h3>\n        <h4 dir="rtl">\u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629</h4>\n      </div>\n      <div class="print-grid">\n        ${Je}\n      </div>\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3>Salary Breakdown</h3>\n        <h4 dir="rtl">\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0631\u0627\u062a\u0628</h4>\n      </div>\n      <div class="print-grid">\n        ${Be}\n      </div>\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3>Attendance Summary</h3>\n        <h4 dir="rtl">\u0645\u0644\u062e\u0635 \u0627\u0644\u062d\u0636\u0648\u0631</h4>\n      </div>\n      <div class="print-grid">\n        ${Ue}\n        ${Qe}\n      </div>\n    </section>\n    <section class="print-section">\n      <div class="section-title">\n        <h3>Notes</h3>\n        <h4 dir="rtl">\u0645\u0644\u0627\u062d\u0638\u0627\u062a</h4>\n      </div>\n      <div class="notes-card">\n        <p>${this.escapeHtml("This invoice has been generated automatically based on recorded salary and attendance data for the selected period.")}</p>\n        <p dir="rtl">${this.escapeHtml("\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u0647\u0630\u0647 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u062a\u0644\u0642\u0627\u0626\u064a\u0627\u064b \u0627\u0633\u062a\u0646\u0627\u062f\u0627\u064b \u0625\u0644\u0649 \u0628\u064a\u0627\u0646\u0627\u062a \u0627\u0644\u0631\u0627\u062a\u0628 \u0648\u0627\u0644\u062d\u0636\u0648\u0631 \u0644\u0644\u0641\u062a\u0631\u0629 \u0627\u0644\u0645\u062d\u062f\u062f\u0629.")}</p>\n      </div>\n    </section>\n  </div>\n  <script>\n    window.addEventListener('load', () => {\n      setTimeout(() => {\n        try {\n          window.print();\n        } catch (err) {\n          console.error(err);\n        }\n      }, 300);\n    });\n  <\/script>\n</body>\n</html>`}buildPrintStyles(){return`\n      :root {\n        color-scheme: only light;\n      }\n      * {\n        box-sizing: border-box;\n      }\n      body {\n        margin: 0;\n        padding: 24px;\n        background: ${j};\n        color: ${at};\n        font-family: 'Cairo Variable', 'Cairo', 'Tajawal', 'Helvetica Neue', Arial, sans-serif;\n        line-height: 1.6;\n      }\n      .print-page {\n        max-width: 860px;\n        margin: 0 auto;\n        background: #fff;\n        padding: 32px;\n        border-radius: 20px;\n        box-shadow: 0 24px 48px rgba(19, 66, 115, 0.12);\n      }\n      .print-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-end;\n        background: ${$};\n        color: #fff;\n        padding: 24px;\n        border-radius: 16px;\n      }\n      .header-text h1 {\n        margin: 0;\n        font-size: 28px;\n      }\n      .header-text h2 {\n        margin: 4px 0 0;\n        font-size: 22px;\n        font-weight: 500;\n      }\n      .header-meta {\n        display: flex;\n        flex-direction: column;\n        align-items: flex-end;\n        font-weight: 600;\n      }\n      .header-meta .label {\n        text-transform: uppercase;\n        font-size: 12px;\n        letter-spacing: 1px;\n        opacity: 0.8;\n      }\n      .header-meta .value {\n        font-size: 20px;\n      }\n      .summary-cards {\n        display: grid;\n        gap: 16px;\n        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n        margin: 28px 0;\n      }\n      .summary-card {\n        background: ${j};\n        border: 1px solid ${et};\n        border-radius: 14px;\n        padding: 18px;\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n      .summary-card .summary-title {\n        font-weight: 600;\n        color: ${E};\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n      }\n      .summary-card .summary-value {\n        font-size: 20px;\n        font-weight: 700;\n        color: ${$};\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n      }\n      .print-section + .print-section {\n        margin-top: 32px;\n      }\n      .section-title h3,\n      .section-title h4 {\n        margin: 0;\n      }\n      .section-title h4 {\n        color: ${E};\n        font-weight: 500;\n      }\n      .print-grid {\n        margin-top: 16px;\n        display: grid;\n        gap: 12px;\n      }\n      .print-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));\n        gap: 12px;\n        align-items: stretch;\n        border: 1px solid ${et};\n        border-radius: 12px;\n        padding: 14px 18px;\n        background: #fff;\n      }\n      .print-row.highlight {\n        border-color: ${$};\n        background: rgba(19, 66, 115, 0.08);\n      }\n      .row-text {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n      }\n      .row-text .label {\n        font-size: 13px;\n        font-weight: 600;\n        text-transform: uppercase;\n        color: ${E};\n        letter-spacing: 0.5px;\n      }\n      .row-text .value {\n        font-size: 16px;\n        font-weight: 600;\n        color: ${at};\n        word-break: break-word;\n      }\n      .row-text.ar {\n        text-align: right;\n        direction: rtl;\n      }\n      .row-text.ar .value {\n        font-family: 'Cairo Variable', 'Cairo', 'Tajawal', 'Helvetica Neue', Arial, sans-serif;\n      }\n      .notes-card {\n        border: 1px dashed ${$};\n        border-radius: 12px;\n        padding: 18px;\n        background: ${j};\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n      .notes-card p {\n        margin: 0;\n        color: ${E};\n        font-size: 15px;\n      }\n      @media print {\n        body {\n          background: #fff;\n          padding: 0;\n        }\n        .print-page {\n          box-shadow: none;\n          border-radius: 0;\n        }\n      }\n    `}buildPrintRow(e,n,a,i,o={}){const d=["print-row"];return o.highlight&&d.push("highlight"),`\n      <div class="${d.join(" ")}">\n        <div class="row-text en">\n          <span class="label">${this.escapeHtml(e)}</span>\n          <span class="value">${this.escapeHtml(n)}</span>\n        </div>\n        <div class="row-text ar" dir="rtl">\n          <span class="label">${this.escapeHtml(a)}</span>\n          <span class="value">${this.escapeHtml(i)}</span>\n        </div>\n      </div>\n    `}buildSummaryCardHtml(e){return`\n      <div class="summary-card">\n        <div class="summary-title">\n          <span>${this.escapeHtml(e.titleEn)}</span>\n          <span dir="rtl">${this.escapeHtml(e.titleAr)}</span>\n        </div>\n        <div class="summary-value">\n          <span>${this.escapeHtml(e.value)}</span>\n          <span dir="rtl">${this.escapeHtml(e.valueAr??e.value)}</span>\n        </div>\n      </div>\n    `}escapeHtml(e){return null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}formatArabicNumber(e){if(null==e||Number.isNaN(e))return"\u2014";try{return new Intl.NumberFormat("ar-EG",{maximumFractionDigits:0}).format(e)}catch{return this.numberFormatter.format(e)}}formatArabicCurrency(e){if(null==e||Number.isNaN(e))return"\u2014";try{return new Intl.NumberFormat("ar-EG",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}catch{return this.formatCurrency(e)}}formatArabicPercent(e){if(null==e||Number.isNaN(e))return"\u2014";try{return new Intl.NumberFormat("ar-EG",{minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}catch{return this.percentFormatter.format(e)}}formatArabicMonthString(e){if(!e)return"\u2014";const n=new Date(e);if(!Number.isNaN(n.getTime()))try{return new Intl.DateTimeFormat("ar-EG",{month:"long",year:"numeric"}).format(n)}catch{return this.formatMonthString(e)}return e}resolveInvoiceMonthArabic(e){const n=this.extractMonthValue(e.invoice);if(n){const o=this.formatArabicMonthString(n);if("\u2014"!==o)return o}const a=this.resolveSummaryString(e.summary,["month"]);if(a)return this.formatArabicMonthString(a);const i=this.selectedMonth.value;return i?this.formatArabicMonthString(i.toISOString()):"\u2014"}presentInvoicePrint(e,n,a){const i=a??new Blob([e],{type:"text/html"});if(typeof window<"u"){const o=window.open("","_blank");if(o)return o.document.open(),o.document.write(e),o.document.close(),o.focus(),void setTimeout(()=>{try{o.print()}catch{}},400);if(typeof URL<"u"){const d=URL.createObjectURL(i),p=document.createElement("a");p.href=d,p.download=n,p.click(),setTimeout(()=>{try{URL.revokeObjectURL(d)}catch{}},12e4)}}}resolveTeacherName(e,n){return("string"==typeof e.teacherName&&e.teacherName.trim().length>0?e.teacherName.trim():null)||(this.resolveSummaryString(n,["teacherName"])??"\u2014")}resolveInvoiceMonth(e){const n=this.formatMonth(e.invoice);if(n&&"\u2014"!==n)return n;const a=this.resolveSummaryString(e.summary,["month"]);return a?this.formatMonthString(a):"\u2014"}resolvePaymentDateDisplay(e,n){const a=[e.payedAt,e.paidAt,e.paymentDate,e.lastPaymentDate];for(const i of a){const o=this.formatDateTime(i,n);if("\u2014"!==o)return o}return this.formatDateTime(new Date,n)}resolveInvoiceNumber(e,n){if(!e)return null;for(const a of n){const o=this.coerceNumber(e[a]);if(null!==o)return o}return null}resolveSummaryNumber(e,n){if(!e)return null;for(const a of n){const o=this.coerceNumber(e[a]);if(null!==o)return o}return null}resolveSummaryString(e,n){if(!e)return null;for(const a of n){const i=e[a];if("string"==typeof i&&i.trim().length>0)return i.trim()}return null}notifyHttpError(e,n){var a=this;return(0,C.A)(function*(){if(e instanceof T.yz){const i=yield a.extractHttpErrorMessage(e);if(i&&i.trim().length>0)return void a.toastService.error(i)}a.toastService.error(n)})()}extractHttpErrorMessage(e){return(0,C.A)(function*(){const n=e.error;if(!n)return null;if("string"==typeof n){const a=n.trim();return a.length>0?a:null}if(n instanceof Blob)try{const a=(yield n.text()).trim();if(!a)return null;try{const i=JSON.parse(a);if("string"==typeof i)return i;if(i&&"string"==typeof i.message)return i.message;if(i&&"string"==typeof i.error)return i.error}catch{return a}}catch{return null}if("object"==typeof n&&null!==n){const a=n.message??n.error;if("string"==typeof a){const i=a.trim();if(i.length>0)return i}}return null})()}static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275cmp=t.VBU({type:r,selectors:[["app-teacher-salary"]],viewQuery:function(n,a){if(1&n&&(t.GBs(N.iy,5),t.GBs(xt,5)),2&n){let i;t.mGM(i=t.lsd())&&(a.paginator=i.first),t.mGM(i=t.lsd())&&(a.detailDrawer=i.first)}},features:[t.Jv_([{provide:k.D,useClass:A.QH,deps:[k.M,A.ij]},{provide:k.a,useValue:Me}])],decls:92,vars:38,consts:[["detailDrawer",""],["monthPicker",""],[1,"teacher-salary-container"],["mode","over","position","end",1,"teacher-salary-drawer",3,"closedStart"],[1,"drawer-content"],[1,"drawer-header"],[1,"drawer-title"],[1,"drawer-subtitle"],["mat-icon-button","","type","button",3,"click"],[1,"drawer-loading"],[1,"drawer-empty"],[1,"page-header"],[1,"page-subtitle"],["mat-flat-button","","color","primary","type","button",3,"disabled"],[1,"generation-card"],[1,"filters-card"],[1,"filters-grid"],["appearance","outline"],["matInput","",3,"matDatepicker","formControl"],["matIconSuffix","",3,"for"],["startView","multi-year","panelClass","month-picker",3,"monthSelected"],[1,"teacher-context"],["mat-stroked-button","","color","primary","type","button",1,"reload-button",3,"click","disabled"],["mode","indeterminate"],[1,"table-card"],[1,"table-container"],["mat-table","",1,"teacher-salary-table",3,"dataSource"],["matColumnDef","teacher"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","month"],["matColumnDef","salary"],["matColumnDef","status"],["matColumnDef","paidAt"],["matColumnDef","receipt"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["matColumnDef","toggle"],["mat-header-cell","","class","toggle-header",4,"matHeaderCellDef"],["mat-cell","","class","toggle-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"is-selected","click",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSize","pageSizeOptions"],[1,"empty-state"],[1,"summary-card"],[1,"summary-header"],[1,"summary-subtitle"],["mat-icon-button","","type","button",3,"click","disabled"],[1,"summary-loading"],[1,"summary-grid"],["diameter","40","mode","indeterminate"],[1,"drawer-section"],[1,"detail-grid"],[1,"detail-item"],[1,"label"],[1,"value"],["target","_blank","rel","noopener",3,"href"],[1,"section-header"],[1,"summary-metrics"],[1,"metric-card"],[1,"metric-label"],[1,"metric-value"],["mat-flat-button","","color","primary","type","button",3,"click","disabled"],[1,"generation-content"],[1,"generation-title"],[1,"generation-stats"],["appearance","outline",1,"teacher-select"],[3,"formControl","disabled"],[3,"value"],["matSuffix","","diameter","20","mode","indeterminate"],["appearance","outline",1,"teacher-search"],["matInput","",3,"placeholder","formControl"],["mat-icon-button","","matSuffix","","type","button",3,"disabled"],["mat-stroked-button","","type","button",1,"refresh-button",3,"click","disabled"],["mat-icon-button","","matSuffix","","type","button",3,"click","disabled"],["mat-header-cell",""],["mat-cell",""],[1,"cell-primary"],[1,"status-badge"],["target","_blank","rel","noopener",3,"click","href"],["mat-header-cell","",1,"actions-header"],["mat-cell","",1,"actions-cell"],["mat-icon-button","","type","button","color","primary",1,"action-button",3,"click","mousedown","matTooltip","disabled"],[1,"spin"],["mat-header-cell","",1,"toggle-header"],["mat-cell","",1,"toggle-cell"],["color","primary",3,"click","change","checked","disabled"],["mat-header-row",""],["mat-row","",3,"click"],[1,"summary-card-item"]],template:function(n,a){if(1&n){const i=t.RV6();t.j41(0,"mat-drawer-container",2)(1,"mat-drawer",3,0),t.bIt("closedStart",function(){return m.eBV(i),m.Njj(a.onDrawerClosed())}),t.j41(3,"div",4)(4,"div",5)(5,"div")(6,"h3",6),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nVh(9,Ft,2,1,"p",7),t.k0s(),t.j41(10,"button",8),t.bIt("click",function(){return m.eBV(i),m.Njj(a.closeDetails())}),t.j41(11,"mat-icon"),t.EFF(12,"close"),t.k0s()()(),t.nrm(13,"mat-divider"),t.nVh(14,$t,2,0,"div",9)(15,jt,45,27)(16,Ot,4,3,"div",10),t.k0s()(),t.j41(17,"mat-drawer-content")(18,"div",11)(19,"div")(20,"p",12),t.EFF(21),t.nI1(22,"translate"),t.k0s()(),t.nVh(23,Gt,5,4,"button",13),t.k0s(),t.nVh(24,Vt,21,15,"mat-card",14),t.j41(25,"mat-card",15)(26,"div",16)(27,"mat-form-field",17)(28,"mat-label"),t.EFF(29),t.nI1(30,"translate"),t.k0s(),t.nrm(31,"input",18)(32,"mat-datepicker-toggle",19),t.j41(33,"mat-datepicker",20,1),t.bIt("monthSelected",function(d){m.eBV(i);const p=t.sdS(34);return m.Njj(a.setMonth(d,p))}),t.k0s()(),t.nVh(35,Jt,23,22)(36,Ht,6,3,"div",21),t.j41(37,"button",22),t.bIt("click",function(){return m.eBV(i),m.Njj(a.reloadAll())}),t.j41(38,"mat-icon"),t.EFF(39,"refresh"),t.k0s(),t.EFF(40),t.nI1(41,"translate"),t.k0s()()(),t.nVh(42,Yt,1,0,"mat-progress-bar",23),t.j41(43,"mat-card",24)(44,"div",25)(45,"table",26),t.qex(46,27),t.DNE(47,zt,3,3,"th",28)(48,Xt,3,1,"td",29),t.bVm(),t.qex(49,30),t.DNE(50,Qt,3,3,"th",28)(51,Wt,2,1,"td",29),t.bVm(),t.qex(52,31),t.DNE(53,Zt,3,3,"th",28)(54,Kt,2,1,"td",29),t.bVm(),t.qex(55,32),t.DNE(56,qt,3,3,"th",28)(57,te,5,6,"td",29),t.bVm(),t.qex(58,33),t.DNE(59,ee,3,3,"th",28)(60,re,3,1,"td",29),t.bVm(),t.qex(61,34),t.DNE(62,ie,3,3,"th",28)(63,le,3,1,"td",29),t.bVm(),t.qex(64,35),t.DNE(65,ce,3,3,"th",36)(66,ue,6,8,"td",37),t.bVm(),t.qex(67,38),t.DNE(68,he,3,3,"th",39)(69,pe,2,2,"td",40),t.bVm(),t.DNE(70,fe,1,0,"tr",41)(71,ge,1,2,"tr",42),t.k0s()(),t.nrm(72,"mat-paginator",43),t.nVh(73,ye,3,3,"div",44),t.k0s(),t.j41(74,"mat-card",45)(75,"div",46)(76,"div")(77,"h3"),t.EFF(78),t.nI1(79,"translate"),t.k0s(),t.j41(80,"p",47),t.EFF(81),t.nI1(82,"translate"),t.j41(83,"strong"),t.EFF(84),t.k0s(),t.EFF(85,". "),t.k0s()(),t.j41(86,"button",48),t.bIt("click",function(){return m.eBV(i),m.Njj(a.loadMonthlySummary())}),t.j41(87,"mat-icon"),t.EFF(88,"refresh"),t.k0s()()(),t.nVh(89,be,2,0,"div",49)(90,Se,3,0,"div",50)(91,Ce,3,3,"div",44),t.k0s()()()}if(2&n){const i=t.sdS(34);t.R7$(7),t.JRh(t.bMT(8,25,"Invoice Details")),t.R7$(2),t.vxM(null!=a.selectedInvoice&&a.selectedInvoice.teacherName||null!=a.detailSummary&&a.detailSummary.teacherName?9:-1),t.R7$(5),t.vxM(a.detailsLoading?14:a.invoiceDetails||a.selectedInvoice?15:16),t.R7$(7),t.SpI(" ",t.bMT(22,27,"Teacher Salary Subtitle")," "),t.R7$(2),t.vxM(a.canGenerateInvoices?23:-1),t.R7$(),t.vxM(a.generationResult?24:-1),t.R7$(5),t.JRh(t.bMT(30,29,"Month")),t.R7$(2),t.Y8G("matDatepicker",i)("formControl",a.selectedMonth),t.R7$(),t.Y8G("for",i),t.R7$(3),t.vxM(a.canManagePayments?35:36),t.R7$(2),t.Y8G("disabled",a.invoicesLoading||a.summaryLoading),t.R7$(3),t.SpI(" ",t.bMT(41,31,"Reload")," "),t.R7$(2),t.vxM(a.invoicesLoading?42:-1),t.R7$(3),t.Y8G("dataSource",a.dataSource),t.R7$(25),t.Y8G("matHeaderRowDef",a.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumns),t.R7$(),t.Y8G("pageSize",10)("pageSizeOptions",t.lJ4(37,It)),t.R7$(),t.vxM(a.invoicesLoading||0!==a.dataSource.data.length?-1:73),t.R7$(5),t.JRh(t.bMT(79,33,"Monthly Summary")),t.R7$(3),t.SpI(" ",t.bMT(82,35,"Monthly Summary Subtitle")," "),t.R7$(3),t.JRh(a.formatSummaryMonth()),t.R7$(2),t.Y8G("disabled",a.summaryLoading),t.R7$(3),t.vxM(a.summaryLoading?89:a.summaryMetrics.length>0?90:91)}},dependencies:[b.MD,b.vh,g.X1,g.me,g.BC,g.l_,R.vg,R.qe,R.$C,R.$l,U.m_,U.An,L.w,L.q,B.Hl,B.$z,Tt.M,z.D6,z.LG,J.Hu,J.RN,ut.M,w.j,w.M,w.g,H.fS,H.fg,F.X6,F.Vh,F.bZ,F.bU,A.ZG,Y.M,Y.g,_t.M,X.PO,X.HM,Q.h,Q.e,f.tP,f.Zl,f.tL,f.ji,f.cC,f.YV,f.iL,f.KS,f.$R,f.YZ,f.NB,W.mV,W.sG,N.Ou,N.iy,q.h,q.D9],styles:["[_nghost-%COMP%]{display:block;--teacher-salary-text-primary: rgba(0, 0, 0, .87);--teacher-salary-text-secondary: rgba(0, 0, 0, .6);--teacher-salary-text-tertiary: rgba(0, 0, 0, .54);--teacher-salary-text-muted: rgba(0, 0, 0, .7);--teacher-salary-background-soft: rgba(63, 81, 181, .08);--teacher-salary-background-strong: rgba(63, 81, 181, .12);--teacher-salary-status-bg: rgba(158, 158, 158, .15);--teacher-salary-status-text: rgba(0, 0, 0, .7);--teacher-salary-status-paid-bg: rgba(46, 125, 50, .15);--teacher-salary-status-paid-text: #2e7d32;--teacher-salary-status-unpaid-bg: rgba(229, 57, 53, .12);--teacher-salary-status-unpaid-text: #c62828}.dark[_nghost-%COMP%], .dark   [_nghost-%COMP%]{--teacher-salary-text-primary: rgba(255, 255, 255, .92);--teacher-salary-text-secondary: rgba(255, 255, 255, .75);--teacher-salary-text-tertiary: rgba(255, 255, 255, .6);--teacher-salary-text-muted: rgba(255, 255, 255, .72);--teacher-salary-background-soft: rgba(63, 81, 181, .22);--teacher-salary-background-strong: rgba(63, 81, 181, .28);--teacher-salary-status-bg: rgba(255, 255, 255, .12);--teacher-salary-status-text: rgba(255, 255, 255, .82);--teacher-salary-status-paid-bg: rgba(102, 187, 106, .24);--teacher-salary-status-paid-text: #c8e6c9;--teacher-salary-status-unpaid-bg: rgba(244, 143, 177, .24);--teacher-salary-status-unpaid-text: #ffcdd2}.teacher-salary-container[_ngcontent-%COMP%]{height:100%;min-height:600px}.teacher-salary-drawer[_ngcontent-%COMP%]{width:min(420px,100vw);max-width:420px;padding:0}.drawer-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.drawer-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:1.25rem 1.5rem}.drawer-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600}.drawer-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--teacher-salary-text-tertiary);font-size:.875rem}.drawer-loading[_ngcontent-%COMP%], .drawer-empty[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;padding:2rem}.drawer-section[_ngcontent-%COMP%]{padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.detail-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.06em;color:var(--teacher-salary-text-tertiary)}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:600;color:var(--teacher-salary-text-primary);word-break:break-word}.summary-metrics[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}.metric-card[_ngcontent-%COMP%]{padding:.75rem;border-radius:.75rem;background:var(--teacher-salary-background-soft);display:flex;flex-direction:column;gap:.25rem}.metric-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;color:var(--teacher-salary-text-tertiary)}.metric-value[_ngcontent-%COMP%]{font-weight:600;font-size:1rem;color:var(--teacher-salary-text-primary)}.page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem}.page-title[_ngcontent-%COMP%]{margin:0;font-size:1.75rem;font-weight:600}.page-subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:var(--teacher-salary-text-secondary)}.filters-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.filters-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:1rem}.teacher-select[_ngcontent-%COMP%], .teacher-search[_ngcontent-%COMP%]{min-width:220px}.teacher-context[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--teacher-salary-text-secondary);padding:.75rem 1rem;border-radius:.75rem;background-color:var(--teacher-salary-background-soft)}.refresh-button[_ngcontent-%COMP%], .reload-button[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem}.table-card[_ngcontent-%COMP%]{margin-bottom:1.5rem;overflow:hidden}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.teacher-salary-table[_ngcontent-%COMP%]{width:100%;min-width:720px}.teacher-salary-table[_ngcontent-%COMP%]   .cell-primary[_ngcontent-%COMP%]{font-weight:600;color:var(--teacher-salary-text-primary)}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .75rem;border-radius:999px;font-weight:600;font-size:.85rem;background-color:var(--teacher-salary-status-bg);color:var(--teacher-salary-status-text)}.status-badge[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1rem;line-height:1}.status-badge.status-paid[_ngcontent-%COMP%]{background-color:var(--teacher-salary-status-paid-bg);color:var(--teacher-salary-status-paid-text)}.status-badge.status-unpaid[_ngcontent-%COMP%]{background-color:var(--teacher-salary-status-unpaid-bg);color:var(--teacher-salary-status-unpaid-text)}.toggle-header[_ngcontent-%COMP%], .toggle-cell[_ngcontent-%COMP%], .actions-header[_ngcontent-%COMP%], .actions-cell[_ngcontent-%COMP%]{text-align:center}.toggle-cell[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{pointer-events:auto}.actions-cell[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.action-button[_ngcontent-%COMP%]{--button-size: 36px;width:var(--button-size);height:var(--button-size)}.action-button[_ngcontent-%COMP%]   .spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_invoice-spin .9s linear infinite}@keyframes _ngcontent-%COMP%_invoice-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.teacher-salary-table[_ngcontent-%COMP%]   tr.mat-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s ease}.teacher-salary-table[_ngcontent-%COMP%]   tr.mat-row[_ngcontent-%COMP%]:hover{background-color:var(--teacher-salary-background-soft)}.teacher-salary-table[_ngcontent-%COMP%]   tr.mat-row.is-selected[_ngcontent-%COMP%]{background-color:var(--teacher-salary-background-strong)}.empty-state[_ngcontent-%COMP%]{padding:1.5rem;text-align:center;color:var(--teacher-salary-text-secondary)}.summary-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.summary-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.summary-subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;color:var(--teacher-salary-text-secondary)}.summary-loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 0}.summary-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}.summary-card-item[_ngcontent-%COMP%]{padding:1rem;border-radius:.75rem;background:var(--teacher-salary-background-soft);display:flex;flex-direction:column;gap:.35rem}.generation-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.generation-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.generation-title[_ngcontent-%COMP%]{font-weight:600}.generation-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;color:var(--teacher-salary-text-muted)}@media (max-width: 768px){.teacher-salary-table[_ngcontent-%COMP%]{min-width:100%}.filters-grid[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.refresh-button[_ngcontent-%COMP%], .reload-button[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})}return r})();const Te=[{path:"",component:nt,data:{roles:[y.m.Admin,y.m.Manager,y.m.Teacher]}}];let _e=(()=>{class r{static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275mod=t.$C({type:r});static#a=this.\u0275inj=m.G2t({imports:[M.iI.forChild(Te),M.iI]})}return r})(),xe=(()=>{class r{static#t=this.\u0275fac=function(n){return new(n||r)};static#e=this.\u0275mod=t.$C({type:r});static#a=this.\u0275inj=m.G2t({imports:[nt,_e]})}return r})()},87509:(dt,I,l)=>{l.d(I,{f:()=>C});var M=l(48728),y=l(95416);let C=(()=>{class b{constructor(){this.snackBar=(0,M.WQX)(y.UG)}success(m,g="Close",f=3e3){this.snackBar.open(m,g,{duration:f,panelClass:["toast-success"]})}error(m,g="Close",f=3e3){this.snackBar.open(m,g,{duration:f,panelClass:["toast-error"]})}static#t=this.\u0275fac=function(g){return new(g||b)};static#e=this.\u0275prov=M.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()}}]);