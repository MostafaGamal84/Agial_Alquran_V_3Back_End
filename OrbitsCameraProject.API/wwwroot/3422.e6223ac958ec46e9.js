"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[3422],{83422:(I,f,s)=>{s.r(f),s.d(f,{ReportListComponent:()=>_t});var l=s(48728),E=s(17705),p=s(72200),m=s(38132),u=s(89417),r=s(90645),c=s(96695),h=s(56147),M=s(22487),S=s(42986),v=s(76848),L=s(87509),O=s(75366),R=s(88937),C=s(1557),b=s(21413),P=s(70152),F=s(23294),g=s(56977),t=s(73664),$=s(88834),A=s(9010),B=s(81074),x=s(33746),D=s(5404),y=s(67575),j=s(75747),U=s(72923),W=s(25079),N=s(16735),G=s(68018);const K=()=>[5,10,25,100],k=()=>["/online-course/report/add"],Y=a=>["/online-course/report/details",a],T=a=>({report:a}),V=a=>["/online-course/report/edit",a];function X(a,o){1&a&&(t.j41(0,"div",34)(1,"button",35)(2,"div",36),t.nrm(3,"i",37),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()),2&a&&(t.R7$(),t.Y8G("routerLink",t.lJ4(4,k)),t.R7$(3),t.SpI(" ",t.bMT(5,2,"Add Report")," "))}function J(a,o){if(1&a&&t.DNE(0,X,6,5,"div",33),2&a){const e=t.XpG();t.Y8G("ngIf",e.canManageReports)}}function Q(a,o){if(1&a){const e=t.RV6();t.j41(0,"button",38),t.nI1(1,"translate"),t.bIt("click",function(){l.eBV(e);const i=t.XpG();return l.Njj(i.clearSearch())}),t.j41(2,"mat-icon"),t.EFF(3,"close"),t.k0s()()}2&a&&t.BMQ("aria-label",t.bMT(1,1,"Clear Search"))}function z(a,o){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function H(a,o){if(1&a&&(t.j41(0,"mat-option",13),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function Z(a,o){1&a&&t.nrm(0,"mat-progress-bar",39)}function w(a,o){1&a&&(t.j41(0,"th",40),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&a&&(t.R7$(),t.JRh(t.bMT(2,1,"Student")))}function q(a,o){if(1&a&&(t.j41(0,"td",41),t.EFF(1),t.k0s()),2&a){const e=o.$implicit,n=t.XpG();t.R7$(),t.SpI(" ",n.getStudentDisplay(e)," ")}}function tt(a,o){1&a&&(t.j41(0,"th",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&a&&(t.R7$(),t.JRh(t.bMT(2,1,"Circle")))}function et(a,o){if(1&a&&(t.j41(0,"td",43),t.EFF(1),t.k0s()),2&a){const e=o.$implicit,n=t.XpG();t.R7$(),t.SpI(" ",n.getCircleDisplay(e)," ")}}function at(a,o){1&a&&(t.j41(0,"th",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&a&&(t.R7$(),t.JRh(t.bMT(2,1,"Status")))}function nt(a,o){if(1&a&&(t.j41(0,"td",43),t.EFF(1),t.k0s()),2&a){const e=o.$implicit,n=t.XpG();t.R7$(),t.SpI(" ",n.getStatusLabel(e.attendStatueId)," ")}}function st(a,o){1&a&&(t.j41(0,"th",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&a&&(t.R7$(),t.JRh(t.bMT(2,1,"Date")))}function it(a,o){if(1&a&&(t.j41(0,"td",43),t.EFF(1),t.k0s()),2&a){const e=o.$implicit,n=t.XpG();t.R7$(),t.SpI(" ",n.formatDate(e.creationTime)," ")}}function ot(a,o){1&a&&(t.j41(0,"th",44),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&a&&(t.R7$(),t.JRh(t.bMT(2,1,"Actions")))}function rt(a,o){if(1&a&&(t.j41(0,"li",47),t.nI1(1,"translate"),t.j41(2,"a",48),t.nrm(3,"i",51),t.k0s()()),2&a){const e=t.XpG().$implicit;t.Y8G("matTooltip",t.bMT(1,3,"Edit")),t.R7$(2),t.Y8G("routerLink",t.eq3(5,V,e.id))("state",t.eq3(7,T,e))}}function lt(a,o){if(1&a&&(t.j41(0,"td",43)(1,"div",45)(2,"ul",46)(3,"li",47),t.nI1(4,"translate"),t.j41(5,"a",48),t.nrm(6,"i",49),t.k0s()(),t.DNE(7,rt,4,9,"li",50),t.k0s()()()),2&a){const e=o.$implicit,n=t.XpG();t.R7$(3),t.Y8G("matTooltip",t.bMT(4,4,"View")),t.R7$(2),t.Y8G("routerLink",t.eq3(6,Y,e.id))("state",t.eq3(8,T,e)),t.R7$(2),t.Y8G("ngIf",n.canManageReports)}}function ct(a,o){1&a&&t.nrm(0,"tr",52)}function mt(a,o){1&a&&t.nrm(0,"tr",53)}function dt(a,o){1&a&&(t.j41(0,"tr",54)(1,"td",55),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&a&&(t.R7$(2),t.JRh(t.bMT(3,1,"No Reports Found")))}let _t=(()=>{class a{constructor(){this.reportService=(0,l.WQX)(M.o),this.circleService=(0,l.WQX)(S.K),this.lookupService=(0,l.WQX)(v.s),this.fb=(0,l.WQX)(u.ok),this.toast=(0,l.WQX)(L.f),this.auth=(0,l.WQX)(O.k),this.paginator=E.ebz.required(c.iy),this.filterForm=this.fb.group({searchTerm:[""],circleId:[null],studentId:[null]}),this.displayedColumns=["student","circle","status","creationTime","actions"],this.dataSource=new r.I6,this.totalCount=0,this.filter={skipCount:0,maxResultCount:10},this.circles=[],this.students=[],this.allStudents=[],this.isLoading=!1,this.isLoadingStudents=!1,this.destroy$=new b.B,this.role=this.auth.getRole(),this.canManageReports=this.role!==R.m.Student;const e=this.auth.currentUserValue;if(this.role===R.m.Teacher&&e?.user?.id){const n=Number(e.user.id);this.teacherId=Number.isNaN(n)?void 0:n}}ngOnInit(){this.loadCircles(),this.loadAllStudents(),this.loadReports(),this.filterForm.get("searchTerm")?.valueChanges.pipe((0,P.B)(300),(0,F.F)(),(0,g.Q)(this.destroy$)).subscribe(()=>this.onSearch()),this.filterForm.get("circleId")?.valueChanges.pipe((0,g.Q)(this.destroy$)).subscribe(e=>this.onCircleChange(e)),this.filterForm.get("studentId")?.valueChanges.pipe((0,g.Q)(this.destroy$)).subscribe(()=>this.applyFilters())}ngAfterViewInit(){this.paginator().page.subscribe(()=>{this.filter.skipCount=this.paginator().pageIndex*this.paginator().pageSize,this.filter.maxResultCount=this.paginator().pageSize,this.loadReports()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadCircles(){this.circleService.getAll({skipCount:0,maxResultCount:100}).subscribe(e=>{this.circles=e.isSuccess&&e.data?.items?e.data.items:[]})}loadAllStudents(e){this.isLoadingStudents=!0,this.lookupService.getUsersForSelects({skipCount:0,maxResultCount:100,searchTerm:e?.trim()||void 0},Number(R.m.Student)).subscribe({next:n=>{if(n.isSuccess&&n.data?.items){const i=n.data.items.map(d=>this.mapLookupToStudentOption(d));this.allStudents=i,this.selectedCircleId||(this.students=[...i])}else this.allStudents=[],this.selectedCircleId||(this.students=[]);this.isLoadingStudents=!1},error:()=>{this.allStudents=[],this.selectedCircleId||(this.students=[]),this.isLoadingStudents=!1}})}mapLookupToStudentOption(e){return{id:e.id,name:e.fullName||e.email||`Student #${e.id}`}}onCircleChange(e){this.selectedCircleId=e??void 0,this.filterForm.patchValue({studentId:null},{emitEvent:!1}),e?(this.isLoadingStudents=!0,this.circleService.get(e).subscribe({next:n=>{if(n.isSuccess&&n.data?.students){const i=n.data.students.map(_=>this.mapCircleStudentToOption(_)).filter(_=>!!_),d=new Map(i.map(_=>[_.id,_]));this.students=Array.from(d.values())}else this.students=[];this.isLoadingStudents=!1,this.applyFilters()},error:()=>{this.students=[],this.isLoadingStudents=!1,this.applyFilters()}})):(this.students=[...this.allStudents],this.applyFilters())}mapCircleStudentToOption(e){const n=e.student,i=n?.id??e.studentId??e.id;if(null==i)return;const d=n?.fullName||e.fullName||("number"==typeof i?`Student #${i}`:`Student #${Number(i)}`);return{id:Number(i),name:d}}applyFilters(){const{circleId:e,studentId:n}=this.filterForm.value;this.selectedCircleId=e??void 0,this.selectedStudentId=n??void 0,this.filter.skipCount=0,this.paginator()?.firstPage(),this.loadReports()}onSearch(){const e=(this.filterForm.value.searchTerm||"").toString().trim();this.filter.searchTerm=e.length?e:void 0,this.filter.skipCount=0,this.paginator()?.firstPage(),this.loadReports()}clearSearch(){this.filterForm.patchValue({searchTerm:""},{emitEvent:!1}),this.onSearch()}loadReports(){this.isLoading=!0,this.reportService.getAll(this.filter,{circleId:this.selectedCircleId,studentId:this.selectedStudentId,teacherId:this.teacherId}).subscribe({next:e=>{e.isSuccess&&e.data?.items?(this.dataSource.data=e.data.items,this.totalCount=e.data.totalCount):(this.dataSource.data=[],this.totalCount=0),this.isLoading=!1},error:()=>{this.dataSource.data=[],this.totalCount=0,this.isLoading=!1,this.toast.error("Error loading reports")}})}getStudentDisplay(e){return e.studentName||e.student||e.studentFullName||("number"==typeof e.studentId?`Student #${e.studentId}`:"")}getCircleDisplay(e){return e.circleName||e.circle||e.circleTitle||("number"==typeof e.circleId?`Circle #${e.circleId}`:"")}getStatusLabel(e){switch(e){case C.E.Attended:return"Attended";case C.E.ExcusedAbsence:return"Excused absence";case C.E.UnexcusedAbsence:return"Unexcused absence";default:return"\u2014"}}formatDate(e){if(!e)return"\u2014";const n=e instanceof Date?e:new Date(e);return Number.isNaN(n.getTime())?"\u2014":n.toLocaleString()}static#t=this.\u0275fac=function(n){return new(n||a)};static#e=this.\u0275cmp=t.VBU({type:a,selectors:[["app-report-list"]],viewQuery:function(n,i){1&n&&t.wEZ(i.paginator,c.iy,5),2&n&&t.NyB()},decls:61,vars:40,consts:[["headerOptionsTemplate",""],[1,"row","p-t-25"],[1,"col-12"],["padding","0","cardClass","sm-block",3,"cardTitle"],[1,"p-b-15"],[1,"table-containe","table-reponsive"],[1,"filter-form",3,"ngSubmit","formGroup"],[1,"row","g-3","p-15"],[1,"col-12","col-md-4"],["appearance","outline",1,"w-100"],["matInput","","formControlName","searchTerm",3,"keyup.enter","placeholder"],["mat-icon-button","","matSuffix","","type","button",3,"click",4,"ngIf"],["formControlName","circleId",3,"disabled"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","studentId",3,"disabled"],["mode","indeterminate",4,"ngIf"],[1,"table-responsive"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","student"],["mat-header-cell","","class","p-l-25",4,"matHeaderCellDef"],["mat-cell","","class","p-l-25 text-nowrap",4,"matCellDef"],["matColumnDef","circle"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","creationTime"],["matColumnDef","actions"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"length","pageSize","pageSizeOptions"],["class","table-options",4,"ngIf"],[1,"table-options"],["mat-flat-button","","color","primary",3,"routerLink"],[1,"flex","align-item-center"],[1,"ti","ti-plus","f-18","m-r-5"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["mode","indeterminate"],["mat-header-cell","",1,"p-l-25"],["mat-cell","",1,"p-l-25","text-nowrap"],["mat-header-cell",""],["mat-cell","",1,"text-nowrap"],["mat-header-cell","",1,"text-center"],[1,"text-center","text-nowrap"],[1,"list-inline","p-l-0"],[1,"list-inline-item","m-r-10",3,"matTooltip"],[1,"avatar","avatar-xs","text-muted",3,"routerLink","state"],[1,"ti","ti-eye","f-18"],["class","list-inline-item m-r-10",3,"matTooltip",4,"ngIf"],[1,"ti","ti-edit-circle","f-18"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(n,i){if(1&n){const d=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"app-card",3),t.nI1(3,"translate"),t.DNE(4,J,1,1,"ng-template",null,0,t.C5r),t.j41(6,"div",4)(7,"div",5)(8,"form",6),t.bIt("ngSubmit",function(){return l.eBV(d),l.Njj(i.onSearch())}),t.j41(9,"div",7)(10,"div",8)(11,"mat-form-field",9)(12,"mat-label"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"input",10),t.nI1(16,"translate"),t.bIt("keyup.enter",function(){return l.eBV(d),l.Njj(i.onSearch())}),t.k0s(),t.DNE(17,Q,4,3,"button",11),t.k0s()(),t.j41(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.j41(23,"mat-select",12)(24,"mat-option",13),t.EFF(25),t.nI1(26,"translate"),t.k0s(),t.DNE(27,z,2,2,"mat-option",14),t.k0s()()(),t.j41(28,"div",8)(29,"mat-form-field",9)(30,"mat-label"),t.EFF(31),t.nI1(32,"translate"),t.k0s(),t.j41(33,"mat-select",15)(34,"mat-option",13),t.EFF(35),t.nI1(36,"translate"),t.k0s(),t.DNE(37,H,2,2,"mat-option",14),t.k0s()()()()(),t.DNE(38,Z,1,0,"mat-progress-bar",16),t.j41(39,"div",17)(40,"table",18),t.qex(41,19),t.DNE(42,w,3,3,"th",20)(43,q,2,1,"td",21),t.bVm(),t.qex(44,22),t.DNE(45,tt,3,3,"th",23)(46,et,2,1,"td",24),t.bVm(),t.qex(47,25),t.DNE(48,at,3,3,"th",23)(49,nt,2,1,"td",24),t.bVm(),t.qex(50,26),t.DNE(51,st,3,3,"th",23)(52,it,2,1,"td",24),t.bVm(),t.qex(53,27),t.DNE(54,ot,3,3,"th",28)(55,lt,8,10,"td",24),t.bVm(),t.DNE(56,ct,1,0,"tr",29)(57,mt,1,0,"tr",30)(58,dt,4,3,"tr",31),t.k0s(),t.nrm(59,"mat-paginator",32),t.nI1(60,"translate"),t.k0s()()()()()()}2&n&&(t.R7$(2),t.Y8G("cardTitle",t.bMT(3,23,"Circle Reports")),t.R7$(6),t.Y8G("formGroup",i.filterForm),t.R7$(5),t.JRh(t.bMT(14,25,"Search")),t.R7$(2),t.Y8G("placeholder",t.bMT(16,27,"Search Reports")),t.R7$(2),t.Y8G("ngIf",i.filterForm.value.searchTerm),t.R7$(4),t.JRh(t.bMT(22,29,"Circle")),t.R7$(2),t.Y8G("disabled",i.isLoadingStudents),t.R7$(),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(26,31,"All Circles")),t.R7$(2),t.Y8G("ngForOf",i.circles),t.R7$(4),t.JRh(t.bMT(32,33,"Student")),t.R7$(2),t.Y8G("disabled",i.isLoadingStudents),t.R7$(),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(36,35,"All Students")),t.R7$(2),t.Y8G("ngForOf",i.students),t.R7$(),t.Y8G("ngIf",i.isLoading),t.R7$(2),t.Y8G("dataSource",i.dataSource),t.R7$(16),t.Y8G("matHeaderRowDef",i.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",i.displayedColumns),t.R7$(2),t.Y8G("length",i.totalCount)("pageSize",i.filter.maxResultCount||10)("pageSizeOptions",t.lJ4(39,K)),t.BMQ("aria-label",t.bMT(60,37,"Select page of reports")))},dependencies:[p.MD,p.Sq,p.bT,h.G,$.$z,A.M,B.An,x.fg,D.j,D.M,D.g,c.iy,y.HM,j.e,U.g,W.M,r.Zl,r.tL,r.ji,r.cC,r.YV,r.iL,r.KS,r.$R,r.YZ,r.NB,r.ky,u.qT,u.me,u.BC,u.cb,u.j4,u.JD,N.i,G.D9,m.iI,m.Wk],styles:[".filter-form[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.08)}.filter-form[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{margin:0}.table-responsive[_ngcontent-%COMP%]{position:relative}.mat-progress-bar[_ngcontent-%COMP%]{margin:0 15px}"]})}return a})()},87509:(I,f,s)=>{s.d(f,{f:()=>p});var l=s(48728),E=s(95416);let p=(()=>{class m{constructor(){this.snackBar=(0,l.WQX)(E.UG)}success(r,c="Close",h=3e3){this.snackBar.open(r,c,{duration:h,panelClass:["toast-success"]})}error(r,c="Close",h=3e3){this.snackBar.open(r,c,{duration:h,panelClass:["toast-error"]})}static#t=this.\u0275fac=function(c){return new(c||m)};static#e=this.\u0275prov=l.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()}}]);