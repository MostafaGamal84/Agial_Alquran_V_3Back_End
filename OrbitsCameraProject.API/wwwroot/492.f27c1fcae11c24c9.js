"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[492],{50492:(j,F,l)=>{l.r(F),l.d(F,{ReportAddComponent:()=>V});var f=l(48728),m=l(72200),a=l(89417),c=l(35568),k=l(56147),p=l(22487),n=l(42986),g=l(87509),C=l(75366),I=l(88937),r=l(1557),b=function(t){return t[t.Alfatiha=1]="Alfatiha",t[t.Albaqara=2]="Albaqara",t[t.Aalimran=3]="Aalimran",t[t.Annisaa=4]="Annisaa",t[t.Almaida=5]="Almaida",t[t.Alanam=6]="Alanam",t[t.Alaraf=7]="Alaraf",t[t.Alanfal=8]="Alanfal",t[t.Altawba=9]="Altawba",t[t.Yunus=10]="Yunus",t[t.Hud=11]="Hud",t[t.Yusuf=12]="Yusuf",t[t.Arrad=13]="Arrad",t[t.Ibrahim=14]="Ibrahim",t[t.Alhijr=15]="Alhijr",t[t.Annahl=16]="Annahl",t[t.Alisraa=17]="Alisraa",t[t.Alkahf=18]="Alkahf",t[t.Maryam=19]="Maryam",t[t.Taha=20]="Taha",t[t.Alanbiya=21]="Alanbiya",t[t.Alhajj=22]="Alhajj",t[t.Almuminun=23]="Almuminun",t[t.Annur=24]="Annur",t[t.Alfurqan=25]="Alfurqan",t[t.Ashshuara=26]="Ashshuara",t[t.Annaml=27]="Annaml",t[t.Alqasas=28]="Alqasas",t[t.Alankabut=29]="Alankabut",t[t.Arrum=30]="Arrum",t[t.Luqman=31]="Luqman",t[t.Assajdah=32]="Assajdah",t[t.Alahzab=33]="Alahzab",t[t.Saba=34]="Saba",t[t.Fatir=35]="Fatir",t[t.Yasin=36]="Yasin",t[t.Assaffat=37]="Assaffat",t[t.Sad=38]="Sad",t[t.Azzumar=39]="Azzumar",t[t.Ghafir=40]="Ghafir",t[t.Fussilat=41]="Fussilat",t[t.Ashshura=42]="Ashshura",t[t.Azzukhruf=43]="Azzukhruf",t[t.Addukhan=44]="Addukhan",t[t.Aljathiya=45]="Aljathiya",t[t.Alahqaf=46]="Alahqaf",t[t.Muhammad=47]="Muhammad",t[t.Alfath=48]="Alfath",t[t.Alhujurat=49]="Alhujurat",t[t.Qaf=50]="Qaf",t[t.Azzariyat=51]="Azzariyat",t[t.Attur=52]="Attur",t[t.Annajm=53]="Annajm",t[t.Alqamar=54]="Alqamar",t[t.Arrahman=55]="Arrahman",t[t.Alwaqia=56]="Alwaqia",t[t.Alhadid=57]="Alhadid",t[t.Almujadilah=58]="Almujadilah",t[t.Alhashr=59]="Alhashr",t[t.Almumtahinah=60]="Almumtahinah",t[t.Assaff=61]="Assaff",t[t.Aljumuah=62]="Aljumuah",t[t.Almunafiqun=63]="Almunafiqun",t[t.Attaghabun=64]="Attaghabun",t[t.Attalaq=65]="Attalaq",t[t.Attahrim=66]="Attahrim",t[t.Almulk=67]="Almulk",t[t.Alqalam=68]="Alqalam",t[t.Alhaqqah=69]="Alhaqqah",t[t.Almaarij=70]="Almaarij",t[t.Nuh=71]="Nuh",t[t.Aljinn=72]="Aljinn",t[t.Almuzzammil=73]="Almuzzammil",t[t.Almuddaththir=74]="Almuddaththir",t[t.Alqiyamah=75]="Alqiyamah",t[t.Alinsan=76]="Alinsan",t[t.Almursalat=77]="Almursalat",t[t.Annaba=78]="Annaba",t[t.Annaziat=79]="Annaziat",t[t.Abasa=80]="Abasa",t[t.Attakwir=81]="Attakwir",t[t.Alinfitar=82]="Alinfitar",t[t.Almutaffifin=83]="Almutaffifin",t[t.Alinshiqaq=84]="Alinshiqaq",t[t.Alburuj=85]="Alburuj",t[t.Attariq=86]="Attariq",t[t.Alala=87]="Alala",t[t.Alghashiyah=88]="Alghashiyah",t[t.Alfajr=89]="Alfajr",t[t.Albalad=90]="Albalad",t[t.Ashshams=91]="Ashshams",t[t.Allail=92]="Allail",t[t.Adduha=93]="Adduha",t[t.Ashsharh=94]="Ashsharh",t[t.Attin=95]="Attin",t[t.Alalaq=96]="Alalaq",t[t.Alqadr=97]="Alqadr",t[t.Albayinah=98]="Albayinah",t[t.Azzalzalah=99]="Azzalzalah",t[t.Aladiyat=100]="Aladiyat",t[t.Alqariah=101]="Alqariah",t[t.Altakathur=102]="Altakathur",t[t.Alasr=103]="Alasr",t[t.Alhumazah=104]="Alhumazah",t[t.Alfil=105]="Alfil",t[t.Quraish=106]="Quraish",t[t.Almaun=107]="Almaun",t[t.Alkauthar=108]="Alkauthar",t[t.Alkafirun=109]="Alkafirun",t[t.Annasr=110]="Annasr",t[t.Almasad=111]="Almasad",t[t.Alikhlas=112]="Alikhlas",t[t.Alfalaq=113]="Alfalaq",t[t.Annas=114]="Annas",t}(b||{}),e=l(73664),N=l(88834),y=l(33746),R=l(5404),P=l(72923),D=l(25079),T=l(16735);function z(t,h){1&t&&(e.j41(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),e.EFF(3,"Minutes"),e.k0s(),e.nrm(4,"input",11),e.k0s()())}function q(t,h){if(1&t&&(e.j41(0,"mat-option",7),e.EFF(1),e.k0s()),2&t){const s=h.$implicit;e.Y8G("value",s.id),e.R7$(),e.SpI(" ",s.name," ")}}function w(t,h){if(1&t&&(e.qex(0),e.j41(1,"div",4)(2,"mat-form-field",5)(3,"mat-label"),e.EFF(4,"New Surah"),e.k0s(),e.j41(5,"mat-select",12),e.DNE(6,q,2,2,"mat-option",13),e.k0s()()(),e.j41(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),e.EFF(10,"New From"),e.k0s(),e.nrm(11,"input",14),e.k0s()(),e.j41(12,"div",4)(13,"mat-form-field",5)(14,"mat-label"),e.EFF(15,"New To"),e.k0s(),e.nrm(16,"input",15),e.k0s()(),e.j41(17,"div",4)(18,"mat-form-field",5)(19,"mat-label"),e.EFF(20,"New Rate"),e.k0s(),e.nrm(21,"input",16),e.k0s()(),e.j41(22,"div",4)(23,"mat-form-field",5)(24,"mat-label"),e.EFF(25,"Recent Past"),e.k0s(),e.nrm(26,"input",17),e.k0s()(),e.j41(27,"div",4)(28,"mat-form-field",5)(29,"mat-label"),e.EFF(30,"Recent Past Rate"),e.k0s(),e.nrm(31,"input",18),e.k0s()(),e.j41(32,"div",4)(33,"mat-form-field",5)(34,"mat-label"),e.EFF(35,"Distant Past"),e.k0s(),e.nrm(36,"input",19),e.k0s()(),e.j41(37,"div",4)(38,"mat-form-field",5)(39,"mat-label"),e.EFF(40,"Distant Past Rate"),e.k0s(),e.nrm(41,"input",20),e.k0s()(),e.j41(42,"div",4)(43,"mat-form-field",5)(44,"mat-label"),e.EFF(45,"Farthest Past"),e.k0s(),e.nrm(46,"input",21),e.k0s()(),e.j41(47,"div",4)(48,"mat-form-field",5)(49,"mat-label"),e.EFF(50,"Farthest Past Rate"),e.k0s(),e.nrm(51,"input",22),e.k0s()(),e.j41(52,"div",4)(53,"mat-form-field",5)(54,"mat-label"),e.EFF(55,"The Words Quran Stranger"),e.k0s(),e.nrm(56,"input",23),e.k0s()(),e.j41(57,"div",4)(58,"mat-form-field",5)(59,"mat-label"),e.EFF(60,"Intonation"),e.k0s(),e.nrm(61,"input",24),e.k0s()(),e.j41(62,"div",25)(63,"mat-form-field",5)(64,"mat-label"),e.EFF(65,"Other"),e.k0s(),e.nrm(66,"textarea",26),e.k0s()(),e.bVm()),2&t){const s=e.XpG();e.R7$(6),e.Y8G("ngForOf",s.surahList)}}let V=(()=>{class t{constructor(){this.fb=(0,f.WQX)(a.ok),this.service=(0,f.WQX)(p.o),this.circleService=(0,f.WQX)(n.K),this.toast=(0,f.WQX)(g.f),this.auth=(0,f.WQX)(C.k),this.route=(0,f.WQX)(c.nX),this.role=this.auth.getRole(),this.UserTypesEnum=I.m,this.AttendStatusEnum=r.E,this.mode="add",this.cardTitle="Add Circle Report",this.submitLabel="Create",this.surahList=Object.keys(b).filter(s=>isNaN(Number(s))).map(s=>({id:b[s],name:s}))}ngOnInit(){if(this.mode=this.determineMode(),"update"===this.mode&&(this.cardTitle="Update Circle Report",this.submitLabel="Update"),this.reportForm=this.fb.group({minutes:[],newId:[],newFrom:[""],newTo:[""],newRate:[""],recentPast:[""],recentPastRate:[""],distantPast:[""],distantPastRate:[""],farthestPast:[""],farthestPastRate:[""],theWordsQuranStranger:[""],intonation:[""],other:[""],creationTime:[new Date,a.k0.required],circleId:[],studentId:[null,a.k0.required],teacherId:[null],attendStatueId:[]}),this.toggleFields(),"add"===this.mode){const s=history.state.circle;if(s)this.reportForm.patchValue({teacherId:s.teacherId??s.teacher?.id,circleId:s.id});else if(this.role===I.m.Teacher){const o=this.auth.currentUserValue,A=o?Number(o.user.id):0;this.reportForm.get("teacherId")?.setValue(A),this.loadCircle(A)}const i=Number(this.route.snapshot.paramMap.get("id"));i&&this.reportForm.get("studentId")?.setValue(i)}else{const s=Number(this.route.snapshot.paramMap.get("id"));if(s){this.reportId=s;const i=this.getReportFromState(s);i?this.populateFormFromReport(i,s):this.toast.error("Report details are unavailable. Please return to the list and select a report to edit.")}else this.toast.error("Invalid report identifier")}}allFields(){return["minutes","newId","newFrom","newTo","newRate","recentPast","recentPastRate","distantPast","distantPastRate","farthestPast","farthestPastRate","theWordsQuranStranger","intonation","other"]}toggleFields(){this.allFields().forEach(i=>{this.reportForm.get(i)?.disable(),this.reportForm.get(i)?.clearValidators(),this.reportForm.get(i)?.updateValueAndValidity()})}onStatusChange(s){this.selectedStatus=s;const i=this.allFields();i.forEach(o=>{this.reportForm.get(o)?.disable(),this.reportForm.get(o)?.clearValidators(),this.reportForm.get(o)?.updateValueAndValidity()}),s===r.E.Attended?i.forEach(o=>this.reportForm.get(o)?.enable()):s===r.E.UnexcusedAbsence&&(this.reportForm.get("minutes")?.enable(),this.reportForm.get("minutes")?.setValidators([a.k0.required]),this.reportForm.get("minutes")?.updateValueAndValidity())}loadCircle(s){this.circleService.getAll({skipCount:0,maxResultCount:1},void 0,s).subscribe(i=>{i.isSuccess&&i.data.items.length&&this.reportForm.get("circleId")?.setValue(i.data.items[0].id)})}getReportFromState(s){const i=history.state?.report??void 0;if(!i)return;const o=this.toNumber(i.id??i.id);return o&&o===s?{...i,id:o}:void 0}populateFormFromReport(s,i){this.reportId=this.toNumber(s.id)??i;const o=this.resolveStatus(s);void 0!==o?(this.onStatusChange(o),this.reportForm.get("attendStatueId")?.setValue(o,{emitEvent:!1})):(this.selectedStatus=void 0,this.reportForm.get("attendStatueId")?.setValue(null,{emitEvent:!1}),this.toggleFields());const d={creationTime:this.resolveDate(s.creationTime)};this.assignIfDefined(d,"minutes",this.toNumber(s.minutes)),this.assignIfDefined(d,"newId",this.toNumber(s.newId)),this.assignIfDefined(d,"newFrom",this.toString(s.newFrom)),this.assignIfDefined(d,"newTo",this.toString(s.newTo)),this.assignIfDefined(d,"newRate",this.toString(s.newRate)),this.assignIfDefined(d,"recentPast",this.toString(s.recentPast)),this.assignIfDefined(d,"recentPastRate",this.toString(s.recentPastRate)),this.assignIfDefined(d,"distantPast",this.toString(s.distantPast)),this.assignIfDefined(d,"distantPastRate",this.toString(s.distantPastRate)),this.assignIfDefined(d,"farthestPast",this.toString(s.farthestPast)),this.assignIfDefined(d,"farthestPastRate",this.toString(s.farthestPastRate)),this.assignIfDefined(d,"theWordsQuranStranger",this.toString(s.theWordsQuranStranger)),this.assignIfDefined(d,"intonation",this.toString(s.intonation)),this.assignIfDefined(d,"other",this.toString(s.other)),this.assignIfDefined(d,"circleId",this.extractEntityId(s,"circle")),this.assignIfDefined(d,"studentId",this.extractEntityId(s,"student")),this.assignIfDefined(d,"teacherId",this.extractEntityId(s,"teacher")),this.reportForm.patchValue(d)}resolveStatus(s){const i=this.toNumber(s.attendStatueId??s.attendStatusId);if(void 0!==i)switch(i){case r.E.Attended:case r.E.ExcusedAbsence:case r.E.UnexcusedAbsence:return i;default:return}}resolveDate(s){if(s instanceof Date&&!Number.isNaN(s.getTime()))return s;if("string"==typeof s||"number"==typeof s){const i=new Date(s);if(!Number.isNaN(i.getTime()))return i}return new Date}toNumber(s){if(null==s||""===s)return;if("number"==typeof s)return Number.isFinite(s)?s:void 0;const i=Number(s);return Number.isFinite(i)?i:void 0}toString(s){if(null!=s&&""!==s)return String(s)}extractEntityId(s,i){const o=s,A=this.toNumber(o[`${i}Id`]);if(void 0!==A)return A;const d=o[i];if(d&&"object"==typeof d){const v=this.toNumber(d.id);if(void 0!==v)return v}}assignIfDefined(s,i,o){void 0!==o&&(s[i]=o)}determineMode(){const s=this.route.snapshot.data.mode;if(s)return s;const i=this.route.snapshot.routeConfig?.path??"";return i.includes("update")||i.includes("edit")?"update":"add"}onSubmit(){if(this.reportForm.invalid)return void this.reportForm.markAllAsTouched();const s="update"===this.mode?this.reportForm.getRawValue():this.reportForm.value;if("update"===this.mode){if(!this.reportId)return void this.toast.error("Missing report identifier");s.id=this.reportId,this.service.update(s).subscribe({next:i=>{i.isSuccess?this.toast.success("Report updated successfully"):i.errors?.length?i.errors.forEach(o=>this.toast.error(o.message)):this.toast.error("Unable to update report")},error:()=>this.toast.error("Error updating report")})}else this.service.create(s).subscribe({next:i=>{i.isSuccess?(this.toast.success("Report created successfully"),this.reportForm.reset(),this.reportForm.get("creationTime")?.setValue(new Date),this.toggleFields(),this.selectedStatus=void 0):i.errors?.length?i.errors.forEach(o=>this.toast.error(o.message)):this.toast.error("Unable to create report")},error:()=>this.toast.error("Error creating report")})}static#t=this.\u0275fac=function(i){return new(i||t)};static#e=this.\u0275cmp=e.VBU({type:t,selectors:[["app-report-add"]],decls:20,vars:8,consts:[[1,"row"],[1,"col-12"],[3,"cardTitle"],[1,"row",3,"ngSubmit","formGroup"],[1,"col-md-6"],["appearance","outline",1,"w-100"],["formControlName","attendStatueId",3,"selectionChange"],[3,"value"],["class","col-md-6",4,"ngIf"],[4,"ngIf"],["mat-flat-button","","color","primary","type","submit"],["matInput","","type","number","formControlName","minutes"],["formControlName","newId"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","newFrom"],["matInput","","formControlName","newTo"],["matInput","","formControlName","newRate"],["matInput","","formControlName","recentPast"],["matInput","","formControlName","recentPastRate"],["matInput","","formControlName","distantPast"],["matInput","","formControlName","distantPastRate"],["matInput","","formControlName","farthestPast"],["matInput","","formControlName","farthestPastRate"],["matInput","","formControlName","theWordsQuranStranger"],["matInput","","formControlName","intonation"],[1,"col-md-12"],["matInput","","formControlName","other"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"app-card",2)(3,"form",3),e.bIt("ngSubmit",function(){return o.onSubmit()}),e.j41(4,"div",4)(5,"mat-form-field",5)(6,"mat-label"),e.EFF(7,"Attend Status"),e.k0s(),e.j41(8,"mat-select",6),e.bIt("selectionChange",function(d){return o.onStatusChange(d.value)}),e.j41(9,"mat-option",7),e.EFF(10,"\u062d\u0636\u0631"),e.k0s(),e.j41(11,"mat-option",7),e.EFF(12,"\u062a\u063a\u064a\u0628 \u0628\u0639\u0630\u0631"),e.k0s(),e.j41(13,"mat-option",7),e.EFF(14,"\u062a\u063a\u064a\u0628 \u0628\u062f\u0648\u0646 \u0639\u0630\u0631"),e.k0s()()()(),e.DNE(15,z,5,0,"div",8)(16,w,67,1,"ng-container",9),e.j41(17,"div",1)(18,"button",10),e.EFF(19),e.k0s()()()()()()),2&i&&(e.R7$(2),e.Y8G("cardTitle",o.cardTitle),e.R7$(),e.Y8G("formGroup",o.reportForm),e.R7$(6),e.Y8G("value",o.AttendStatusEnum.Attended),e.R7$(2),e.Y8G("value",o.AttendStatusEnum.ExcusedAbsence),e.R7$(2),e.Y8G("value",o.AttendStatusEnum.UnexcusedAbsence),e.R7$(2),e.Y8G("ngIf",o.selectedStatus===o.AttendStatusEnum.Attended||o.selectedStatus===o.AttendStatusEnum.UnexcusedAbsence),e.R7$(),e.Y8G("ngIf",o.selectedStatus===o.AttendStatusEnum.Attended),e.R7$(3),e.JRh(o.submitLabel))},dependencies:[m.MD,m.Sq,m.bT,k.G,N.$z,y.fg,R.j,R.M,P.g,D.M,a.qT,a.me,a.Q0,a.BC,a.cb,a.j4,a.JD,T.i],encapsulation:2})}return t})()},87509:(j,F,l)=>{l.d(F,{f:()=>a});var f=l(48728),m=l(95416);let a=(()=>{class c{constructor(){this.snackBar=(0,f.WQX)(m.UG)}success(p,n="Close",g=3e3){this.snackBar.open(p,n,{duration:g,panelClass:["toast-success"]})}error(p,n="Close",g=3e3){this.snackBar.open(p,n,{duration:g,panelClass:["toast-error"]})}static#t=this.\u0275fac=function(n){return new(n||c)};static#e=this.\u0275prov=f.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()}}]);