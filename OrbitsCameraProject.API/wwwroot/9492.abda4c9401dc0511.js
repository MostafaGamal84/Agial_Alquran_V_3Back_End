"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[9492],{79492:(F,I,n)=>{n.r(I),n.d(I,{CoursesUpdateComponent:()=>Y});var u=n(48728),E=n(72200),m=n(89417),f=n(35568),O=n(56147),g=n(76848),y=n(42986),D=n(87509),v=n(88937),R=n(75366),A=n(85972),T=n(11227),t=n(73664),P=n(88834),U=n(9010),k=n(81074),B=n(33746),M=n(5404),S=n(72923),W=n(25079),j=n(16735);function G(o,_){if(1&o&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&o){const e=_.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.fullName)}}function N(o,_){if(1&o&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&o){const e=_.$implicit;t.Y8G("value",e.value),t.R7$(),t.JRh(e.label)}}function V(o,_){if(1&o){const e=t.RV6();t.j41(0,"button",22),t.bIt("click",function(){u.eBV(e);const a=t.XpG().index,i=t.XpG();return u.Njj(i.removeDay(a))}),t.j41(1,"mat-icon"),t.EFF(2,"delete"),t.k0s()()}}function K(o,_){if(1&o){const e=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){u.eBV(e);const a=t.XpG(2);return u.Njj(a.addDay())}),t.j41(1,"mat-icon"),t.EFF(2,"add"),t.k0s()()}}function L(o,_){if(1&o&&(t.qex(0),t.j41(1,"div",15)(2,"div",16)(3,"mat-form-field",5)(4,"mat-label"),t.EFF(5,"Day"),t.k0s(),t.j41(6,"mat-select",17),t.DNE(7,N,2,2,"mat-option",8),t.k0s()()(),t.j41(8,"div",16)(9,"mat-form-field",5)(10,"mat-label"),t.EFF(11,"Start Time"),t.k0s(),t.nrm(12,"input",18),t.k0s()(),t.j41(13,"div",19),t.DNE(14,V,3,0,"button",20)(15,K,3,0,"button",21),t.k0s()(),t.bVm()),2&o){const e=_.index,s=t.XpG();t.R7$(),t.Y8G("formGroupName",e),t.R7$(6),t.Y8G("ngForOf",s.days),t.R7$(7),t.Y8G("ngIf",s.daysArray.length>1),t.R7$(),t.Y8G("ngIf",e===s.daysArray.length-1)}}function $(o,_){if(1&o&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&o){const e=_.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.fullName)}}function X(o,_){if(1&o&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&o){const e=_.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.fullName)}}let Y=(()=>{class o{constructor(){this.fb=(0,u.WQX)(m.ok),this.lookup=(0,u.WQX)(g.s),this.circle=(0,u.WQX)(y.K),this.toast=(0,u.WQX)(D.f),this.route=(0,u.WQX)(f.nX),this.auth=(0,u.WQX)(R.k),this.teachers=[],this.managers=[],this.students=[],this.isManager=!1,this.days=A.Ep}ngOnInit(){this.isManager=this.auth.getRole()===v.m.Manager,this.circleForm=this.fb.group({name:["",m.k0.required],teacherId:[null,m.k0.required],days:this.fb.array([this.createDayGroup()]),managers:[{value:[],disabled:this.isManager}],studentsIds:[[]]});const e={skipCount:0,maxResultCount:100},s=history.state.course;if(s?.managers?.length&&(this.managers=s.managers.map(a=>a.manager?a.manager:a)),s?.students?.length&&(this.students=s.students.map(a=>a.student?a.student:a)),this.lookup.getUsersForSelects(e,Number(v.m.Teacher)).subscribe(a=>{a.isSuccess&&(this.teachers=a.data.items)}),this.lookup.getUsersForSelects(e,Number(v.m.Manager)).subscribe(a=>{if(a.isSuccess){const i=new Map(this.managers.map(d=>[d.id,d]));a.data.items.forEach(d=>i.set(d.id,d)),this.managers=Array.from(i.values())}}),this.lookup.getUsersForSelects(e,Number(v.m.Student)).subscribe(a=>{if(a.isSuccess){const i=new Map(this.students.map(d=>[d.id,d]));a.data.items.forEach(d=>i.set(d.id,d)),this.students=Array.from(i.values())}}),s){this.id=s.id;const a=s.students?.map(r=>r.id??r.studentId??r.student?.id).filter(r=>void 0!==r)??[],i=this.extractSchedule(s);this.circleForm.patchValue({name:s.name??"",teacherId:s.teacherId??null,studentsIds:a}),this.circleForm.get("managers")?.setValue(s.managers?.map(r=>"number"==typeof r?r:r.managerId)??[],{emitEvent:!1}),this.setDays(i);const d=i.some(r=>null!=r.dayId),l=i.some(r=>"string"==typeof r.startTime&&r.startTime.trim().length>0);(!a.length||!d||!l)&&this.circle.get(this.id).subscribe(r=>{if(r.isSuccess){const c=r.data.students?.map(h=>h.id??h.studentId??h.student?.id).filter(h=>void 0!==h)??[];this.circleForm.patchValue({studentsIds:c}),this.circleForm.get("managers")?.setValue(r.data.managers?.map(h=>"number"==typeof h?h:h.managerId)??[],{emitEvent:!1});const C=this.extractSchedule(r.data);if(this.setDays(C),r.data.students?.length){const h=r.data.students.map(p=>p.student?p.student:p),b=new Map(this.students.map(p=>[p.id,p]));h.forEach(p=>b.set(p.id,p)),this.students=Array.from(b.values())}}})}else this.id=Number(this.route.snapshot.paramMap.get("id")),this.id&&this.circle.get(this.id).subscribe(a=>{if(a.isSuccess){const i=a.data.students?.map(l=>l.id??l.studentId??l.student?.id).filter(l=>void 0!==l)??[];this.circleForm.patchValue({name:a.data.name??"",teacherId:a.data.teacherId??null,studentsIds:i}),this.circleForm.get("managers")?.setValue(a.data.managers?a.data.managers.map(l=>"number"==typeof l?l:l.managerId):[],{emitEvent:!1});const d=this.extractSchedule(a.data);if(this.setDays(d),a.data.students?.length){const l=a.data.students.map(c=>c.student?c.student:c),r=new Map(this.students.map(c=>[c.id,c]));l.forEach(c=>r.set(c.id,c)),this.students=Array.from(r.values())}}})}get daysArray(){return this.circleForm.get("days")}addDay(){this.daysArray.push(this.createDayGroup()),this.daysArray.markAsDirty(),this.daysArray.markAsTouched(),this.daysArray.updateValueAndValidity()}removeDay(e){if(this.daysArray.length<=1)return this.daysArray.at(0).reset({dayId:null,startTime:""}),this.daysArray.markAsDirty(),this.daysArray.markAsTouched(),void this.daysArray.updateValueAndValidity();this.daysArray.removeAt(e),this.daysArray.markAsDirty(),this.daysArray.markAsTouched(),this.daysArray.updateValueAndValidity()}trackByIndex(e){return e}createDayGroup(e){return this.fb.group({dayId:[e?.dayId??null,m.k0.required],startTime:[e?.startTime??"",m.k0.required]})}setDays(e){const s=this.daysArray;for(;s.length;)s.removeAt(s.length-1);e.length?e.forEach(a=>s.push(this.createDayGroup(a))):s.push(this.createDayGroup()),s.markAsPristine(),s.markAsUntouched(),s.updateValueAndValidity()}extractSchedule(e){if(!e)return[];const s=Array.isArray(e.days)&&e.days.length?e.days.map(r=>({dayId:(0,A.lX)(r?.dayId??r?.dayName??void 0)??null,startTime:(0,T.UR)(r?.time)||""})).filter(r=>null!==r.dayId||"string"==typeof r.startTime&&r.startTime.trim().length>0):[];if(s.length)return s;const a=this.resolvePrimaryDay(e),i=(0,A.lX)(a?.dayId??e.dayIds?.[0]??e.dayNames?.[0]??e.dayId??e.day)??null,l=(0,T.UR)(a?.time??e.startTime??e.time).trim();return null!==i||l?[{dayId:i,startTime:l||""}]:[]}resolvePrimaryDay(e){if(e&&Array.isArray(e.days))return e.days.find(s=>!!s)??void 0}onSubmit(){if(this.circleForm.invalid)return void this.circleForm.markAllAsTouched();const e=this.circleForm.getRawValue(),s=Array.isArray(e.days)?e.days.reduce((i,d)=>{const l=(0,A.lX)(d?.dayId??void 0);if(void 0===l)return i;const r=(0,T.C8)(d?.startTime??void 0);return i.push({dayId:l,time:r??null}),i},[]):[];this.circle.update({id:this.id,name:e.name,teacherId:e.teacherId,days:s.length?s:null,managers:e.managers,studentsIds:e.studentsIds}).subscribe({next:i=>{i.isSuccess?this.toast.success("Circle updated successfully"):i.errors?.length?i.errors.forEach(d=>this.toast.error(d.message)):this.toast.error("Error updating circle")},error:()=>this.toast.error("Error updating circle")})}static#t=this.\u0275fac=function(s){return new(s||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-courses-update"]],decls:33,vars:7,consts:[[1,"row"],[1,"col-12"],["cardTitle","Course Update"],[1,"row",3,"ngSubmit","formGroup"],[1,"col-md-6"],["appearance","outline",1,"w-100"],["matInput","","formControlName","name","placeholder","Enter Circle Name"],["formControlName","teacherId"],[3,"value",4,"ngFor","ngForOf"],["formArrayName","days"],[4,"ngFor","ngForOf","ngForTrackBy"],["formControlName","managers","multiple","",3,"disabled"],["formControlName","studentsIds","multiple",""],["mat-flat-button","","color","primary","type","submit"],[3,"value"],[1,"row",3,"formGroupName"],[1,"col-md-5"],["formControlName","dayId"],["matInput","","type","time","formControlName","startTime","placeholder","Select Start Time"],[1,"col-md-2","d-flex","align-items-center"],["mat-icon-button","","color","warn","type","button","class","m-r-10","aria-label","Remove day",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","type","button","aria-label","Add day",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","type","button","aria-label","Remove day",1,"m-r-10",3,"click"],["mat-icon-button","","color","primary","type","button","aria-label","Add day",3,"click"]],template:function(s,a){1&s&&(t.j41(0,"div",0)(1,"div",1)(2,"app-card",2)(3,"form",3),t.bIt("ngSubmit",function(){return a.onSubmit()}),t.j41(4,"div",4)(5,"mat-form-field",5)(6,"mat-label"),t.EFF(7,"Circle Name"),t.k0s(),t.nrm(8,"input",6),t.k0s()(),t.j41(9,"div",4)(10,"mat-form-field",5)(11,"mat-label"),t.EFF(12,"Teacher"),t.k0s(),t.j41(13,"mat-select",7),t.DNE(14,G,2,2,"mat-option",8),t.k0s()()(),t.j41(15,"div",1)(16,"div",9),t.DNE(17,L,16,4,"ng-container",10),t.k0s()(),t.j41(18,"div",4)(19,"mat-form-field",5)(20,"mat-label"),t.EFF(21,"Managers"),t.k0s(),t.j41(22,"mat-select",11),t.DNE(23,$,2,2,"mat-option",8),t.k0s()()(),t.j41(24,"div",4)(25,"mat-form-field",5)(26,"mat-label"),t.EFF(27,"Students"),t.k0s(),t.j41(28,"mat-select",12),t.DNE(29,X,2,2,"mat-option",8),t.k0s()()(),t.j41(30,"div",1)(31,"button",13),t.EFF(32,"Update"),t.k0s()()()()()()),2&s&&(t.R7$(3),t.Y8G("formGroup",a.circleForm),t.R7$(11),t.Y8G("ngForOf",a.teachers),t.R7$(3),t.Y8G("ngForOf",a.daysArray.controls)("ngForTrackBy",a.trackByIndex),t.R7$(5),t.Y8G("disabled",a.isManager),t.R7$(),t.Y8G("ngForOf",a.managers),t.R7$(6),t.Y8G("ngForOf",a.students))},dependencies:[O.G,E.Sq,E.bT,P.$z,U.M,k.An,B.fg,M.j,M.M,S.g,W.M,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,m.$R,m.v8,j.i,E.MD],encapsulation:2})}return o})()},87509:(F,I,n)=>{n.d(I,{f:()=>m});var u=n(48728),E=n(95416);let m=(()=>{class f{constructor(){this.snackBar=(0,u.WQX)(E.UG)}success(g,y="Close",D=3e3){this.snackBar.open(g,y,{duration:D,panelClass:["toast-success"]})}error(g,y="Close",D=3e3){this.snackBar.open(g,y,{duration:D,panelClass:["toast-error"]})}static#t=this.\u0275fac=function(y){return new(y||f)};static#e=this.\u0275prov=u.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()}}]);