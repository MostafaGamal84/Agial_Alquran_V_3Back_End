"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[278],{278:(U,D,s)=>{s.r(D),s.d(D,{InvoiceListComponent:()=>Pe,MONTH_FORMATS:()=>w});var T=s(2200),r=s(8728),p=s(9417),m=s(5263),y=s(7356),L=s(7586),A=s.n(L),S=s(3243),k=s(6053),M=s(7705),g=s(3597),N=s(9928),o=s(6045),c=s(4626),e=s(3664);let E=(()=>{class a{constructor(){this.themeService=(0,r.WQX)(N.z),this.seriesData=M.hFB.required(),this.colors=M.hFB.required(),(0,g.QZ)(()=>{this.isDarkTheme(this.themeService.isDarkMode())})}ngOnInit(){this.chartOptions={chart:{type:"area",height:55,sparkline:{enabled:!0}},series:[{data:this.seriesData()}],fill:{type:"gradient",gradient:{shadeIntensity:1,type:"vertical",inverseColors:!1,opacityFrom:.5,opacityTo:0}},stroke:{curve:"smooth",width:2},grid:{show:!1},tooltip:{fixed:{enabled:!1},x:{show:!1},marker:{show:!1}},colors:this.colors()}}isDarkTheme(n){const i={...this.chartOptions.tooltip};i.theme=n===o.nd?o.nd:o.T,this.chartOptions={...this.chartOptions,tooltip:i}}static#e=this.\u0275fac=function(i){return new(i||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-invoice-list-chart"]],inputs:{seriesData:[1,"seriesData"],colors:[1,"colors"]},decls:2,vars:6,consts:[[1,"chart"],[3,"series","chart","colors","fill","stroke","tooltip"]],template:function(i,t){1&i&&(e.j41(0,"div",0),e.nrm(1,"apx-chart",1),e.k0s()),2&i&&(e.R7$(),e.Y8G("series",t.chartOptions.series)("chart",t.chartOptions.chart)("colors",t.chartOptions.colors)("fill",t.chartOptions.fill)("stroke",t.chartOptions.stroke)("tooltip",t.chartOptions.tooltip))},dependencies:[k.G,c.J,c.Q],encapsulation:2})}return a})();var F=s(2042),v=s(645),_=s(7468),$=s(1194),b=s(357),V=s(1703),x=s(8834),J=s(6751),O=s(3746),B=s(7673),Z=s(6354),X=s(9437),Q=s(5558),P=s(8018),R=s(4507);let W=(()=>{class a{constructor(){this.fb=(0,r.WQX)(p.ok),this.service=(0,r.WQX)($.NC),this.dialogRef=(0,r.WQX)(b.k),this.data=(0,r.WQX)(b.e),this.currencyLabel=(0,$.yz)(this.data.currencyId??this.data.currency??null),this.form=this.fb.group({subscribe:[{value:this.data.subscribe,disabled:!0}],amount:[this.data.amount,p.k0.required],currency:[{value:this.currencyLabel,disabled:!0}]})}onFileChange(n){const i=n.target;i.files&&i.files.length&&(this.receiptFile=i.files[0])}confirm(){this.submitUpdate(!0,!1)}cancel(){this.submitUpdate(!1,!0)}submitUpdate(n,i){const t={id:this.data.invoiceId,amount:this.form.get("amount")?.value??void 0,payStatue:n,isCancelled:i};(this.receiptFile?(0,B.of)(this.receiptFile):this.service.downloadPaymentReceipt(this.data.invoiceId).pipe((0,Z.T)(u=>this.toReceiptFile(u)),(0,X.W)(u=>(console.error("Failed to load receipt PDF for payment update.",u),(0,B.of)(void 0))))).pipe((0,Q.n)(u=>this.service.updatePayment(t,u))).subscribe({next:()=>this.dialogRef.close(!0),error:u=>console.error("Failed to update payment status with receipt attachment.",u)})}toReceiptFile(n){if(!n||0===n.size)return;const i=n.type&&""!==n.type?n.type:"application/pdf",t=(new Date).toISOString().split("T")[0],l=`payment-receipt-${this.data.invoiceId}-${t}.pdf`;try{return new File([n],l,{type:i})}catch(u){return void console.error("Failed to construct receipt file from blob.",u)}}static#e=this.\u0275fac=function(i){return new(i||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-payment-edit"]],decls:24,vars:16,consts:[["mat-dialog-title",""],["mat-dialog-content","",3,"formGroup"],["appearance","outline",1,"w-100"],["matInput","","formControlName","subscribe"],["matInput","","type","number","formControlName","amount"],["type","file",3,"change"],["mat-dialog-actions","","align","end"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(i,t){1&i&&(e.j41(0,"h2",0),e.EFF(1),e.nI1(2,"translate"),e.k0s(),e.j41(3,"div",1)(4,"mat-form-field",2)(5,"mat-label"),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.nrm(8,"input",3),e.k0s(),e.j41(9,"mat-form-field",2)(10,"mat-label"),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.nrm(13,"input",4),e.k0s(),e.j41(14,"input",5),e.bIt("change",function(u){return t.onFileChange(u)}),e.k0s()(),e.j41(15,"div",6)(16,"button",7),e.bIt("click",function(){return t.confirm()}),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"button",8),e.bIt("click",function(){return t.cancel()}),e.EFF(20,"\u0625\u0644\u063a\u0627\u0621 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629"),e.k0s(),e.j41(21,"button",9),e.EFF(22),e.nI1(23,"translate"),e.k0s()()),2&i&&(e.R7$(),e.JRh(e.bMT(2,6,"\u062a\u0639\u062f\u064a\u0644 \u062d\u0627\u0644\u0629 \u0627\u0644\u062f\u0641\u0639")),e.R7$(2),e.Y8G("formGroup",t.form),e.R7$(3),e.JRh(e.bMT(7,8,"\u0627\u0644\u0628\u0627\u0642\u0629")),e.R7$(5),e.JRh(e.bMT(12,10,"\u0627\u0644\u0645\u0628\u0644\u063a")),e.R7$(6),e.JRh(e.bMT(18,12,"\u062a\u0627\u0643\u064a\u062f \u0627\u0644\u062f\u0641\u0639")),e.R7$(5),e.JRh(e.bMT(23,14,"\u0627\u063a\u0644\u0627\u0642")))},dependencies:[T.MD,b.l,b.a,b.b,b.M,b.c,x.Hl,x.$z,J.M,R.j,R.M,O.fS,O.fg,p.X1,p.me,p.Q0,p.BC,p.cb,p.j4,p.JD,P.h,P.D9],encapsulation:2})}return a})();var H=s(5747);const z=["loadMoreTrigger"];function K(a,d){1&a&&(e.j41(0,"th",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Invoice ID")))}function q(a,d){if(1&a&&(e.j41(0,"td",24),e.EFF(1),e.k0s()),2&a){const n=d.$implicit;e.R7$(),e.JRh(n.id)}}function ee(a,d){1&a&&(e.j41(0,"th",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Student")))}function te(a,d){if(1&a&&(e.j41(0,"td",26),e.EFF(1),e.k0s()),2&a){const n=d.$implicit;e.R7$(),e.SpI(" ",n.name," ")}}function ne(a,d){1&a&&(e.j41(0,"th",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Create Date")))}function ae(a,d){if(1&a&&(e.j41(0,"td",26),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&a){const n=d.$implicit;e.R7$(),e.JRh(e.i5U(2,1,n.create_date,"dd/MM/yyyy"))}}function ie(a,d){1&a&&(e.j41(0,"th",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Due Date")))}function se(a,d){if(1&a&&(e.j41(0,"td",26),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&a){const n=d.$implicit;e.R7$(),e.JRh(e.i5U(2,1,n.due_date,"dd/MM/yyyy"))}}function oe(a,d){1&a&&(e.j41(0,"th",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"\u0627\u0644\u0645\u0628\u0644\u063a")))}function re(a,d){if(1&a&&(e.j41(0,"td",26),e.EFF(1),e.k0s()),2&a){const n=d.$implicit;e.R7$(),e.JRh(n.qty)}}function le(a,d){1&a&&(e.j41(0,"th",25),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Status")))}function de(a,d){1&a&&(e.j41(0,"span",27),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Paid")))}function ce(a,d){1&a&&(e.j41(0,"span",28),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Unpaid")))}function ue(a,d){1&a&&(e.j41(0,"span",29),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Overdue")))}function he(a,d){1&a&&(e.j41(0,"span",29),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Cancelled")))}function me(a,d){if(1&a&&(e.j41(0,"td",26),e.nVh(1,de,3,3,"span",27)(2,ce,3,3,"span",28)(3,ue,3,3,"span",29)(4,he,3,3,"span",29),e.k0s()),2&a){const n=d.$implicit;e.R7$(),e.vxM("paid"===n.status?1:"unpaid"===n.status?2:"overdue"===n.status?3:"cancelled"===n.status?4:-1)}}function pe(a,d){1&a&&(e.j41(0,"th",30),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a&&(e.R7$(),e.JRh(e.bMT(2,1,"Actions")))}function fe(a,d){if(1&a){const n=e.RV6();e.j41(0,"td",26)(1,"ul",31)(2,"li",32)(3,"a",33),e.nI1(4,"translate"),e.bIt("click",function(){const t=r.eBV(n).$implicit,l=e.XpG();return r.Njj(l.openPaymentDetails(t.id))}),e.nrm(5,"i",34),e.k0s()(),e.j41(6,"li",32)(7,"a",35),e.nI1(8,"translate"),e.bIt("click",function(){const t=r.eBV(n).$implicit,l=e.XpG();return r.Njj(l.openPaymentEdit(t.id))}),e.nrm(9,"i",36),e.k0s()()()()}2&a&&(e.R7$(3),e.Y8G("matTooltip",e.bMT(4,2,"\u0639\u0631\u0636")),e.R7$(4),e.Y8G("matTooltip",e.bMT(8,4,"\u062a\u0639\u062f\u064a\u0644")))}function ve(a,d){1&a&&e.nrm(0,"tr",37)}function ge(a,d){1&a&&e.nrm(0,"tr",38)}let be=(()=>{class a{constructor(){this.search="",this.residentId=null,this.residentGroup="all",this.refreshToken=0,this.countChange=new e.bkB,this.paymentUpdated=new e.bkB,this.studentPaymentService=(0,r.WQX)($.NC),this.dialog=(0,r.WQX)(b.h),this.displayedColumns=["id","name","create_date","due_date","qty","status","action"],this.dataSource=new v.I6([]),this.searchTerm="",this.totalCount=0,this.pageIndex=0,this.pageSize=100,this.sort=(0,M.ebz)(F.B4),this.isLoading=!1,this.isLoadingMore=!1}set loadMoreTrigger(n){this.loadMoreElement=n,this.setupIntersectionObserver()}ngOnInit(){this.dataSource.filterPredicate=(n,i)=>{const t=i.trim().toLowerCase();return n.id.toString().includes(t)||n.name.toLowerCase().includes(t)||n.create_date.toLowerCase().includes(t)||n.due_date.toLowerCase().includes(t)||n.qty.toString().includes(t)||n.status.toLowerCase().includes(t)},this.searchTerm=this.search,this.loadData()}ngOnChanges(n){(n.tab||n.month||n.compareMonth||n.residentId||n.residentGroup||n.refreshToken)&&(this.pageIndex=0,this.loadData()),n.search&&!n.search.firstChange&&(this.searchTerm=this.search,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.dataSource.filteredData.length))}applyFilter(n){this.searchTerm=n.target.value,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.dataSource.filteredData.length)}openPaymentDetails(n){this.studentPaymentService.getPayment(n).subscribe(i=>{i.isSuccess&&i.data&&this.dialog.open(V.i,{data:i.data}).afterClosed().subscribe(l=>{l&&(this.loadData(),this.paymentUpdated.emit())})})}openPaymentEdit(n){this.studentPaymentService.getPayment(n).subscribe(i=>{i.isSuccess&&i.data&&this.dialog.open(W,{data:i.data}).afterClosed().subscribe(l=>{l&&(this.loadData(),this.paymentUpdated.emit())})})}loadData(n=!1){this.isLoading=!n,this.isLoadingMore=n;const i={skipCount:this.pageIndex*this.pageSize,maxResultCount:this.pageSize,residentGroup:this.residentGroup};let t,l;this.month&&(t=new Date(this.month+"-01")),this.compareMonth&&(l=new Date(this.compareMonth+"-01"));const u=h=>h.data.items.map(f=>({id:f.invoiceId,name:f.userName??"",create_date:f.createDate??"",due_date:f.dueDate??"",qty:f.amount??0,status:(f.statusText??"").toLowerCase(),payStatue:f.payStatue??!1,isCancelled:f.isCancelled??!1}));if(this.tab&&"all"!==this.tab){const h=[];t&&h.push(this.studentPaymentService.getInvoices(i,this.tab,void 0,void 0,void 0,void 0,void 0,t,this.residentId??void 0)),l&&h.push(this.studentPaymentService.getInvoices(i,this.tab,void 0,void 0,void 0,void 0,void 0,l,this.residentId??void 0)),(0,_.p)(h).subscribe({next:f=>{this.totalCount=f.reduce((C,I)=>C+(I.data.totalCount??0),0);const j=f.reduce((C,I)=>[...C,...u(I)],[]);this.dataSource.data=n?[...this.dataSource.data,...j]:j,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.totalCount||this.dataSource.filteredData.length),this.isLoading=!1,this.isLoadingMore=!1},error:()=>{n||(this.dataSource.data=[]),this.totalCount=0,this.isLoading=!1,this.isLoadingMore=!1}})}else{const h=[];t&&(h.push(this.studentPaymentService.getInvoices(i,void 0,void 0,void 0,void 0,void 0,void 0,t,this.residentId??void 0)),h.push(this.studentPaymentService.getInvoices(i,"overdue",void 0,void 0,void 0,void 0,void 0,t,this.residentId??void 0))),l&&(h.push(this.studentPaymentService.getInvoices(i,void 0,void 0,void 0,void 0,void 0,void 0,l,this.residentId??void 0)),h.push(this.studentPaymentService.getInvoices(i,"overdue",void 0,void 0,void 0,void 0,void 0,l,this.residentId??void 0))),(0,_.p)(h).subscribe({next:f=>{this.totalCount=f.reduce((C,I)=>C+(I.data.totalCount??0),0);const j=f.reduce((C,I)=>[...C,...u(I)],[]);this.dataSource.data=n?[...this.dataSource.data,...j]:j,this.dataSource.filter=this.searchTerm.trim().toLowerCase(),this.countChange.emit(this.totalCount||this.dataSource.filteredData.length),this.isLoading=!1,this.isLoadingMore=!1},error:()=>{n||(this.dataSource.data=[]),this.totalCount=0,this.isLoading=!1,this.isLoadingMore=!1}})}}ngAfterViewInit(){this.dataSource.sort=this.sort()}ngOnDestroy(){this.intersectionObserver?.disconnect()}setupIntersectionObserver(){this.loadMoreElement&&(this.intersectionObserver?.disconnect(),this.intersectionObserver=new IntersectionObserver(n=>{n.some(i=>i.isIntersecting)&&this.loadNextPage()},{root:null,rootMargin:"0px 0px 20% 0px"}),this.intersectionObserver.observe(this.loadMoreElement.nativeElement))}loadNextPage(){this.isLoading||this.isLoadingMore||this.hasMoreResults()&&(this.pageIndex+=1,this.loadData(!0))}hasMoreResults(){return this.dataSource.data.length<this.totalCount}static#e=this.\u0275fac=function(i){return new(i||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-invoice-list-table"]],viewQuery:function(i,t){if(1&i&&(e.wEZ(t.sort,F.B4,5),e.GBs(z,5)),2&i){let l;e.NyB(),e.mGM(l=e.lsd())&&(t.loadMoreTrigger=l.first)}},inputs:{tab:"tab",month:"month",compareMonth:"compareMonth",search:"search",residentId:"residentId",residentGroup:"residentGroup",refreshToken:"refreshToken"},outputs:{countChange:"countChange",paymentUpdated:"paymentUpdated"},features:[e.OA$],decls:35,vars:12,consts:[["input",""],["loadMoreTrigger",""],[1,"table-responsive"],[1,"table-search","p-t-20","p-x-20"],["appearance","outline",1,"w-100"],["matInput","",3,"keyup","placeholder","value"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap text-center",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","create_date"],["matColumnDef","due_date"],["matColumnDef","qty"],["matColumnDef","status"],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"app-paginator"],[1,"text-muted"],["mat-header-cell","","mat-sort-header","",1,"text-center"],["mat-cell","",1,"text-nowrap","text-center"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"text-nowrap"],[1,"user-status","bg-success-500","text-white"],[1,"user-status","bg-cyan-500","text-white"],[1,"user-status","bg-warn-500","text-white"],["mat-header-cell",""],[1,"list-inline","m-b-0"],[1,"list-inline-item"],["href","javascript:",1,"avatar","avatar-xs","bg-accent-100","hover","m-r-10",3,"click","matTooltip"],[1,"f-20","ti","ti-eye","text-accent-500"],["href","javascript:",1,"avatar","avatar-xs","bg-primary-50","hover","m-r-10",3,"click","matTooltip"],[1,"f-20","ti","ti-edit","text-primary-500"],["mat-header-row",""],["mat-row",""]],template:function(i,t){if(1&i){const l=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"mat-form-field",4)(3,"input",5,0),e.nI1(5,"translate"),e.bIt("keyup",function(h){return r.eBV(l),r.Njj(t.applyFilter(h))}),e.k0s()()(),e.j41(6,"table",6),e.qex(7,7),e.DNE(8,K,3,3,"th",8)(9,q,2,1,"td",9),e.bVm(),e.qex(10,10),e.DNE(11,ee,3,3,"th",11)(12,te,2,1,"td",12),e.bVm(),e.qex(13,13),e.DNE(14,ne,3,3,"th",11)(15,ae,3,4,"td",12),e.bVm(),e.qex(16,14),e.DNE(17,ie,3,3,"th",11)(18,se,3,4,"td",12),e.bVm(),e.qex(19,15),e.DNE(20,oe,3,3,"th",11)(21,re,2,1,"td",12),e.bVm(),e.qex(22,16),e.DNE(23,le,3,3,"th",11)(24,me,5,1,"td",12),e.bVm(),e.qex(25,17),e.DNE(26,pe,3,3,"th",18)(27,fe,10,6,"td",12),e.bVm(),e.DNE(28,ve,1,0,"tr",19)(29,ge,1,0,"tr",20),e.k0s(),e.j41(30,"div",21,1)(32,"span",22),e.EFF(33),e.nI1(34,"translate"),e.k0s()()()}2&i&&(e.R7$(3),e.Y8G("placeholder",e.bMT(5,8,"Search..."))("value",t.searchTerm),e.R7$(3),e.Y8G("dataSource",t.dataSource),e.R7$(22),e.Y8G("matHeaderRowDef",t.displayedColumns),e.R7$(),e.Y8G("matRowDefColumns",t.displayedColumns),e.R7$(),e.AVh("d-none",!t.hasMoreResults()),e.R7$(3),e.SpI(" ",e.bMT(34,10,t.isLoadingMore?"Loading more...":"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")," "))},dependencies:[k.G,O.fg,R.j,H.e,v.Zl,v.tL,v.ji,v.cC,v.YV,v.iL,v.KS,v.$R,v.YZ,v.NB,T.vh,P.D9],styles:[".bg-cyan-500[_ngcontent-%COMP%]{background:#3ec9d6}"]})}return a})();var Ce=s(6848),Ie=s(2754),Te=s(7753),Re=s(7575),Y=s(6850),ye=s(3791),Me=s(5079),G=s(5084),Fe=s(6735),_e=s(8863);function je(a,d){if(1&a&&(e.j41(0,"mat-option",42),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const n=d.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" ",e.bMT(2,2,n.translationKey)," ")}}function De(a,d){if(1&a&&(e.j41(0,"div",14)(1,"app-card",43)(2,"div",44)(3,"div",45),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"p",46),e.nrm(7,"i"),e.EFF(8),e.k0s()(),e.j41(9,"div",47)(10,"div",48)(11,"div",49),e.EFF(12),e.k0s(),e.j41(13,"div",50)(14,"div",51),e.EFF(15),e.k0s(),e.j41(16,"p",52),e.EFF(17),e.nI1(18,"translate"),e.k0s()()(),e.j41(19,"div",48),e.nrm(20,"app-invoice-list-chart",53),e.k0s()()()()),2&a){const n=d.$implicit;e.R7$(),e.Y8G("showHeader",!1)("padding",20),e.R7$(3),e.JRh(e.bMT(5,13,n.title)),e.R7$(3),e.HbH(e.ai1("f-14 ti ti-",!0===n.isLoss?"caret-down-filled":"caret-up-filled"," ",n.color)),e.R7$(),e.SpI(" ",n.percentage,"% "),e.R7$(4),e.JRh(n.value),e.R7$(3),e.JRh(n.invoice),e.R7$(2),e.JRh(e.bMT(18,15,"Invoices")),e.R7$(3),e.Y8G("seriesData",n.data)("colors",n.colors)}}function Le(a,d){if(1&a&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",54),e.EFF(4),e.k0s()()),2&a){const n=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,2,"All")," "),e.R7$(3),e.SpI(" ",n.tabCounts.all," ")}}function Se(a,d){if(1&a&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",55),e.EFF(4),e.k0s()()),2&a){const n=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,2,"Paid")," "),e.R7$(3),e.SpI(" ",n.tabCounts.paid," ")}}function ke(a,d){if(1&a&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",56),e.EFF(4),e.k0s()()),2&a){const n=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,2,"Unpaid")," "),e.R7$(3),e.SpI(" ",n.tabCounts.unpaid," ")}}function Ee(a,d){if(1&a&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",57),e.EFF(4),e.k0s()()),2&a){const n=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,2,"Overdue")," "),e.R7$(3),e.SpI(" ",n.tabCounts.overdue," ")}}function $e(a,d){if(1&a&&(e.j41(0,"div",17),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"div",57),e.EFF(4),e.k0s()()),2&a){const n=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,2,"Cancelled")," "),e.R7$(3),e.SpI(" ",n.tabCounts.cancelled," ")}}const Oe=A()||L,w={parse:{dateInput:"MMMM YYYY"},display:{dateInput:"MMMM YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let Pe=(()=>{class a{constructor(){this.studentPaymentService=(0,r.WQX)($.NC),this.lookupService=(0,r.WQX)(Ce.s),this.route=(0,r.WQX)(S.nX),this.dataMonth=new p.MJ(Oe().startOf("month").utc(!0)),this.compareMonth=new p.MJ(null),this.widgetCards=[],this.bigCard={currentReceivables:0,overdueReceivables:0,totalReceivables:0,collectionRate:0},this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0},this.searchTerm="",this.nationalities=[],this.selectedResidentId=null,this.residencyGroupOptions=Ie.w,this.selectedResidencyGroup="all",this.isLoading=!1,this.refreshToken=0}ngOnInit(){this.searchTerm=this.route.snapshot.queryParamMap.get("search")??"",this.route.queryParamMap.subscribe(n=>{this.searchTerm=n.get("search")??""}),this.loadNationalities(),this.loadDashboard()}loadNationalities(){this.lookupService.getAllNationalities().subscribe(n=>{this.nationalities=n.isSuccess&&Array.isArray(n.data)?n.data:[]})}setDataMonthAndYear(n,i){this.dataMonth.setValue(n.clone().startOf("month").utc(!0)),i.close(),this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0},this.loadDashboard()}setCompareMonthAndYear(n,i){this.compareMonth.setValue(n.clone().startOf("month").utc(!0)),i.close(),this.loadDashboard()}onTableCount(n,i){this.tabCounts[n]=i,"all"!==n&&(this.tabCounts.all=this.tabCounts.paid+this.tabCounts.unpaid+this.tabCounts.overdue+this.tabCounts.cancelled)}loadDashboard(){this.isLoading=!0;const n=this.dataMonth.value?.toDate(),i=this.compareMonth.value?.toDate();this.studentPaymentService.getDashboard(void 0,void 0,n,i).subscribe({next:t=>{const l=this.getTrend(t.totalPaidMoMPercentage),u=this.getTrend(t.totalUnPaidMoMPercentage),h=this.getTrend(t.totalOverdueMoMPercentage);this.widgetCards=[{title:"Paid",value:`$${t.totalPaid}`,percentage:t.totalPaidMoMPercentage,invoice:t.totalPaidCount,data:t.paidChart??[],colors:["#2ca87f"],...l},{title:"Unpaid",value:`$${t.totalUnPaid}`,percentage:t.totalUnPaidMoMPercentage,invoice:t.totalUnPaidCount,data:t.unpaidChart??[],colors:["#e58a00"],...u},{title:"Overdue",value:`$${t.totalOverdue}`,percentage:t.totalOverdueMoMPercentage,invoice:t.totalOverdueCount,data:t.overdueChart??[],colors:["#dc2626"],...h}],this.bigCard={currentReceivables:t.currentReceivables,overdueReceivables:t.overdueReceivables,totalReceivables:t.totalReceivables,collectionRate:t.collectionRate}},error:()=>{this.widgetCards=[],this.bigCard={currentReceivables:0,overdueReceivables:0,totalReceivables:0,collectionRate:0}},complete:()=>{this.isLoading=!1}})}getTrend(n){const i=n<0;return{isLoss:i,color:i?"text-warn-500":"text-success-500"}}onResidencyChange(n){this.selectedResidentId=n&&n>0?n:null,this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0}}onResidencyGroupChange(n){this.selectedResidencyGroup=n??"all",this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0}}handlePaymentUpdated(){this.refreshToken+=1,this.tabCounts={all:0,paid:0,unpaid:0,overdue:0,cancelled:0},this.loadDashboard()}static#e=this.\u0275fac=function(i){return new(i||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-invoice-list"]],features:[e.Jv_([{provide:y.D,useClass:m.QH,deps:[y.M,m.ij]},{provide:y.a,useValue:w}])],decls:85,vars:61,consts:[["dataPicker",""],["comparePicker",""],[3,"isLoading"],[1,"row"],[1,"col-12","mb-3","text-end"],[1,"flex","gap-2","justify-content-end","flex-wrap"],["appearance","outline"],["matInput","",3,"matDatepicker","formControl"],["matIconSuffix","",3,"for"],["startView","multi-year","panelClass","example-month-picker",3,"monthSelected"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"col-xxl-8"],[1,"row","g-3","mb-3"],[1,"col-md-6","col-lg-4"],[1,"col-xxl-4"],["cardClass","bg-primary-500",3,"showHeader","padding"],[1,"flex","align-item-center","justify-content-between"],[1,"flex","align-item-center"],[1,"avatar","avatar-s","bg-primary-400"],[1,"ti","ti-file-text","f-20","text-white"],[1,"m-l-10"],[1,"m-b-0","text-white"],[1,"ti","ti-info-circle","text-white","m-l-10"],[1,"m-b-0","text-white","text-sm"],[1,"m-b-0","text-white","m-l-10"],[1,"flex"],[1,"m-t-15","text-white","f-16","f-w-600","m-b-5"],[1,"flex-grow-1","m-r-15"],["color","warn","mode","determinate",3,"value"],[1,"flex-shrink-0","text-end","wid-30"],[1,"text-white","m-b-0"],[1,"col-12"],[3,"showHeader","padding"],["mat-stretch-tabs","false","mat-align-tabs","start",1,"invoice-data"],["mat-tab-label",""],[1,"p-y-20"],[3,"countChange","paymentUpdated","month","search","residentId","residentGroup","refreshToken"],["tab","paid",3,"countChange","paymentUpdated","month","search","residentId","residentGroup","refreshToken"],["tab","unpaid",3,"countChange","paymentUpdated","month","search","residentId","residentGroup","refreshToken"],["tab","overdue",3,"countChange","paymentUpdated","month","search","residentId","residentGroup","refreshToken"],["tab","cancelled",3,"countChange","paymentUpdated","month","search","residentId","residentGroup","refreshToken"],[3,"value"],["cardClass","m-b-0",3,"showHeader","padding"],[1,"m-b-10","flex","align-item-center","justify-content-between","gap-1"],[1,"f-w-600"],[1,"m-b-0","text-muted","flex","align-item-center","gap-1"],[1,"row","g-2","align-item-center"],[1,"col-6"],[1,"f-w-600","f-16","m-b-5","m-t-15"],[1,"flex","align-item-center","gap-1"],[1,"m-b-0","f-16","f-w-600"],[1,"m-b-0","text-muted","flex","align-item-center","gap-2"],[3,"seriesData","colors"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-primary-50","text-primary-500","m-l-10"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-success-50","text-success-500","m-l-10"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-warning-50","text-warning-500","m-l-10"],[1,"wid-20","hei-20","border-50","flex","align-item-center","justify-content-center","bg-warn-50","text-warn-500","m-l-10"]],template:function(i,t){if(1&i){const l=e.RV6();e.j41(0,"app-loading-overlay",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"mat-form-field",6)(5,"mat-label"),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.nrm(8,"input",7)(9,"mat-datepicker-toggle",8),e.j41(10,"mat-datepicker",9,0),e.bIt("monthSelected",function(h){r.eBV(l);const f=e.sdS(11);return r.Njj(t.setDataMonthAndYear(h,f))}),e.k0s()(),e.j41(12,"mat-form-field",6)(13,"mat-label"),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.nrm(16,"input",7)(17,"mat-datepicker-toggle",8),e.j41(18,"mat-datepicker",9,1),e.bIt("monthSelected",function(h){r.eBV(l);const f=e.sdS(19);return r.Njj(t.setCompareMonthAndYear(h,f))}),e.k0s()(),e.j41(20,"mat-form-field",6)(21,"mat-label"),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"mat-select",10),e.bIt("selectionChange",function(h){return r.eBV(l),r.Njj(t.onResidencyGroupChange(h.value))}),e.DNE(25,je,3,4,"mat-option",11),e.k0s()()()(),e.j41(26,"div",12)(27,"div",13),e.Z7z(28,De,21,17,"div",14,e.fX1),e.k0s()(),e.j41(30,"div",15)(31,"app-card",16)(32,"div",17)(33,"div",18)(34,"div",19),e.nrm(35,"i",20),e.k0s(),e.j41(36,"div",21)(37,"div",18)(38,"p",22),e.EFF(39),e.nI1(40,"translate"),e.k0s(),e.nrm(41,"i",23),e.k0s(),e.j41(42,"div",18)(43,"p",24),e.EFF(44),e.nI1(45,"translate"),e.k0s(),e.j41(46,"p",25),e.EFF(47),e.k0s()()()(),e.j41(48,"div",26)(49,"p",24),e.EFF(50),e.nI1(51,"translate"),e.k0s(),e.j41(52,"p",25),e.EFF(53),e.k0s()()(),e.j41(54,"div",27),e.EFF(55),e.k0s(),e.j41(56,"div",18)(57,"div",28),e.nrm(58,"mat-progress-bar",29),e.k0s(),e.j41(59,"div",30)(60,"p",31),e.EFF(61),e.k0s()()()()(),e.j41(62,"div",32)(63,"app-card",33)(64,"mat-tab-group",34)(65,"mat-tab"),e.DNE(66,Le,5,4,"ng-template",35),e.j41(67,"div",36)(68,"app-invoice-list-table",37),e.bIt("countChange",function(h){return r.eBV(l),r.Njj(t.onTableCount("all",h))})("paymentUpdated",function(){return r.eBV(l),r.Njj(t.handlePaymentUpdated())}),e.k0s()()(),e.j41(69,"mat-tab"),e.DNE(70,Se,5,4,"ng-template",35),e.j41(71,"div",36)(72,"app-invoice-list-table",38),e.bIt("countChange",function(h){return r.eBV(l),r.Njj(t.onTableCount("paid",h))})("paymentUpdated",function(){return r.eBV(l),r.Njj(t.handlePaymentUpdated())}),e.k0s()()(),e.j41(73,"mat-tab"),e.DNE(74,ke,5,4,"ng-template",35),e.j41(75,"div",36)(76,"app-invoice-list-table",39),e.bIt("countChange",function(h){return r.eBV(l),r.Njj(t.onTableCount("unpaid",h))})("paymentUpdated",function(){return r.eBV(l),r.Njj(t.handlePaymentUpdated())}),e.k0s()()(),e.j41(77,"mat-tab"),e.DNE(78,Ee,5,4,"ng-template",35),e.j41(79,"div",36)(80,"app-invoice-list-table",40),e.bIt("countChange",function(h){return r.eBV(l),r.Njj(t.onTableCount("overdue",h))})("paymentUpdated",function(){return r.eBV(l),r.Njj(t.handlePaymentUpdated())}),e.k0s()()(),e.j41(81,"mat-tab"),e.DNE(82,$e,5,4,"ng-template",35),e.j41(83,"div",36)(84,"app-invoice-list-table",41),e.bIt("countChange",function(h){return r.eBV(l),r.Njj(t.onTableCount("cancelled",h))})("paymentUpdated",function(){return r.eBV(l),r.Njj(t.handlePaymentUpdated())}),e.k0s()()()()()()()()}if(2&i){const l=e.sdS(11),u=e.sdS(19);e.Y8G("isLoading",t.isLoading),e.R7$(6),e.JRh(e.bMT(7,49,"Month")),e.R7$(2),e.Y8G("matDatepicker",l)("formControl",t.dataMonth),e.R7$(),e.Y8G("for",l),e.R7$(5),e.JRh(e.bMT(15,51,"Compare Month")),e.R7$(2),e.Y8G("matDatepicker",u)("formControl",t.compareMonth),e.R7$(),e.Y8G("for",u),e.R7$(5),e.JRh(e.bMT(23,53,"Residency Group")),e.R7$(2),e.Y8G("value",t.selectedResidencyGroup),e.R7$(),e.Y8G("ngForOf",t.residencyGroupOptions),e.R7$(3),e.Dyx(t.widgetCards),e.R7$(3),e.Y8G("showHeader",!1)("padding",14),e.R7$(8),e.JRh(e.bMT(40,55,"Total Receivables")),e.R7$(5),e.JRh(e.bMT(45,57,"Current")),e.R7$(3),e.JRh(t.bigCard.currentReceivables),e.R7$(3),e.JRh(e.bMT(51,59,"Overdue")),e.R7$(3),e.JRh(t.bigCard.overdueReceivables),e.R7$(2),e.SpI("$",t.bigCard.totalReceivables),e.R7$(3),e.Y8G("value",t.bigCard.collectionRate),e.R7$(3),e.SpI("",t.bigCard.collectionRate,"%"),e.R7$(2),e.Y8G("showHeader",!1)("padding",0),e.R7$(5),e.Y8G("month",null==t.dataMonth.value?null:t.dataMonth.value.format("YYYY-MM"))("search",t.searchTerm)("residentId",t.selectedResidentId)("residentGroup",t.selectedResidencyGroup)("refreshToken",t.refreshToken),e.R7$(4),e.Y8G("month",null==t.dataMonth.value?null:t.dataMonth.value.format("YYYY-MM"))("search",t.searchTerm)("residentId",t.selectedResidentId)("residentGroup",t.selectedResidencyGroup)("refreshToken",t.refreshToken),e.R7$(4),e.Y8G("month",null==t.dataMonth.value?null:t.dataMonth.value.format("YYYY-MM"))("search",t.searchTerm)("residentId",t.selectedResidentId)("residentGroup",t.selectedResidencyGroup)("refreshToken",t.refreshToken),e.R7$(4),e.Y8G("month",null==t.dataMonth.value?null:t.dataMonth.value.format("YYYY-MM"))("search",t.searchTerm)("residentId",t.selectedResidentId)("residentGroup",t.selectedResidencyGroup)("refreshToken",t.refreshToken),e.R7$(4),e.Y8G("month",null==t.dataMonth.value?null:t.dataMonth.value.format("YYYY-MM"))("search",t.searchTerm)("residentId",t.selectedResidentId)("residentGroup",t.selectedResidencyGroup)("refreshToken",t.refreshToken)}},dependencies:[k.G,T.Sq,O.fg,R.j,R.M,R.g,Re.HM,Y.ES,Y.mq,Y.T8,ye.g,Me.M,G.Vh,G.bZ,G.bU,p.me,p.BC,p.l_,Fe.i,_e.m,P.D9,T.MD,E,be,Te.q],styles:[".invoice-data .mat-mdc-tab-header{padding:20px 20px 0;border-bottom:1px solid var(--accent-300)}"]})}return a})()},4626:(U,D,s)=>{s.d(D,{J:()=>M,Q:()=>S});var T=s(467),r=s(3664),p=s(8728),m=s(7705),y=s(177),L=s(5007);const A=["chart"];let S=(()=>{class g{constructor(){this.chart=(0,m.hFB)(),this.annotations=(0,m.hFB)(),this.colors=(0,m.hFB)(),this.dataLabels=(0,m.hFB)(),this.series=(0,m.hFB)(),this.stroke=(0,m.hFB)(),this.labels=(0,m.hFB)(),this.legend=(0,m.hFB)(),this.markers=(0,m.hFB)(),this.noData=(0,m.hFB)(),this.fill=(0,m.hFB)(),this.tooltip=(0,m.hFB)(),this.plotOptions=(0,m.hFB)(),this.responsive=(0,m.hFB)(),this.xaxis=(0,m.hFB)(),this.yaxis=(0,m.hFB)(),this.forecastDataPoints=(0,m.hFB)(),this.grid=(0,m.hFB)(),this.states=(0,m.hFB)(),this.title=(0,m.hFB)(),this.subtitle=(0,m.hFB)(),this.theme=(0,m.hFB)(),this.autoUpdateSeries=(0,m.hFB)(!0),this.chartReady=(0,m.CGW)(),this.chartInstance=(0,p.vPA)(null),this.chartElement=m.ebz.required("chart"),this.ngZone=(0,p.WQX)(r.SKi),this.isBrowser=(0,y.UE)((0,p.WQX)(r.Agw))}ngOnChanges(o){this.isBrowser&&this.ngZone.runOutsideAngular(()=>{L.$.schedule(()=>this.hydrate(o))})}ngOnDestroy(){this.destroy()}hydrate(o){this.autoUpdateSeries()&&0===Object.keys(o).filter(e=>"series"!==e).length?this.updateSeries(this.series(),!0):this.createElement()}createElement(){var o=this;return(0,T.A)(function*(){const{default:c}=yield s.e(4550).then(s.t.bind(s,4550,19));window.ApexCharts||=c;const e={};["annotations","chart","colors","dataLabels","series","stroke","labels","legend","fill","tooltip","plotOptions","responsive","markers","noData","xaxis","yaxis","forecastDataPoints","grid","states","title","subtitle","theme"].forEach(v=>{const _=o[v]();_&&(e[v]=_)}),o.destroy();const F=o.ngZone.runOutsideAngular(()=>new c(o.chartElement().nativeElement,e));o.chartInstance.set(F),o.render(),o.chartReady.emit({chartObj:F})})()}render(){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.render())}updateOptions(o,c,e,E){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateOptions(o,c,e,E))}updateSeries(o,c){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateSeries(o,c))}appendSeries(o,c){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendSeries(o,c))}appendData(o){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendData(o))}highlightSeries(o){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.highlightSeries(o))}toggleSeries(o){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleSeries(o))}showSeries(o){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.showSeries(o))}hideSeries(o){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.hideSeries(o))}resetSeries(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.resetSeries())}zoomX(o,c){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.zoomX(o,c))}toggleDataPointSelection(o,c){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleDataPointSelection(o,c))}destroy(){this.chartInstance()?.destroy(),this.chartInstance.set(null)}setLocale(o){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.setLocale(o))}paper(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.paper())}addXaxisAnnotation(o,c,e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addXaxisAnnotation(o,c,e))}addYaxisAnnotation(o,c,e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addYaxisAnnotation(o,c,e))}addPointAnnotation(o,c,e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addPointAnnotation(o,c,e))}removeAnnotation(o,c){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.removeAnnotation(o,c))}clearAnnotations(o){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.clearAnnotations(o))}dataURI(o){return this.chartInstance()?.dataURI(o)}static#e=this.\u0275fac=function(c){return new(c||g)};static#t=this.\u0275cmp=r.VBU({type:g,selectors:[["apx-chart"]],viewQuery:function(c,e){1&c&&r.wEZ(e.chartElement,A,5),2&c&&r.NyB()},inputs:{chart:[1,"chart"],annotations:[1,"annotations"],colors:[1,"colors"],dataLabels:[1,"dataLabels"],series:[1,"series"],stroke:[1,"stroke"],labels:[1,"labels"],legend:[1,"legend"],markers:[1,"markers"],noData:[1,"noData"],fill:[1,"fill"],tooltip:[1,"tooltip"],plotOptions:[1,"plotOptions"],responsive:[1,"responsive"],xaxis:[1,"xaxis"],yaxis:[1,"yaxis"],forecastDataPoints:[1,"forecastDataPoints"],grid:[1,"grid"],states:[1,"states"],title:[1,"title"],subtitle:[1,"subtitle"],theme:[1,"theme"],autoUpdateSeries:[1,"autoUpdateSeries"]},outputs:{chartReady:"chartReady"},features:[r.OA$],decls:2,vars:0,consts:[["chart",""]],template:function(c,e){1&c&&r.nrm(0,"div",null,0)},encapsulation:2,changeDetection:0})}return g})(),M=(()=>{class g{static#e=this.\u0275fac=function(c){return new(c||g)};static#t=this.\u0275mod=r.$C({type:g});static#n=this.\u0275inj=p.G2t({})}return g})()}}]);