"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[5113],{5113:(st,u,s)=>{s.r(u),s.d(u,{StudentListComponent:()=>at});var o=s(8728),_=s(2200),m=s(8132),d=s(645),p=s(357),h=s(980),C=s(6053),v=s(6848),R=s(2709),I=s(8937),M=s(343),S=s(7509),D=s(9331),T=s(2754),L=s(7753),f=s(8018),t=s(3664),b=s(8834),O=s(3746),g=s(4507),P=s(5747),x=s(3791),$=s(5079),j=s(6735),y=s(8863);const G=["loadMoreTrigger"],F=()=>["/online-course/student/add"],k=i=>["/online-course/student/edit",i],A=i=>({user:i}),B=i=>({value:i});function N(i,l){1&i&&(t.j41(0,"div",35)(1,"button",36)(2,"div",37),t.nrm(3,"i",38),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()),2&i&&(t.R7$(),t.Y8G("routerLink",t.lJ4(4,F)),t.R7$(3),t.SpI(" ",t.bMT(5,2,"Add Student")," "))}function U(i,l){if(1&i&&(t.j41(0,"mat-option",16),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function W(i,l){if(1&i&&(t.j41(0,"mat-option",16),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e.value),t.R7$(),t.SpI(" ",t.bMT(2,2,e.translationKey)," ")}}function K(i,l){1&i&&(t.j41(0,"th",39),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.JRh(t.bMT(2,1,"Name")))}function Y(i,l){if(1&i&&(t.j41(0,"td",40),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.R7$(),t.SpI(" ",e.fullName," ")}}function V(i,l){1&i&&(t.j41(0,"th",41),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.JRh(t.bMT(2,1,"Email")))}function X(i,l){if(1&i&&(t.j41(0,"td",42),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.R7$(),t.SpI(" ",e.email," ")}}function w(i,l){1&i&&(t.j41(0,"th",41),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.JRh(t.bMT(2,1,"Mobile")))}function J(i,l){if(1&i&&(t.j41(0,"td",42),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.R7$(),t.SpI(" ",e.mobile," ")}}function Q(i,l){1&i&&(t.j41(0,"th",41),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.JRh(t.bMT(2,1,"Nationality")))}function z(i,l){if(1&i&&(t.j41(0,"td",42),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.R7$(),t.SpI(" ",e.nationality," ")}}function H(i,l){1&i&&(t.j41(0,"th",43),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.JRh(t.bMT(2,1,"Actions")))}function Z(i,l){if(1&i){const e=t.RV6();t.j41(0,"ul",46)(1,"li",47),t.nI1(2,"translate"),t.bIt("click",function(){o.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return o.Njj(r.studentDetails(a))}),t.j41(3,"a",48),t.nrm(4,"i",49),t.k0s()(),t.j41(5,"li",50),t.nI1(6,"translate"),t.j41(7,"a",51),t.nrm(8,"i",52),t.k0s()(),t.j41(9,"li",50),t.nI1(10,"translate"),t.j41(11,"a",53),t.bIt("click",function(){o.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return o.Njj(r.confirmDisable(a))}),t.nrm(12,"i",54),t.k0s()()()}if(2&i){const e=t.XpG().$implicit,n=t.XpG();t.R7$(),t.Y8G("matTooltip",t.bMT(2,6,"\u0639\u0631\u0636")),t.R7$(4),t.Y8G("matTooltip",t.bMT(6,8,"\u062a\u0639\u062f\u064a\u0644")),t.R7$(2),t.Y8G("routerLink",t.eq3(12,k,e.id))("state",t.eq3(14,A,e)),t.R7$(2),t.Y8G("matTooltip",t.bMT(10,10,"\u062d\u0630\u0641")),t.R7$(2),t.Y8G("disabled",n.isProcessing(e.id))}}function q(i,l){if(1&i){const e=t.RV6();t.j41(0,"ul",46)(1,"li",50),t.nI1(2,"translate"),t.j41(3,"button",55),t.bIt("click",function(){o.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return o.Njj(r.changeStatus(a,!0))}),t.nrm(4,"i",56),t.k0s()(),t.j41(5,"li",50),t.nI1(6,"translate"),t.j41(7,"a",57),t.bIt("click",function(){o.eBV(e);const a=t.XpG().$implicit,r=t.XpG();return o.Njj(r.changeStatus(a,!1))}),t.nrm(8,"i",58),t.k0s()()()}if(2&i){const e=t.XpG().$implicit,n=t.XpG();t.R7$(),t.Y8G("matTooltip",t.bMT(2,4,"Accept")),t.R7$(2),t.Y8G("disabled",n.isProcessing(e.id)),t.R7$(2),t.Y8G("matTooltip",t.bMT(6,6,"Reject")),t.R7$(2),t.Y8G("disabled",n.isProcessing(e.id))}}function tt(i,l){if(1&i&&(t.j41(0,"td",42)(1,"div",44),t.DNE(2,Z,13,16,"ul",45)(3,q,9,8,"ng-template",null,3,t.C5r),t.k0s()()),2&i){const e=l.$implicit,n=t.sdS(4);t.R7$(2),t.Y8G("ngIf",!e.inactive)("ngIfElse",n)}}function et(i,l){1&i&&t.nrm(0,"tr",59)}function it(i,l){1&i&&t.nrm(0,"tr",60)}function nt(i,l){if(1&i&&(t.j41(0,"tr",61)(1,"td",62),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&i){t.XpG();const e=t.sdS(14);t.R7$(2),t.SpI(" ",t.i5U(3,1,'No data matching the filter "{{ value }}"',t.eq3(4,B,e.value))," ")}}let at=(()=>{class i{constructor(){this.lookupService=(0,o.WQX)(v.s),this.userService=(0,o.WQX)(R.D),this.toast=(0,o.WQX)(S.f),this.translate=(0,o.WQX)(f.c$),this.dialog=(0,o.WQX)(p.h),this.displayedColumns=["fullName","email","mobile","nationality","action"],this.dataSource=new d.I6,this.totalCount=0,this.filter={skipCount:0,maxResultCount:20},this.pageIndex=0,this.pageSize=20,this.showInactive=!1,this.nationalities=[],this.selectedResidentId=null,this.residencyGroupOptions=T.w,this.selectedResidencyGroup="all",this.pendingStudentIds=new Set,this.isLoading=!1,this.isLoadingMore=!1}set loadMoreTrigger(e){this.loadMoreElement=e,this.setupIntersectionObserver()}applyFilter(e){this.filter.searchTerm=e.target.value.trim().toLowerCase(),this.pageIndex=0,this.filter.skipCount=0,this.loadStudents()}toggleInactiveFilter(){this.showInactive=!this.showInactive,this.showInactive?this.filter.filter="inactive=true":delete this.filter.filter,this.pageIndex=0,this.filter.skipCount=0,this.loadStudents()}ngOnInit(){this.loadNationalities(),this.loadStudents()}ngOnDestroy(){this.intersectionObserver?.disconnect()}loadNationalities(){this.lookupService.getAllNationalities().subscribe(e=>{this.nationalities=e.isSuccess&&Array.isArray(e.data)?e.data:[]})}loadStudents(e=!1){this.filter.residentGroup=this.selectedResidencyGroup,this.isLoading=!e,this.isLoadingMore=e,this.lookupService.getUsersForSelects(this.filter,Number(I.m.Student),0,0,0,this.selectedResidentId??void 0).pipe((0,h.j)(()=>{this.isLoading=!1,this.isLoadingMore=!1})).subscribe({next:n=>{n.isSuccess&&n.data?.items?(this.dataSource.data=e?[...this.dataSource.data,...n.data.items]:n.data.items,this.totalCount=n.data.totalCount):(e||(this.dataSource.data=[]),this.totalCount=0)},error:()=>{e||(this.dataSource.data=[]),this.totalCount=0}})}onResidencyChange(e){this.selectedResidentId=e&&e>0?e:null,this.pageIndex=0,this.filter.skipCount=0,this.loadStudents()}onResidencyGroupChange(e){this.selectedResidencyGroup=e??"all",this.pageIndex=0,this.filter.skipCount=0,this.loadStudents()}studentDetails(e){this.lookupService.getUserDetails(e.id).subscribe({next:n=>{n.isSuccess&&n.data?this.dialog.open(M.StudentDetailsComponent,{width:"800px",maxWidth:"95vw",data:n.data}):this.toast.error(this.translate.instant("Failed to load student details"))},error:()=>this.toast.error(this.translate.instant("Failed to load student details"))})}confirmDisable(e){this.isProcessing(e.id)||this.dialog.open(D.x,{data:{fullName:e.fullName}}).afterClosed().subscribe(a=>{a&&this.changeStatus(e,!1)})}isProcessing(e){return this.pendingStudentIds.has(e)}changeStatus(e,n){this.pendingStudentIds.has(e.id)||(this.pendingStudentIds.add(e.id),this.userService.disableUser(e.id,n).pipe((0,h.j)(()=>this.pendingStudentIds.delete(e.id))).subscribe({next:a=>{a.isSuccess?n?(e.inactive=!1,this.toast.success(this.translate.instant("User restored successfully"))):(this.dataSource.data=this.dataSource.data.filter(r=>r.id!==e.id),this.totalCount=Math.max(this.totalCount-1,0),this.toast.success(this.translate.instant("User disabled successfully"))):a.errors?.length?a.errors.forEach(r=>this.toast.error(r.message)):this.toast.error(this.translate.instant("Failed to update user status"))},error:()=>this.toast.error(this.translate.instant("Failed to update user status"))}))}setupIntersectionObserver(){this.loadMoreElement&&(this.intersectionObserver?.disconnect(),this.intersectionObserver=new IntersectionObserver(e=>{e.some(n=>n.isIntersecting)&&this.loadNextPage()},{root:null,rootMargin:"0px 0px 20% 0px"}),this.intersectionObserver.observe(this.loadMoreElement.nativeElement))}loadNextPage(){this.isLoading||this.isLoadingMore||this.hasMoreResults()&&(this.pageIndex+=1,this.filter.skipCount=this.pageIndex*this.pageSize,this.filter.maxResultCount=this.pageSize,this.loadStudents(!0))}hasMoreResults(){return this.dataSource.data.length<this.totalCount}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-student-list"]],viewQuery:function(n,a){if(1&n&&t.GBs(G,5),2&n){let r;t.mGM(r=t.lsd())&&(a.loadMoreTrigger=r.first)}},decls:58,vars:29,consts:[["headerOptionsTemplate",""],["input",""],["loadMoreTrigger",""],["inactiveIcons",""],[3,"isLoading"],[1,"row","p-t-25"],[1,"col-12"],["padding","0","cardClass","sm-block",3,"cardTitle"],[1,"p-b-15"],[1,"table-containe","table-reponsive"],[1,"table-search","p-t-15","p-x-15"],[1,"row","g-3"],[1,"col-12","col-md-4"],["appearance","outline",1,"w-100"],["matInput","",3,"keyup","placeholder"],[3,"selectionChange","value"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"table-responsive"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","fullName"],["mat-header-cell","","class","p-l-25",4,"matHeaderCellDef"],["mat-cell","","class","p-l-25 text-nowrap",4,"matCellDef"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","text-nowrap",4,"matCellDef"],["matColumnDef","mobile"],["matColumnDef","nationality"],["matColumnDef","action"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"app-paginator"],[1,"text-muted"],[1,"table-options"],["mat-flat-button","","color","primary",3,"routerLink"],[1,"flex","align-item-center"],[1,"ti","ti-plus","f-18","m-r-5"],["mat-header-cell","",1,"p-l-25"],["mat-cell","",1,"p-l-25","text-nowrap"],["mat-header-cell",""],["mat-cell","",1,"text-nowrap"],["mat-header-cell","",1,"text-center"],[1,"text-center","text-nowrap"],["class","list-inline p-l-0",4,"ngIf","ngIfElse"],[1,"list-inline","p-l-0"],[1,"list-inline-item","m-r-10",3,"click","matTooltip"],["href","javascript:",1,"avatar","avatar-xs","text-muted"],[1,"ti","ti-eye","f-18"],[1,"list-inline-item","m-r-10",3,"matTooltip"],[1,"avatar","avatar-xs","text-muted",3,"routerLink","state"],[1,"ti","ti-edit","f-18"],["type","button",1,"avatar","avatar-xs","text-muted",3,"click","disabled"],[1,"ti","ti-trash","f-18"],["type","button",1,"avatar","avatar-xs","bg-success-50","text-success-500",3,"click","disabled"],[1,"ti","ti-check","f-20"],["type","button",1,"avatar","avatar-xs","bg-warn-50","text-warn-500",3,"click","disabled"],[1,"ti","ti-x","f-20"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(n,a){if(1&n){const r=t.RV6();t.j41(0,"app-loading-overlay",4)(1,"div",5)(2,"div",6)(3,"app-card",7),t.nI1(4,"translate"),t.DNE(5,N,6,5,"ng-template",null,0,t.C5r),t.j41(7,"div",8)(8,"div",9)(9,"div",10)(10,"div",11)(11,"div",12)(12,"mat-form-field",13)(13,"input",14,1),t.nI1(15,"translate"),t.bIt("keyup",function(c){return o.eBV(r),o.Njj(a.applyFilter(c))}),t.k0s()()(),t.j41(16,"div",12)(17,"mat-form-field",13)(18,"mat-label"),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"mat-select",15),t.bIt("selectionChange",function(c){return o.eBV(r),o.Njj(a.onResidencyChange(c.value))}),t.j41(22,"mat-option",16),t.EFF(23),t.nI1(24,"translate"),t.k0s(),t.DNE(25,U,2,2,"mat-option",17),t.k0s()()(),t.j41(26,"div",12)(27,"mat-form-field",13)(28,"mat-label"),t.EFF(29),t.nI1(30,"translate"),t.k0s(),t.j41(31,"mat-select",15),t.bIt("selectionChange",function(c){return o.eBV(r),o.Njj(a.onResidencyGroupChange(c.value))}),t.DNE(32,W,3,4,"mat-option",17),t.k0s()()()()(),t.j41(33,"div",18)(34,"table",19),t.qex(35,20),t.DNE(36,K,3,3,"th",21)(37,Y,2,1,"td",22),t.bVm(),t.qex(38,23),t.DNE(39,V,3,3,"th",24)(40,X,2,1,"td",25),t.bVm(),t.qex(41,26),t.DNE(42,w,3,3,"th",24)(43,J,2,1,"td",25),t.bVm(),t.qex(44,27),t.DNE(45,Q,3,3,"th",24)(46,z,2,1,"td",25),t.bVm(),t.qex(47,28),t.DNE(48,H,3,3,"th",29)(49,tt,5,2,"td",25),t.bVm(),t.DNE(50,et,1,0,"tr",30)(51,it,1,0,"tr",31)(52,nt,4,6,"tr",32),t.k0s(),t.j41(53,"div",33,2)(55,"span",34),t.EFF(56),t.nI1(57,"translate"),t.k0s()()()()()()()()()}2&n&&(t.Y8G("isLoading",a.isLoading),t.R7$(3),t.Y8G("cardTitle",t.bMT(4,17,"Student List")),t.R7$(10),t.Y8G("placeholder",t.bMT(15,19,"Search...")),t.R7$(6),t.JRh(t.bMT(20,21,"Residency")),t.R7$(2),t.Y8G("value",a.selectedResidentId??null),t.R7$(),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(24,23,"All Residencies")),t.R7$(2),t.Y8G("ngForOf",a.nationalities),t.R7$(4),t.JRh(t.bMT(30,25,"Residency Group")),t.R7$(2),t.Y8G("value",a.selectedResidencyGroup),t.R7$(),t.Y8G("ngForOf",a.residencyGroupOptions),t.R7$(2),t.Y8G("dataSource",a.dataSource),t.R7$(16),t.Y8G("matHeaderRowDef",a.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumns),t.R7$(2),t.AVh("d-none",!a.hasMoreResults()),t.R7$(3),t.SpI(" ",t.bMT(57,27,a.isLoadingMore?"Loading more...":"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")," "))},dependencies:[_.MD,_.Sq,_.bT,C.G,b.$z,O.fg,g.j,g.M,P.e,x.g,$.M,d.Zl,d.tL,d.ji,d.cC,d.YV,d.iL,d.KS,d.$R,d.YZ,d.NB,d.ky,j.i,y.m,f.D9,m.iI,m.Wk,p.l,L.q],styles:[".table-options[_ngcontent-%COMP%]{display:flex;align-items:center}@media (max-width: 575px){.table-options[_ngcontent-%COMP%]{display:block}.table-options[_ngcontent-%COMP%]   .mdc-button[_ngcontent-%COMP%]{margin-top:10px}}"]})}return i})()}}]);