"use strict";(self.webpackChunkable_pro=self.webpackChunkable_pro||[]).push([[8595],{2754:(R,E,a)=>{a.d(E,{a:()=>m,w:()=>l});const l=[{value:"all",translationKey:"\u0643\u0644 \u0627\u0645\u0627\u0643\u0646 \u0627\u0644\u0627\u0642\u0627\u0645\u0629"},{value:"egyptian",translationKey:"\u0645\u0635\u0631\u064a\u064a\u0646"},{value:"arab",translationKey:"\u0639\u0631\u0628"},{value:"foreign",translationKey:"\u0627\u062c\u0627\u0646\u0628"}];function m(r){return!(!r||"all"===r)}},6848:(R,E,a)=>{a.d(E,{_:()=>y,s:()=>A});var l=a(9330),m=a(8728),r=a(6354),_=a(2525),P=a(5366),g=a(8937),b=a(2754);function y(c,t={}){const s=c.data,u=Array.isArray(s)?s:null,o=s&&!Array.isArray(s)?s:{totalCount:u?.length??0,items:u??[]},M=o.items,T=Array.isArray(M)?M:u??[],f=e=>{const p=Number(e);return Number.isFinite(p)?p:void 0},D=[t.skipCount,o.skipCount].map(f).filter(e=>void 0!==e),v=Math.max(0,Math.trunc(D.length>0?D[0]:0))+T.length,n=[o.totalCount,o.total,o.count,o.totalItems,o.totalRecords,c.totalCount,c.total,c.count].map(f).find(e=>void 0!==e),h=void 0!==n?Math.max(Math.trunc(n),v):v;return{...c,data:{...o,items:T,totalCount:h}}}let A=(()=>{class c{constructor(){this.http=(0,m.WQX)(l.Qq),this.auth=(0,m.WQX)(P.k)}getUsersForSelects(s,u,o=0,M=0,T=0,f,I=!1){const O=this.auth.getRole()===g.m.Admin?0:T,C=this.resolveLookupMode(s),v=!C;let i=(new l.Nl).set("UserTypeId",u.toString()).set("managerId",o.toString()).set("teacherId",M.toString()).set("branchId",O.toString());v&&void 0!==s.skipCount&&(i=i.set("SkipCount",s.skipCount.toString())),v&&void 0!==s.maxResultCount&&(i=i.set("MaxResultCount",s.maxResultCount.toString()));const n=s.searchWord??s.searchTerm;s.searchTerm&&(i=i.set("SearchTerm",s.searchTerm)),n&&(i=i.set("SearchWord",n));const h=[];return s.filter&&h.push(s.filter),C&&h.push(`${C}=true`),h.length&&(i=i.set("Filter",h.join("&"))),s.lang&&(i=i.set("Lang",s.lang)),s.sortingDirection&&(i=i.set("SortingDirection",s.sortingDirection)),s.sortBy&&(i=i.set("SortBy",s.sortBy)),f&&f>0&&(i=i.set("residentId",f.toString())),(0,b.a)(s.residentGroup)&&(i=i.set("residentGroup",s.residentGroup)),I&&(i=i.set("includeRelations","true")),this.http.get(`${_.c.apiUrl}/api/UsersForGroups/GetUsersForSelects`,{params:i}).pipe((0,r.T)(e=>y(e,{skipCount:s.skipCount})))}getUserDetails(s){const u=(new l.Nl).set("id",s.toString());return this.http.get(`${_.c.apiUrl}/api/UsersForGroups/GetUserDetails`,{params:u})}resolveLookupMode(s){return s.lookupOnly?"lookupOnly":s.lookup?"lookup":s.idsOnly?"idsOnly":null}getAllNationalities(){return this.http.get(`${_.c.apiUrl}/api/LookUp/GetAllNationality`)}getAllGovernorates(){return this.http.get(`${_.c.apiUrl}/api/LookUp/GetAllGovernorate`)}getSubscribesByTypeId(s,u){let o=new l.Nl;return null!=s&&(o=o.set("id",s.toString())),null!=u&&u>0&&(o=o.set("studentId",u.toString())),this.http.get(`${_.c.apiUrl}/api/LookUp/GetAllSubscribesByTypeId`,{params:o})}static#t=this.\u0275fac=function(u){return new(u||c)};static#s=this.\u0275prov=m.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},7509:(R,E,a)=>{a.d(E,{f:()=>r});var l=a(8728),m=a(5416);let r=(()=>{class _{constructor(){this.snackBar=(0,l.WQX)(m.UG)}success(g,b="Close",y=3e3){this.snackBar.open(g,b,{duration:y,panelClass:["toast-success"]})}error(g,b="Close",y=3e3){this.snackBar.open(g,b,{duration:y,panelClass:["toast-error"]})}static#t=this.\u0275fac=function(b){return new(b||_)};static#s=this.\u0275prov=l.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},8595:(R,E,a)=>{a.r(E),a.d(E,{SubscribeFormComponent:()=>i});var l=a(8728),m=a(2200),r=a(9417),_=a(3243),P=a(8132),g=a(6053),b=a(5862),y=a(6848),A=a(7509),c=a(8018),t=a(3664),s=a(8834),u=a(3746),o=a(4507),M=a(3791),T=a(5079),f=a(6735),I=a(8863);function D(n,h){1&n&&(t.j41(0,"mat-option",13),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Loading subscribe types\u2026")," "))}function O(n,h){1&n&&(t.j41(0,"mat-option",13),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"No subscribe types available")," "))}function C(n,h){if(1&n&&(t.j41(0,"mat-option",14),t.EFF(1),t.k0s()),2&n){const e=h.$implicit,p=t.XpG();t.Y8G("value",e.id),t.R7$(),t.Lme(" ",e.name," (",p.resolveCategoryLabel(e.group),") ")}}function v(n,h){if(1&n&&(t.j41(0,"div",15),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.typeAvailabilityMessage," ")}}let i=(()=>{class n{constructor(){this.fb=(0,l.WQX)(r.ok),this.service=(0,l.WQX)(b.qB),this.router=(0,l.WQX)(_.Ix),this.toast=(0,l.WQX)(A.f),this.translate=(0,l.WQX)(c.c$),this.lookupService=(0,l.WQX)(y.s),this.form=this.fb.group({id:[0],name:["",r.k0.required],price:[null,r.k0.required],minutes:[null],subscribeTypeId:[null]}),this.isEdit=!1,this.types=[],this.nationalities=[],this.selectedResidentId=null,this.isLoadingTypes=!1,this.typeAvailabilityMessage=null}ngOnInit(){const e=history.state?.item;e&&(this.isEdit=!0,this.form.patchValue({id:e.id,name:e.name??"",price:e.price??null,minutes:e.minutes??null,subscribeTypeId:e.subscribeTypeId??e.subscribeType?.id??null})),this.loadNationalities(),this.loadSubscribeTypes()}submit(){const e=this.form.value;this.isEdit?this.service.update(e).subscribe({next:()=>{this.toast.success("Subscribe saved successfully"),this.router.navigate(["/online-course/setting/subscribe/list"])},error:()=>this.toast.error("Error saving subscribe")}):this.service.create(e).subscribe({next:()=>{this.toast.success("Subscribe saved successfully"),this.router.navigate(["/online-course/setting/subscribe/list"])},error:()=>this.toast.error("Error saving subscribe")})}resolveCategoryLabel(e){return this.translate.instant((0,b.be)(e))}onResidencyChange(e){this.selectedResidentId=e&&e>0?e:null,this.loadSubscribeTypes()}loadNationalities(){this.lookupService.getAllNationalities().subscribe({next:e=>{this.nationalities=e.isSuccess&&Array.isArray(e.data)?e.data:[]},error:()=>{this.nationalities=[]}})}loadSubscribeTypes(){const e={skipCount:0,maxResultCount:100};this.selectedResidentId&&(e.residentId=this.selectedResidentId),this.isLoadingTypes=!0,this.typeAvailabilityMessage=null,this.service.getAllTypes(e).subscribe({next:p=>{this.types=p.isSuccess&&p.data?.items?p.data.items:[];const d=this.form.get("subscribeTypeId")?.value;d&&!this.types.some(S=>S.id===d)&&this.form.patchValue({subscribeTypeId:null}),this.typeAvailabilityMessage=0===this.types.length?this.translate.instant(this.selectedResidentId?"No subscribe types are available for the selected residency.":"No subscribe types are currently available."):null},error:()=>{this.types=[],this.typeAvailabilityMessage=this.translate.instant("Unable to load subscribe types."),this.toast.error(this.translate.instant("Error loading subscribe types")),this.isLoadingTypes=!1},complete:()=>{this.isLoadingTypes=!1}})}static#t=this.\u0275fac=function(p){return new(p||n)};static#s=this.\u0275cmp=t.VBU({type:n,selectors:[["app-subscribe-form"]],decls:35,vars:24,consts:[[3,"cardTitle"],[1,"row","g-3",3,"ngSubmit","formGroup"],[1,"col-md-6"],["appearance","outline",1,"w-100"],["matInput","","formControlName","name"],["matInput","","type","number","formControlName","minutes"],["matInput","","type","number","formControlName","price"],["formControlName","subscribeTypeId",3,"disabled"],["disabled","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["class","col-12 text-warn",4,"ngIf"],[1,"col-12"],["mat-flat-button","","color","primary","type","submit"],["disabled",""],[3,"value"],[1,"col-12","text-warn"]],template:function(p,d){1&p&&(t.j41(0,"app-card",0),t.nI1(1,"translate"),t.j41(2,"form",1),t.bIt("ngSubmit",function(){return d.submit()}),t.j41(3,"div",2)(4,"mat-form-field",3)(5,"mat-label"),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.nrm(8,"input",4),t.k0s()(),t.j41(9,"div",2)(10,"mat-form-field",3)(11,"mat-label"),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.nrm(14,"input",5),t.k0s()(),t.j41(15,"div",2)(16,"mat-form-field",3)(17,"mat-label"),t.EFF(18),t.nI1(19,"translate"),t.k0s(),t.nrm(20,"input",6),t.k0s()(),t.j41(21,"div",2)(22,"mat-form-field",3)(23,"mat-label"),t.EFF(24),t.nI1(25,"translate"),t.k0s(),t.j41(26,"mat-select",7),t.DNE(27,D,3,3,"mat-option",8)(28,O,3,3,"mat-option",8)(29,C,2,3,"mat-option",9),t.k0s()()(),t.DNE(30,v,2,1,"div",10),t.j41(31,"div",11)(32,"button",12),t.EFF(33),t.nI1(34,"translate"),t.k0s()()()()),2&p&&(t.Y8G("cardTitle",t.bMT(1,12,d.isEdit?"Edit Subscribe":"Add Subscribe")),t.R7$(2),t.Y8G("formGroup",d.form),t.R7$(4),t.JRh(t.bMT(7,14,"Name")),t.R7$(6),t.JRh(t.bMT(13,16,"Minutes")),t.R7$(6),t.JRh(t.bMT(19,18,"Price")),t.R7$(6),t.JRh(t.bMT(25,20,"Subscribe Type")),t.R7$(2),t.Y8G("disabled",d.isLoadingTypes||0===d.types.length),t.R7$(),t.Y8G("ngIf",d.isLoadingTypes),t.R7$(),t.Y8G("ngIf",!d.isLoadingTypes&&0===d.types.length),t.R7$(),t.Y8G("ngForOf",d.types),t.R7$(),t.Y8G("ngIf",d.typeAvailabilityMessage),t.R7$(3),t.JRh(t.bMT(34,22,"Save")))},dependencies:[m.MD,m.Sq,m.bT,g.G,s.$z,u.fg,o.j,o.M,M.g,T.M,r.qT,r.me,r.Q0,r.BC,r.cb,r.j4,r.JD,f.i,I.m,c.D9,P.iI],encapsulation:2})}return n})()}}]);